//META{"name":"discordCrypt"}*//

/*******************************************************************************
 * MIT License
 *
 * Copyright (c) 2018 Leonardo Gates
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 ******************************************************************************/

"use strict";class discordCrypt{getName(){return"DiscordCrypt"}getDescription(){return"Provides secure messaging for Discord using various cryptography standards."}getAuthor(){return"Leonardo Gates"}getVersion(){return"1.2.6"}constructor(){this.messageMarkupClass=".markup",this.searchUiClass=".search .search-bar",this.channelTextAreaClass=".content textarea",this.autoCompleteClass=".autocomplete-1vrmpx",this.encodedMessageHeader="\u28b7\u28b8\u28b9\u28ba",this.encodedKeyHeader="\u28bb\u28bc\u28bd\u28be",this.messageHeader="-----ENCRYPTED MESSAGE-----",this.masterPassword=null,this.scanInterval=void 0,this.toolbarReloadInterval=void 0,this.updateHandlerInterval=void 0,this.timedMessageInterval=void 0,this.messageUpdateDispatcher=null,this.configFile=null,this.cachedModules={},this.encryptModes=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],this.encryptBlockModes=["CBC","CFB","OFB"],this.paddingModes=["PKC7","ANS2","ISO1","ISO9"],this.appCss='.dc-overlay { font-family: monospace; font-size: 14px; background: rgba(0, 0, 0, 0.85) !important; position: fixed; display: none; width: 100%; height: 100%; left: 0; top: 0; z-index: 1000; cursor: default;}.dc-scroll-table { margin-top: 20px; overflow: auto; height: 50%;}.dc-table { border: 1px solid #424549; padding: 5px; width: 100%;}.dc-table > thead { background: #d3d3d3; color: #000;}.dc-table > thead > tr > th { padding: 4px;}.dc-table > tbody > tr > td { text-align: center; padding: 2px;}.dc-table > tbody > tr > td > button { display: block; margin: auto;}.dc-checkbox, .dc-checkbox:active { margin-top: -5px; margin-left: 10%; position: relative; -webkit-appearance: none; outline: none; width: 50px; height: 30px; background-color: #fff; border: 1px solid #a9a9a9; border-radius: 50px; box-shadow: inset -20px 0 0 0 #a9a9a9; -webkit-transition-duration: 200ms;}.dc-checkbox:after { content: ""; position: absolute; top: 1px; left: 1px; width: 26px; height: 26px; background-color: transparent; border-radius: 50%; box-shadow: 2px 4px 6px rgba(0,0,0,0.2);}.dc-checkbox:checked { border-color: #3a71c1; box-shadow: inset 20px 0 0 0 #3a71c1;}.dc-checkbox:checked:after { left: 20px; box-shadow: -2px 4px 3px rgba(0,0,0,0.05);}.dc-password-field { width: 95%; margin: 10px; color: #ffffff; height: 10px; padding: 5px; background: rgba(0, 0, 0, 0.1); border: 2px solid #3a71c1;}.dc-overlay-centerfield { font-size: 20px; color: #fff; padding: 16px; border-radius: 5px; background-color: #1e2124; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);}.dc-overlay-main { overflow: hidden; position: absolute; left: 5%; right: 5%; top: 5%; bottom: 5%; width: 90%; height: 90%; border: 3px solid #23272a; background-color: #36393f !important; border-radius: 3px;}.dc-textarea { font-family: monospace; font-size: 12px; color: #ffffff; overflow: auto; padding: 5px; resize: none; height: 100%; margin: 2px;}.dc-update-field { font-size: 14px; margin: 10px;}ul.dc-list { margin: 10px; padding: 5px; list-style-type: circle;}ul.dc-list > li { padding: 5px; }ul.dc-list-red { color: #ff0000; }.dc-overlay-main textarea { background: transparent !important; cursor: default; font-size: 12px; padding: 5px; margin-top: 10px; border-radius: 2px; resize: none; color: #8e8e8e; width: 70%; overflow-y: hidden; user-select: none;}.dc-overlay-main select { background-color: transparent; border-radius: 3px; font-size: 12px; color: #fff;}.dc-overlay-main select:hover { background-color: #000 !important; color: #fff;}.dc-input-field { font-family: monospace !important; background: #000 !important; color: #fff !important; font-size: 12px; width: 50%; margin-bottom: 10px; margin-top: -5px; margin-left: 10%; text-indent: 5px;}.dc-input-label { font-family: monospace !important; color: #708090; min-width: 20%;}.dc-ruler-align { display: flex; margin: 10px;}.dc-code-block { font-family: monospace !important; font-size: 0.875rem; line-height: 1rem; overflow-x: visible; text-indent: 0; background: rgba(0,0,0,0.42)!important; color: hsla(0,0%,100%,0.7)!important; padding: 6px!important; position: relative;}.dc-overlay-main .tab { overflow: hidden; background-color: rgba(0, 0, 0, .7) !important; border-bottom: 3px solid #23272a;}.dc-overlay-main .tab button { color: #a9a9a9; background-color: transparent; cursor: pointer; padding: 14px 14px; font-size: 14px; transition: 0.5s; font-family: monospace; border-radius: 3px; margin: 3px;}.dc-overlay-main .tab button:hover { background-color: #2c2f33;}.dc-overlay-main .tab button.active { background-color: #23272a;}.dc-overlay-main .tab-content { display: none; height: 95%; color: #9298a2; overflow: auto; padding: 10px 25px 5px; animation: fadeEffect 1s; background: rgba(0, 0, 0, 0.7) !important;}.dc-hint { font-size: 9px; display: block;}.dc-hint > p { margin: 0 0 0 30%;}.dc-svg { color: #fff; opacity: .6; margin: 0 4px; cursor: pointer; width: 24px; height: 24px;}.dc-svg:hover { color: #fff; opacity: .8;}.dc-button{ margin-right: 5px; margin-left: 5px; background-color: #7289da; color: #fff; align-items: center; border-radius: 3px; box-sizing: border-box; display: flex; font-size: 14px; width: auto; height: 32px; min-height: 32px; min-width: 60px; font-weight: 500; justify-content: center; line-height: 16px; padding: 2px 16px; position: relative; user-select: none;}.dc-button-small{ height: 20px !important; min-height: 20px !important; font-size: 10px;}.dc-button:hover{ background-color: #677bc4 !important; }.dc-button:active{ background-color: #5b6eae !important; }.dc-button-inverse{ color: #f04747; background: transparent !important; border: 1px solid rgba(240,71,71,.3); transition: color .17s ease,background-color .17s ease,border-color .17s ease;}.dc-button-inverse:hover{ border-color: rgba(240,71,71,.6); background: transparent !important;}.dc-button-inverse:active{ background-color: rgba(240,71,71,.1); }.stat-levels { box-shadow: inset 0 0 25px rgba(0,0,0,.5); margin: 5px auto 0 auto; height: 20px; padding: 15px; border: 1px solid #494a4e; border-radius: 10px; background: linear-gradient(#444549 0%, #343539 100%);}.stat-bar { background-color: #2a2b2f; box-shadow: inset 0 5px 15px rgba(0,0,0,.6); height: 8px; overflow: hidden; padding: 3px; border-radius: 3px; margin-bottom: 10px; margin-top: 10px; margin-left: 0;}.stat-bar-rating { border-radius: 4px; float: left; height: 100%; font-size: 12px; color: #ffffff; text-align: center; text-indent: -9999px; background-color: #3a71c1; box-shadow: inset 0 -1px 0 rgba(0, 0, 0, 0.15);}.stat-bar-rating { @include stat-bar(#cf3a02, #ff4500, top, bottom); }',this.toolbarHtml='<button type="button" id="dc-clipboard-upload-btn" style="background-color: transparent;" title="Upload Encrypted Clipboard"> <svg x="0px" y="0px" width="30" height="30" viewBox="0 0 18 18" class="dc-svg">  <path fill="lightgrey" d="M13 4h-3v-4h-10v14h6v2h10v-9l-3-3zM3 1h4v1h-4v-1zM15   15h-8v-10h5v3h3v7zM13 7v-2l2 2h-2z"/> </svg></button><button type="button" id="dc-file-btn" style="background-color: transparent;" title="Upload Encrypted File"> <svg class="dc-svg" width="24" height="24" viewBox="0 0 1792 1792" fill="lightgrey">  <path d="M768 384v-128h-128v128h128zm128 128v-128h-128v128h128zm-128   128v-128h-128v128h128zm128 128v-128h-128v128h128zm700-388q28 28 48   76t20 88v1152q0 40-28 68t-68 28h-1344q-40 0-68-28t-28-68v-1600q0-40 28-68t68-28h896q40   0 88 20t76 48zm-444-244v376h376q-10-29-22-41l-313-313q-12-12-41-22zm384 1528v-1024h-416q-40   0-68-28t-28-68v-416h-128v128h-128v-128h-512v1536h1280zm-627-721l107 349q8 27 8 52 0 83-72.5   137.5t-183.5 54.5-183.5-54.5-72.5-137.5q0-25 8-52 21-63 120-396v-128h128v128h79q22 0 39   13t23 34zm-141 465q53 0 90.5-19t37.5-45-37.5-45-90.5-19-90.5 19-37.5 45 37.5 45 90.5 19z">  </path> </svg></button><button type="button" id="dc-settings-btn" style="background-color: transparent;" title="DiscordCrypt Settings"> <svg class="dc-svg" enable-background="new 0 0 32 32" version="1.1" viewBox="0 0 32 32"  width="20px" height="20px" xml:space="preserve">  <g>   <path fill="lightgrey" d="M28,10H18v2h10V10z M14,10H4v10h10V10z M32,0H0v28h15.518c1.614,2.411,    4.361,3.999,7.482,4c4.971-0.002,8.998-4.029,9-9    c0-0.362-0.027-0.718-0.069-1.069L32,22V0z M10,2h12v2H10V2z M6,2h2v2H6V2z M2,2h2v2H2V2z    M23,29.883    c-3.801-0.009-6.876-3.084-6.885-6.883c0.009-3.801,3.084-6.876,6.885-6.885c3.799,0.009,6.874,    3.084,6.883,6.885    C29.874,26.799,26.799,29.874,23,29.883z M29.999,    17.348c-0.57-0.706-1.243-1.324-1.999-1.83V14h-4.99c-0.003,0-0.007,0-0.01,0    s-0.007,0-0.01,0H18v1.516c-2.412,1.614-4,4.361-4,7.483c0,1.054,0.19,2.061,0.523,    3H2V6h27.999V17.348z M30,4h-4V2h4V4z"/>   <path fill="lightgrey" d="M28,    24v-2.001h-1.663c-0.063-0.212-0.145-0.413-0.245-0.606l1.187-1.187l-1.416-1.415l-1.165,1.166    c-0.22-0.123-0.452-0.221-0.697-0.294V18h-2v1.662c-0.229,0.068-0.446,0.158-0.652,    0.27l-1.141-1.14l-1.415,1.415l1.14,1.14    c-0.112,0.207-0.202,0.424-0.271,0.653H18v2h1.662c0.073,0.246,0.172,0.479,    0.295,0.698l-1.165,1.163l1.413,1.416l1.188-1.187    c0.192,0.101,0.394,0.182,0.605,0.245V28H24v-1.665c0.229-0.068,0.445-0.158,    0.651-0.27l1.212,1.212l1.414-1.416l-1.212-1.21    c0.111-0.206,0.201-0.423,0.27-0.651H28z M22.999,    24.499c-0.829-0.002-1.498-0.671-1.501-1.5c0.003-0.829,0.672-1.498,1.501-1.501    c0.829,0.003,1.498,0.672,1.5,1.501C24.497,23.828,23.828,24.497,22.999,24.499z"/>  </g> </svg></button><button type="button" id="dc-lock-btn" style="background-color: transparent;"/><button type="button" id="dc-passwd-btn" style="background-color: transparent;" title="Password Settings"> <svg class="dc-svg" version="1.1" viewBox="0 0 32 32" width="20px" height="20px">  <g fill="none" fill-rule="evenodd" stroke="none" stroke-width="1">   <g fill="lightgrey">    <path d="M13.008518,22 L11.508518,23.5 L11.508518,23.5 L14.008518,26 L11.008518,     29 L8.50851798,26.5 L6.63305475,28.3754632 C5.79169774,29.2168202     4.42905085,29.2205817 3.5909158,28.3824466 L3.62607133,28.4176022 C2.78924,27.5807709     2.79106286,26.2174551 3.63305475,25.3754632 L15.7904495,13.2180685     C15.2908061,12.2545997 15.008518,11.1602658 15.008518,10 C15.008518,6.13400656 18.1425245,     3 22.008518,3 C25.8745114,3     29.008518,6.13400656 29.008518,10 C29.008518,13.8659934 25.8745114,17 22.008518,     17 C20.8482521,17 19.7539183,16.7177118 18.7904495,16.2180685     L18.7904495,16.2180685 L16.008518,19 L18.008518,21 L15.008518,24 L13.008518,22 L13.008518,     22 L13.008518,22 Z M22.008518,14 C24.2176571,14     26.008518,12.2091391 26.008518,10 C26.008518,7.79086089 24.2176571,6 22.008518,     6 C19.7993789,6 18.008518,7.79086089 18.008518,10 C18.008518,12.2091391     19.7993789,14 22.008518,14 L22.008518,14 Z" id="key"/>   </g>  </g> </svg></button><button type="button" id="dc-exchange-btn" style="background-color: transparent;" title="Key Exchange Menu"> <svg class="dc-svg" version="1.1" viewBox="0 0 78 78" width="20px" height="20px">  <path d="M72,4.5H6c-3.299,0-6,2.699-6,6V55.5c0,3.301,2.701,6,6,6h66c3.301,0,6-2.699,6-6V10.5   C78,7.2,75.301,4.5,72,4.5z M72,50.5H6V10.5h66V50.5z   M52.5,67.5h-27c-1.66,0-3,1.341-3,3v3h33v-3C55.5,68.84,54.16,67.5,52.5,67.5z   M26.991,36.5H36v-12h-9.009v-6.729L15.264,30.5l11.728,12.728V36.5z   M50.836,43.228L62.563,30.5L50.836,17.771V24.5h-9.009v12  h9.009V43.228z" style="fill:#d3d3d3;"/> </svg></button><button type="button" id="dc-quick-exchange-btn" style="background-color: transparent;"  title="Generate & Send New Public Key"> <svg class="dc-svg iconActive-AKd_jq icon-1R19_H iconMargin-2YXk4F"   x="0px" y="0px" viewBox="0 0 58 58" width="20px" height="20px">  <path style="fill:#d3d3d3;"     d="M27.767,26.73c-2.428-2.291-3.766-5.392-3.766-8.729c0-6.617,5.383-12,12-12s12,5.383,12,12   c0,3.288-1.372,6.469-3.765,8.728l-1.373-1.455c2.023-1.909,   3.138-4.492,3.138-7.272c0-5.514-4.486-10-10-10s-10,4.486-10,10   c0,2.781,1.114,5.365,3.139,7.274L27.767,26.73z"/>  <path style="fill:#d3d3d3;"     d="M56.428,38.815c-0.937-0.695-2.188-0.896-3.435-0.55l-15.29,4.227   C37.891,42.028,38,41.522,38,   40.991c0-2.2-1.794-3.991-3.999-3.991h-9.377c-0.667-1-2.363-4-4.623-4H16v-0.999   C16,30.347,14.654,29,13,29H9c-1.654,0-3,1.347-3,3v17C6,50.655,7.346,52,9,52h4c1.654,0,   3-1.345,3-2.999v-0.753l12.14,8.201   c1.524,1.031,3.297,1.55,5.075,1.55c1.641,0,3.286-0.441,4.742-1.33l18.172-11.101C57.283,   44.864,58,43.587,58,42.233v-0.312   C58,40.688,57.427,39.556,56.428,38.815z M14,49C14,49.553,13.552,   50,13,50h-1v-4h-2v4H9c-0.552,0-1-0.447-1-0.999v-17   C8,31.449,8.448,31,9,31h4c0.552,0,1,0.449,1,1V49z M56,42.233c0,0.66-0.35,1.284-0.913,   1.628L36.915,54.962   c-2.367,1.443-5.37,1.376-7.655-0.17L16,45.833V35h4c1.06,0,2.469,2.034,3.088,3.409L23.354,39h10.646   C35.104,39,36,39.892,36,40.988C36,42.098,35.104,43,34,43H29h-5v2h5h5h2l17.525-4.807c0.637-0.18,   1.278-0.094,1.71,0.228   C55.722,40.781,56,41.328,56,41.922V42.233z"/>  <path style="fill:#d3d3d3;" d="M33,25.394v6.607C33,33.655,   34.347,35,36,35H38h1h4v-2h-4v-2h2v-2h-2v-3.577   c3.02-1.186,5-4.079,5-7.422c0-2.398-1.063-4.649-2.915-6.177c-1.85-1.524-4.283-2.134-6.683-1.668   c-3.155,0.614-5.671,3.153-6.261,6.318C27.39,20.523,29.933,24.041,33,   25.394z M30.108,16.84c0.44-2.364,2.319-4.262,4.677-4.721   c1.802-0.356,3.639,0.104,5.028,1.249S42,   16.202,42,18c0,2.702-1.719,5.011-4.276,5.745L37,23.954V33h-0.999   C35.449,33,35,32.553,35,32v-8.02l-0.689-0.225C31.822,22.943,29.509,20.067,30.108,16.84z"/>  <path d="M36,22c2.206,0,4-1.794,4-4s-1.794-4-4-4s-4,1.794-4,4S33.795,22,36,22z   M36,16c1.103,0,2,0.897,2,2s-0.897,2-2,2s-2-0.897-2-2S34.898,16,36,16z"/>  <circle style="fill:#d3d3d3;" cx="36" cy="18" r="3"/> </svg></button>',this.masterPasswordHtml='<div id="dc-master-overlay" class="dc-overlay"> <div id="dc-overlay-centerfield" class="dc-overlay-centerfield" style="top: 30%">  <h2 style="color:#ff0000;" id="dc-header-master-msg"></h2>  <br/><br/>  <span id="dc-prompt-master-msg"></span><br/>  <input type="password" class="dc-password-field" id="dc-db-password" title="Database Password"/>  <br/>  <div class="stat stat-bar">   <span id = "dc-master-status" class="stat-bar-rating" style="width: 0;"/>  </div>  <div class="dc-ruler-align">   <button class="dc-button" style="width:100%;" id="dc-unlock-database-btn"/>  </div>  <div class="dc-ruler-align">   <button class="dc-button dc-button-inverse"     style="width:100%;" id="dc-cancel-btn">Cancel</button>  </div> </div></div>',this.settingsMenuHtml='<div id="dc-overlay" class="dc-overlay"> <div id="dc-overlay-upload" class="dc-overlay-centerfield" style="display:none;">  <div class="dc-ruler-align">   <input type="text" class="dc-input-field" id="dc-file-path"       style="width: 100%;padding: 2px;margin-left: 4px;" readonly title="File Path"/>   <button class="dc-button dc-button-inverse" type="button" id="dc-select-file-path-btn"     style="top: -8px;"> . . .</button>  </div>  <textarea class="dc-textarea" rows="20" cols="128" id="dc-file-message-textarea"      placeholder="Enter any addition text to send with your message ..." maxlength="1820"></textarea>  <div class="dc-ruler-align" style="font-size:14px; padding-bottom:10px;">   <input id="dc-file-deletion-checkbox" class="ui-switch-checkbox" type="checkbox"       title="Add Deletion Link">   <span style="margin-top: 5px;">Send Deletion Link</span>  </div>  <div class="dc-ruler-align" style="font-size:14px; padding-bottom:10px;">   <input id="dc-file-name-random-checkbox" class="ui-switch-checkbox" type="checkbox" checked       title="Use Random File Name">   <span style="margin-top: 5px;">Randomize File Name</span>  </div>  <div class="stat stat-bar">   <span id = "dc-file-upload-status" class="stat-bar-rating" style="width: 0;"/>  </div>  <div class="dc-ruler-align">   <button class="dc-button" style="width:100%;" id="dc-file-upload-btn">Upload</button>  </div>  <div class="dc-ruler-align">   <button class="dc-button dc-button-inverse" style="width:100%;" id="dc-file-cancel-btn">    Close</button>  </div> </div> <div id="dc-overlay-password" class="dc-overlay-centerfield" style="display:none;">  <span>Primary Password:</span>  <input type="password" class="dc-password-field" id="dc-password-primary" placeholder="..."/><br/>  <span>Secondary Password:</span>  <input type="password" class="dc-password-field" id="dc-password-secondary" placeholder="..."/><br/>  <div class="dc-ruler-align">   <button class="dc-button" id="dc-save-pwd">Update Passwords</button>   <button class="dc-button dc-button-inverse" id="dc-reset-pwd">Reset Passwords</button>   <button class="dc-button dc-button-inverse" id="dc-cancel-btn">Cancel</button>  </div>  <button class="dc-button dc-button-inverse" style="width: 100%;" id="dc-cpy-pwds-btn">   Copy Current Passwords</button> </div> <div id="dc-update-overlay" class="dc-overlay-centerfield"   style="border: 1px solid;display: none">  <span>DiscordCrypt: Update Available</span>  <div class="dc-ruler-align">   <strong class="dc-update-field" id="dc-new-version"/>  </div>  <div class="dc-ruler-align">   <strong class="dc-update-field" id="dc-old-version"/>  </div>  <div class="dc-ruler-align">   <strong class="dc-update-field">Changelog:</strong></div>  <div class="dc-ruler-align">   <textarea class="dc-textarea" rows="20" cols="128" id="dc-changelog" readonly title="Update Changes ..."/>  </div>  <br>  <div class="dc-ruler-align">   <button class="dc-button" id="dc-restart-now-btn" style="width: 50%;">    Restart Discord Now</button>   <button class="dc-button dc-button-inverse" id="dc-restart-later-btn" style="width: 50%;">    Restart Discord Later</button>  </div> </div> <div id="dc-overlay-settings" class="dc-overlay-main" style="display: none;">  <div class="tab" id="dc-settings-tab">   <button class=\'dc-tab-link\' id="dc-plugin-settings-btn">Plugin Settings</button>   <button class=\'dc-tab-link\' id="dc-database-settings-btn">Database Settings</button>   <button class=\'dc-tab-link\' id="dc-exit-settings-btn" style="float:right;">\u2716</button>  </div>  <div class="tab-content" id="dc-plugin-settings-tab" style="display: block;">   <p style="text-align: center;">    <b>DiscordCrypt Settings</b>   </p>   <br/><br/>   <div class="dc-ruler-align">    <div class="dc-input-label">Primary Cipher:</div>    <select class="dc-input-field" id="dc-primary-cipher" title="Primary Cipher">     <option value="bf" selected>Blowfish ( 512-Bit )</option>     <option value="aes">AES ( 256-Bit )</option>     <option value="camel">Camellia ( 256-Bit )</option>     <option value="tdes">TripleDES ( 192-Bit )</option>     <option value="idea">IDEA ( 128-Bit )</option>    </select>   </div>   <div class="dc-ruler-align">    <div class="dc-input-label">Secondary Cipher:</div>    <select class="dc-input-field" id="dc-secondary-cipher" title="Secondary Cipher">     <option value="bf">Blowfish ( 512-Bit )</option>     <option value="aes">AES ( 256-Bit )</option>     <option value="camel">Camellia ( 256-Bit )</option>     <option value="idea">IDEA ( 256-Bit )</option>     <option value="tdes">TripleDES ( 192-Bit )</option>    </select>   </div>   <div class="dc-ruler-align">    <div class="dc-input-label">Cipher Padding Mode:</div>    <select class="dc-input-field" id="dc-settings-padding-mode" title="Cipher Padding Scheme">     <option value="pkc7">PKCS #7</option>     <option value="ans2">ANSI X9.23</option>     <option value="iso1">ISO 10126</option>     <option value="iso9">ISO 97971</option>    </select>   </div>   <div class="dc-ruler-align">    <div class="dc-input-label">Cipher Block Operation Mode:</div>    <select class="dc-input-field" id="dc-settings-cipher-mode" title="Cipher Block Operation Mode">     <option value="cbc">Cipher Block Chaining</option>     <option value="cfb">Cipher Feedback Mode</option>     <option value="ofb">Output Feedback Mode</option>    </select>   </div>   <div class="dc-ruler-align">    <div class="dc-input-label">Default Encryption Password:</div>    <input type="text" class="dc-input-field" id="dc-settings-default-pwd"        title="Default Encryption Password"/>   </div>   <div class="dc-ruler-align">    <div class="dc-input-label">Scanning Frequency:</div>    <input type="text" class="dc-input-field" id="dc-settings-scan-delay"        title="Scanning Frequency"/>   </div>   <div class="dc-ruler-align">    <div class="dc-input-label">Message Trigger:</div>    <input type="text" class="dc-input-field" id="dc-settings-encrypt-trigger" title="Message Trigger"/>   </div>   <div class="dc-hint">    <p>The suffix at the end of a typed message to indicate whether to encrypt the text.</p>    <p>Example: <u>This message will be encrypted.|ENC</u></p>   </div>   <div class="dc-ruler-align">    <div class="dc-input-label">Timed Message Expiration:</div>    <input type="number" class="dc-input-field" id="dc-settings-timed-expire"        title="Timed Message Expiration"/>   </div>   <div class="dc-hint">    <p>This indicates how long after an encrypted message is sent, should it be deleted in minutes.</p>    <p><u>Set this to "0" to disable timed messages.</u></p>   </div>   <div class="dc-ruler-align">    <div class="dc-input-label">New Master Database Password:</div>    <input type="password" class="dc-input-field" id="dc-master-password"        title="New Master Database Password"/>   </div>   <div class="dc-ruler-align">    <div class="dc-input-label">Use Embedded Messages:</div>    <input type="checkbox" class="dc-checkbox" id="dc-embed-enabled"        title="Use Embedded Messages"/>   </div>   <div class="dc-hint">    <p>If enabled, send all encrypted messages using embeds.</p>    <p>     <b style="color: #f00">WARNING:</b>     <b> Using this option may result in your embedded permissions being globally revoked.</b>    </p>   </div>   <div class="dc-ruler-align">    <button id="dc-settings-save-btn" class="dc-button">Save & Apply</button>    <button id="dc-settings-reset-btn" class="dc-button dc-button-inverse">     Reset Settings</button>   </div>   <br/><br/><br/><br/>  </div>  <div class="tab-content" id="dc-database-settings-tab">   <p style="text-align: center;">    <b>Database Settings</b>   </p>   <br/><br/>   <div class="dc-scroll-table">    <table class="dc-table">     <thead>     <tr>      <th><b>Channel</b></th>      <th><b>Name</b></th>      <th><b>Options</b></th>     </tr>     </thead>     <tbody id="dc-database-entries">      <tr>       <td>Placeholder</td>       <td>Placeholder</td>       <td><button class="dc-button dc-button-inverse dc-button-small">Delete Entry</button></td>      </tr>     </tbody>    </table>   </div>   <br/><br/>   <div class="dc-ruler-align">    <button class="dc-button" id="dc-import-database-btn">Import Database(s)</button>    <button class="dc-button dc-button-inverse" id="dc-export-database-btn">Export Database</button>    <button class="dc-button dc-button-inverse" id="dc-erase-entries-btn">Erase Entries</button>   </div>  </div> </div> <div id="dc-overlay-exchange" class="dc-overlay-main" style="display: none;">  <div class="tab" id="dc-exchange-tab">   <button class=\'dc-tab-link\' id="dc-tab-info-btn">Info</button>   <button class=\'dc-tab-link\' id="dc-tab-keygen-btn">Key Generation</button>   <button class=\'dc-tab-link\' id="dc-tab-handshake-btn">Secret Computation</button>   <button class=\'dc-tab-link\' id="dc-exit-exchange-btn" style="float:right;">\u2716</button>  </div>  <div class="tab-content" id="dc-about-tab" style="display: block;">   <p style="text-align: center;">    <b>Key Exchanger</b>   </p>   <br/>   <strong>What is this used for?</strong>   <ul class="dc-list">    <li>Simplifying the process or generating strong passwords for each user of DiscordCrypt     requires a secure channel to exchange these keys.</li>    <li>Using this generator, you may create new keys using standard algorithms such as     DH or ECDH for manual handshaking.</li>    <li>Follow the steps below and you can generate a password between channels or users     while being able to publicly post the messages.</li>    <li>This generator uses secure hash algorithms ( SHA-256 and SHA-512 ) in tandem with     the Scrypt KDF function to derive two keys.</li>   </ul>   <br/>   <strong>How do I use this?</strong>   <ul class="dc-list">    <li>Generate a key pair using the specified algorithm and key size on the     "Key Generation" tab.</li>    <li>Give your partner your public key by clicking the "Send Public Key" button.</li>    <li>Ask your partner to give you their public key using the same step above.</li>    <li>Copy your partner\'s public key and paste it in the "Secret Computation" tab and     select "Compute Secret Keys".</li>    <li>Wait for <span style="text-decoration: underline;color: #ff0000;">BOTH</span>     the primary and secondary keys to be generated.</li>    <li>A status bar is provided to easily tell you when both passwords     have been generated.</li>    <li>Click the "Apply Generated Passwords" button to apply both passwords to     the current user or channel.</li>   </ul>   <strong>Algorithms Supported:</strong>   <ul class="dc-list">    <li>     <a title="Diffie\u2013Hellman key exchange"        href="https://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman_key_exchange"        target="_blank" rel="noopener">Diffie-Hellman ( DH )</a>    </li>    <li>     <a title="Elliptic curve Diffie\u2013Hellman"        href="https://en.wikipedia.org/wiki/Elliptic_curve_Diffie%E2%80%93Hellman"        target="_blank" rel="noopener">Elliptic Curve Diffie-Hellman ( ECDH )</a>    </li>   </ul>   <span style="text-decoration: underline; color: #ff0000;">       <strong>DO NOT:</strong>      </span>   <ul class="dc-list dc-list-red">    <li>     <strong>Post your private key. If you do, generate a new one IMMEDIATELY.</strong>    </li>    <li>     <strong>Alter your public key or have your partner alter theirs in any way.</strong>    </li>    <li>     <strong>Insert a random public key.</strong>    </li>   </ul>   <br/><br/><br/><br/>  </div>  <div class="tab-content" id="dc-keygen-tab">   <p style="text-align: center;">    <b style="font-size: large;">Secure Key Generation</b>   </p>   <br/>   <strong>Exchange Algorithm:</strong>   <select id="dc-keygen-method" title="Exchange Algorithm">    <option value="dh" selected>Diffie-Hellman</option>    <option value="ecdh">Elliptic-Curve Diffie-Hellman</option>   </select>   <br/><br/>   <strong>Key Length ( Bits ):</strong>   <select id="dc-keygen-algorithm" title="Key Length">    <option value="768">768</option>    <option value="1024">1024</option>    <option value="1536">1536</option>    <option value="2048">2048</option>    <option value="3072">3072</option>    <option value="4096">4096</option>    <option value="6144">6144</option>    <option value="8192" selected>8192</option>   </select>   <br/><br/>   <div class="dc-ruler-align">    <button id="dc-keygen-gen-btn" class="dc-button">Generate</button>    <button id="dc-keygen-clear-btn" class="dc-button dc-button-inverse">Clear</button>   </div>   <br/><br/><br/>   <strong>Private Key: (    <span style="text-decoration: underline; color: #ff0000;">KEEP SECRET</span>    )</strong><br/>   <textarea id="dc-priv-key-ta" rows="8" cols="128" maxsize="8192"       unselectable="on" disabled readonly title="Private Key"/>   <br/><br/>   <strong>Public Key:</strong><br/>   <textarea id="dc-pub-key-ta" rows="8" cols="128" maxsize="8192"       unselectable="on" disabled readonly title="Public Key"/>   <br/><br/>   <div class="dc-ruler-align">    <button id="dc-keygen-send-pub-btn" class="dc-button">Send Public Key</button>   </div>   <br/>   <ul class="dc-list dc-list-red">    <li>Never rely on copying these keys. Use the "Send Public Key" button     to send your key.</li>    <li>Public keys are automatically encoded with a random salts.</li>    <li>Posting these keys directly won\'t work since they aren\'t encoded     in the format required.</li>   </ul>   <br/><br/><br/><br/>  </div>  <div class="tab-content" id="dc-handshake-tab">   <p style="text-align: center;">    <b style="font-size: large;">Key Derivation</b>   </p>   <br/>   <p>    <span style="text-decoration: underline; color: #ff0000;">     <strong>NOTE:</strong>    </span>   </p>   <ul class="dc-list dc-list-red">    <li>Copy your partner\'s private key EXACTLY as it was posted.</li>    <li>Your last generated private key from the "Key Generation" tab     will be used to compute these keys.</li>   </ul>   <br/>   <strong>Partner\'s Public Key:</strong><br/>   <textarea id="dc-handshake-ppk" rows="8" cols="128" maxsize="16384" title="Partner\'s Public Key"/>   <br/><br/>   <div class="dc-ruler-align">    <button id="dc-handshake-paste-btn" class="dc-button dc-button-inverse">     Paste From Clipboard</button>    <button id="dc-handshake-compute-btn" class="dc-button">Compute Secret Keys</button>   </div>   <ul class="dc-list dc-list-red">    <li id="dc-handshake-algorithm">...</li>    <li id="dc-handshake-salts">...</li>    <li id="dc-handshake-secret">...</li>   </ul>   <br/>   <strong id="dc-handshake-prim-lbl">Primary Secret:</strong><br/>   <textarea id="dc-handshake-primary-key" rows="1" columns="128" maxsize="32768"       style="max-height: 14px;user-select: none;" unselectable="on" disabled       title="Primary Secret"/>   <br/><br/>   <strong id="dc-handshake-sec-lbl">Secondary Secret:</strong><br/>   <textarea id="dc-handshake-secondary-key" rows="1" columns="128" maxsize="32768"       style="max-height: 14px;user-select: none;" unselectable="on" disabled       title="Secondary Secret"/>   <br/><br/>   <div class="stat stat-bar" style="width:70%;">    <span id="dc-exchange-status" class="stat-bar-rating" style="width: 0;"/>   </div><br/>   <div class="dc-ruler-align">    <button id="dc-handshake-cpy-keys-btn" class="dc-button dc-button-inverse">     Copy Keys & Nuke</button>    <button id="dc-handshake-apply-keys-btn" class="dc-button">     Apply Generated Passwords</button>   </div>   <br/><br/><br/><br/>  </div> </div></div>',this.unlockIcon="PHN2ZyBjbGFzcz0iZGMtc3ZnIiBmaWxsPSJsaWdodGdyZXkiIGhlaWdodD0iMjBweCIgdmlld0JveD0iMCAwIDI0IDI0IiB3aWR0aD0iMjBweCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTIgMTdjMS4xIDAgMi0uOSAyLTJzLS45LTItMi0yLTIgLjktMiAyIC45IDIgMiAyem02LTloLTFWNmMwLTIuNzYtMi4yNC01LTUtNVM3IDMuMjQgNyA2aDEuOWMwLTEuNzEgMS4zOS0zLjEgMy4xLTMuMSAxLjcxIDAgMy4xIDEuMzkgMy4xIDMuMXYySDZjLTEuMSAwLTIgLjktMiAydjEwYzAgMS4xLjkgMiAyIDJoMTJjMS4xIDAgMi0uOSAyLTJWMTBjMC0xLjEtLjktMi0yLTJ6bTAgMTJINlYxMGgxMnYxMHoiPjwvcGF0aD48L3N2Zz4=",this.lockIcon="PHN2ZyBjbGFzcz0iZGMtc3ZnIiBmaWxsPSJsaWdodGdyZXkiIGhlaWdodD0iMjBweCIgdmlld0JveD0iMCAwIDI0IDI0IiB3aWR0aD0iMjBweCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZGVmcz48cGF0aCBkPSJNMCAwaDI0djI0SDBWMHoiIGlkPSJhIi8+PC9kZWZzPjxjbGlwUGF0aCBpZD0iYiI+PHVzZSBvdmVyZmxvdz0idmlzaWJsZSIgeGxpbms6aHJlZj0iI2EiLz48L2NsaXBQYXRoPjxwYXRoIGNsaXAtcGF0aD0idXJsKCNiKSIgZD0iTTEyIDE3YzEuMSAwIDItLjkgMi0ycy0uOS0yLTItMi0yIC45LTIgMiAuOSAyIDIgMnptNi05aC0xVjZjMC0yLjc2LTIuMjQtNS01LTVTNyAzLjI0IDcgNnYySDZjLTEuMSAwLTIgLjktMiAydjEwYzAgMS4xLjkgMiAyIDJoMTJjMS4xIDAgMi0uOSAyLTJWMTBjMC0xLjEtLjktMi0yLTJ6TTguOSA2YzAtMS43MSAxLjM5LTMuMSAzLjEtMy4xczMuMSAxLjM5IDMuMSAzLjF2Mkg4LjlWNnpNMTggMjBINlYxMGgxMnYxMHoiLz48L3N2Zz4=",this.libraries={"currify.js":{requiresElectron:!1,requiresBrowser:!0,code:'!function(n){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=n();else if("function"==typeof define&&define.amd)define([],n);else{let r;(r="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).currify=n()}}(function(){var n,r,e;return function n(r,e,t){function o(f,u){if(!e[f]){if(!r[f]){var c="function"==typeof require&&require;if(!u&&c)return c(f,!0);if(i)return i(f,!0);var l=new Error(`Cannot find module \'${f}\'`);throw l.code="MODULE_NOT_FOUND",l}var p=e[f]={exports:{}};r[f][0].call(p.exports,function(n){var e=r[f][1][n];return o(e||n)},p,p.exports,n,r,e,t)}return e[f].exports}var i="function"==typeof require&&require;for(let n=0;n<t.length;n++)o(t[n]);return o}({currify:[function(n,r,e){"use strict";var t=function n(r){return[function(n){return r.apply(void 0,arguments)},function(n,e){return r.apply(void 0,arguments)},function(n,e,t){return r.apply(void 0,arguments)},function(n,e,t,o){return r.apply(void 0,arguments)},function(n,e,t,o,i){return r.apply(void 0,arguments)}]};function o(n){if("function"!=typeof n)throw Error("fn should be function!")}r.exports=function n(r){for(var e=arguments.length,i=Array(e>1?e-1:0),f=1;f<e;f++)i[f-1]=arguments[f];if(o(r),i.length>=r.length)return r.apply(void 0,i);var u=function e(){return n.apply(void 0,[r].concat(i,Array.prototype.slice.call(arguments)))},c=r.length-i.length-1,l;return t(u)[c]||u}},{}]},{},["currify"])("currify")});'},"curve25519.js":{requiresElectron:!0,requiresBrowser:!1,code:'"use strict";global.Curve25519=class t{static init_25519_constants(t){const r=new Float64Array(16);if(t)for(let n=0;n<t.length;n++)r[n]=t[n];return r}static gf0(){return t.init_25519_constants()}static gf1(){return t.init_25519_constants([1])}static _121665(){return t.init_25519_constants([56129,1])}static D(){return t.init_25519_constants([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995])}static D2(){return t.init_25519_constants([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222])}static X(){return t.init_25519_constants([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553])}static Y(){return t.init_25519_constants([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214])}static I(){return t.init_25519_constants([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139])}static checkArrayTypes(){let t;for(let r=0;r<arguments.length;r++)if("[object Uint8Array]"!==(t=Object.prototype.toString.call(arguments[r])))throw new TypeError(`unexpected type ${t}, use Uint8Array`)}static crypto_verify_32(t,r,n,o){function s(t,r,n,o,s){let e,a=0;for(e=0;e<s;e++)a|=t[r+e]^n[o+e];return(1&a-1>>>8)-1}return s(t,r,n,o,32)}static set25519(t,r){let n;for(n=0;n<16;n++)t[n]=0|r[n]}static sel25519(t,r,n){let o;const s=~(n-1);for(let n=0;n<16;n++)o=s&(t[n]^r[n]),t[n]^=o,r[n]^=o}static pack25519(r,n){function o(t){let r,n,o=1;for(r=0;r<16;r++)n=t[r]+o+65535,o=Math.floor(n/65536),t[r]=n-65536*o;t[0]+=o-1+37*(o-1)}let s,e,a;const i=t.init_25519_constants(),c=t.init_25519_constants();for(s=0;s<16;s++)c[s]=n[s];for(o(c),o(c),o(c),e=0;e<2;e++){for(i[0]=c[0]-65517,s=1;s<15;s++)i[s]=c[s]-65535-(i[s-1]>>16&1),i[s-1]&=65535;i[15]=c[15]-32767-(i[14]>>16&1),a=i[15]>>16&1,i[14]&=65535,t.sel25519(c,i,1-a)}for(s=0;s<16;s++)r[2*s]=255&c[s],r[2*s+1]=c[s]>>8}static par25519(r){const n=new Uint8Array(32);return t.pack25519(n,r),1&n[0]}static unpack25519(t,r){let n;for(n=0;n<16;n++)t[n]=r[2*n]+(r[2*n+1]<<8);t[15]&=32767}static blockadd(t,r,n){for(let o=0;o<16;o++)t[o]=r[o]+n[o]}static blocksub(t,r,n){for(let o=0;o<16;o++)t[o]=r[o]-n[o]}static blockround(t,r,n){let o,s,e=0,a=0,i=0,c=0,f=0,l=0,u=0,_=0,h=0,k=0,b=0,y=0,d=0,w=0,g=0,A=0,p=0,m=0,B=0,U=0,M=0,v=0,E=0,T=0,K=0,S=0,F=0,I=0,P=0,D=0,L=0;const X=n[0],Y=n[1],j=n[2],x=n[3],C=n[4],O=n[5],$=n[6],q=n[7],z=n[8],G=n[9],H=n[10],J=n[11],N=n[12],Q=n[13],R=n[14],V=n[15];e+=(o=r[0])*X,a+=o*Y,i+=o*j,c+=o*x,f+=o*C,l+=o*O,u+=o*$,_+=o*q,h+=o*z,k+=o*G,b+=o*H,y+=o*J,d+=o*N,w+=o*Q,g+=o*R,A+=o*V,a+=(o=r[1])*X,i+=o*Y,c+=o*j,f+=o*x,l+=o*C,u+=o*O,_+=o*$,h+=o*q,k+=o*z,b+=o*G,y+=o*H,d+=o*J,w+=o*N,g+=o*Q,A+=o*R,p+=o*V,i+=(o=r[2])*X,c+=o*Y,f+=o*j,l+=o*x,u+=o*C,_+=o*O,h+=o*$,k+=o*q,b+=o*z,y+=o*G,d+=o*H,w+=o*J,g+=o*N,A+=o*Q,p+=o*R,m+=o*V,c+=(o=r[3])*X,f+=o*Y,l+=o*j,u+=o*x,_+=o*C,h+=o*O,k+=o*$,b+=o*q,y+=o*z,d+=o*G,w+=o*H,g+=o*J,A+=o*N,p+=o*Q,m+=o*R,B+=o*V,f+=(o=r[4])*X,l+=o*Y,u+=o*j,_+=o*x,h+=o*C,k+=o*O,b+=o*$,y+=o*q,d+=o*z,w+=o*G,g+=o*H,A+=o*J,p+=o*N,m+=o*Q,B+=o*R,U+=o*V,l+=(o=r[5])*X,u+=o*Y,_+=o*j,h+=o*x,k+=o*C,b+=o*O,y+=o*$,d+=o*q,w+=o*z,g+=o*G,A+=o*H,p+=o*J,m+=o*N,B+=o*Q,U+=o*R,M+=o*V,u+=(o=r[6])*X,_+=o*Y,h+=o*j,k+=o*x,b+=o*C,y+=o*O,d+=o*$,w+=o*q,g+=o*z,A+=o*G,p+=o*H,m+=o*J,B+=o*N,U+=o*Q,M+=o*R,v+=o*V,_+=(o=r[7])*X,h+=o*Y,k+=o*j,b+=o*x,y+=o*C,d+=o*O,w+=o*$,g+=o*q,A+=o*z,p+=o*G,m+=o*H,B+=o*J,U+=o*N,M+=o*Q,v+=o*R,E+=o*V,h+=(o=r[8])*X,k+=o*Y,b+=o*j,y+=o*x,d+=o*C,w+=o*O,g+=o*$,A+=o*q,p+=o*z,m+=o*G,B+=o*H,U+=o*J,M+=o*N,v+=o*Q,E+=o*R,T+=o*V,k+=(o=r[9])*X,b+=o*Y,y+=o*j,d+=o*x,w+=o*C,g+=o*O,A+=o*$,p+=o*q,m+=o*z,B+=o*G,U+=o*H,M+=o*J,v+=o*N,E+=o*Q,T+=o*R,K+=o*V,b+=(o=r[10])*X,y+=o*Y,d+=o*j,w+=o*x,g+=o*C,A+=o*O,p+=o*$,m+=o*q,B+=o*z,U+=o*G,M+=o*H,v+=o*J,E+=o*N,T+=o*Q,K+=o*R,S+=o*V,y+=(o=r[11])*X,d+=o*Y,w+=o*j,g+=o*x,A+=o*C,p+=o*O,m+=o*$,B+=o*q,U+=o*z,M+=o*G,v+=o*H,E+=o*J,T+=o*N,K+=o*Q,S+=o*R,F+=o*V,d+=(o=r[12])*X,w+=o*Y,g+=o*j,A+=o*x,p+=o*C,m+=o*O,B+=o*$,U+=o*q,M+=o*z,v+=o*G,E+=o*H,T+=o*J,K+=o*N,S+=o*Q,F+=o*R,I+=o*V,w+=(o=r[13])*X,g+=o*Y,A+=o*j,p+=o*x,m+=o*C,B+=o*O,U+=o*$,M+=o*q,v+=o*z,E+=o*G,T+=o*H,K+=o*J,S+=o*N,F+=o*Q,I+=o*R,P+=o*V,g+=(o=r[14])*X,A+=o*Y,p+=o*j,m+=o*x,B+=o*C,U+=o*O,M+=o*$,v+=o*q,E+=o*z,T+=o*G,K+=o*H,S+=o*J,F+=o*N,I+=o*Q,P+=o*R,D+=o*V,A+=(o=r[15])*X,a+=38*(m+=o*j),i+=38*(B+=o*x),c+=38*(U+=o*C),f+=38*(M+=o*O),l+=38*(v+=o*$),u+=38*(E+=o*q),_+=38*(T+=o*z),h+=38*(K+=o*G),k+=38*(S+=o*H),b+=38*(F+=o*J),y+=38*(I+=o*N),d+=38*(P+=o*Q),w+=38*(D+=o*R),g+=38*(L+=o*V),e=(o=(e+=38*(p+=o*Y))+(s=1)+65535)-65536*(s=Math.floor(o/65536)),a=(o=a+s+65535)-65536*(s=Math.floor(o/65536)),i=(o=i+s+65535)-65536*(s=Math.floor(o/65536)),c=(o=c+s+65535)-65536*(s=Math.floor(o/65536)),f=(o=f+s+65535)-65536*(s=Math.floor(o/65536)),l=(o=l+s+65535)-65536*(s=Math.floor(o/65536)),u=(o=u+s+65535)-65536*(s=Math.floor(o/65536)),_=(o=_+s+65535)-65536*(s=Math.floor(o/65536)),h=(o=h+s+65535)-65536*(s=Math.floor(o/65536)),k=(o=k+s+65535)-65536*(s=Math.floor(o/65536)),b=(o=b+s+65535)-65536*(s=Math.floor(o/65536)),y=(o=y+s+65535)-65536*(s=Math.floor(o/65536)),d=(o=d+s+65535)-65536*(s=Math.floor(o/65536)),w=(o=w+s+65535)-65536*(s=Math.floor(o/65536)),g=(o=g+s+65535)-65536*(s=Math.floor(o/65536)),A=(o=A+s+65535)-65536*(s=Math.floor(o/65536)),e=(o=(e+=s-1+37*(s-1))+(s=1)+65535)-65536*(s=Math.floor(o/65536)),a=(o=a+s+65535)-65536*(s=Math.floor(o/65536)),i=(o=i+s+65535)-65536*(s=Math.floor(o/65536)),c=(o=c+s+65535)-65536*(s=Math.floor(o/65536)),f=(o=f+s+65535)-65536*(s=Math.floor(o/65536)),l=(o=l+s+65535)-65536*(s=Math.floor(o/65536)),u=(o=u+s+65535)-65536*(s=Math.floor(o/65536)),_=(o=_+s+65535)-65536*(s=Math.floor(o/65536)),h=(o=h+s+65535)-65536*(s=Math.floor(o/65536)),k=(o=k+s+65535)-65536*(s=Math.floor(o/65536)),b=(o=b+s+65535)-65536*(s=Math.floor(o/65536)),y=(o=y+s+65535)-65536*(s=Math.floor(o/65536)),d=(o=d+s+65535)-65536*(s=Math.floor(o/65536)),w=(o=w+s+65535)-65536*(s=Math.floor(o/65536)),g=(o=g+s+65535)-65536*(s=Math.floor(o/65536)),A=(o=A+s+65535)-65536*(s=Math.floor(o/65536)),e+=s-1+37*(s-1),t[0]=e,t[1]=a,t[2]=i,t[3]=c,t[4]=f,t[5]=l,t[6]=u,t[7]=_,t[8]=h,t[9]=k,t[10]=b,t[11]=y,t[12]=d,t[13]=w,t[14]=g,t[15]=A}static blockround_dest(r,n){t.blockround(r,n,n)}static inv25519(r,n){const o=t.init_25519_constants();let s;for(s=0;s<16;s++)o[s]=n[s];for(s=253;s>=0;s--)t.blockround_dest(o,o),2!==s&&4!==s&&t.blockround(o,o,n);for(s=0;s<16;s++)r[s]=o[s]}static crypto_scalarmult(r,n,o){const s=new Uint8Array(32),e=new Float64Array(80);let a,i;const c=t.init_25519_constants(),f=t.init_25519_constants(),l=t.init_25519_constants(),u=t.init_25519_constants(),_=t.init_25519_constants(),h=t.init_25519_constants();for(i=0;i<31;i++)s[i]=n[i];for(s[31]=127&n[31]|64,s[0]&=248,t.unpack25519(e,o),i=0;i<16;i++)f[i]=e[i],u[i]=c[i]=l[i]=0;for(c[0]=u[0]=1,i=254;i>=0;--i)a=s[i>>>3]>>>(7&i)&1,t.sel25519(c,f,a),t.sel25519(l,u,a),t.blockadd(_,c,l),t.blocksub(c,c,l),t.blockadd(l,f,u),t.blocksub(f,f,u),t.blockround_dest(u,_),t.blockround_dest(h,c),t.blockround(c,l,c),t.blockround(l,f,_),t.blockadd(_,c,l),t.blocksub(c,c,l),t.blockround_dest(f,c),t.blocksub(l,u,h),t.blockround(c,l,t._121665()),t.blockadd(c,c,u),t.blockround(l,l,c),t.blockround(c,u,h),t.blockround(u,f,e),t.blockround_dest(f,_),t.sel25519(c,f,a),t.sel25519(l,u,a);for(i=0;i<16;i++)e[i+16]=c[i],e[i+32]=l[i],e[i+48]=f[i],e[i+64]=u[i];const k=e.subarray(32),b=e.subarray(16);return t.inv25519(k,k),t.blockround(b,b,k),t.pack25519(r,b),0}static crypto_hash(t,r,n){function o(t,r,n,o){t[r]=n>>24&255,t[r+1]=n>>16&255,t[r+2]=n>>8&255,t[r+3]=255&n,t[r+4]=o>>24&255,t[r+5]=o>>16&255,t[r+6]=o>>8&255,t[r+7]=255&o}function s(t,r,n,o){const s=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],e=new Int32Array(16),a=new Int32Array(16);let i,c,f,l,u,_,h,k,b,y,d,w,g,A,p,m,B,U,M,v,E,T,K,S,F,I,P=t[0],D=t[1],L=t[2],X=t[3],Y=t[4],j=t[5],x=t[6],C=t[7],O=r[0],$=r[1],q=r[2],z=r[3],G=r[4],H=r[5],J=r[6],N=r[7],Q=0;for(;o>=128;){for(M=0;M<16;M++)v=8*M+Q,e[M]=n[v+0]<<24|n[v+1]<<16|n[v+2]<<8|n[v+3],a[M]=n[v+4]<<24|n[v+5]<<16|n[v+6]<<8|n[v+7];for(M=0;M<80;M++)if(i=P,c=D,f=L,l=X,u=Y,_=j,h=x,k=C,b=O,y=$,d=q,w=z,g=G,A=H,p=J,m=N,K=65535&(T=N),S=T>>>16,F=65535&(E=C),I=E>>>16,K+=65535&(T=(G>>>14|Y<<18)^(G>>>18|Y<<14)^(Y>>>9|G<<23)),S+=T>>>16,F+=65535&(E=(Y>>>14|G<<18)^(Y>>>18|G<<14)^(G>>>9|Y<<23)),I+=E>>>16,K+=65535&(T=G&H^~G&J),S+=T>>>16,F+=65535&(E=Y&j^~Y&x),I+=E>>>16,K+=65535&(T=s[2*M+1]),S+=T>>>16,F+=65535&(E=s[2*M]),I+=E>>>16,E=e[M%16],S+=(T=a[M%16])>>>16,F+=65535&E,I+=E>>>16,F+=(S+=(K+=65535&T)>>>16)>>>16,K=65535&(T=U=65535&K|S<<16),S=T>>>16,F=65535&(E=B=65535&F|(I+=F>>>16)<<16),I=E>>>16,K+=65535&(T=(O>>>28|P<<4)^(P>>>2|O<<30)^(P>>>7|O<<25)),S+=T>>>16,F+=65535&(E=(P>>>28|O<<4)^(O>>>2|P<<30)^(O>>>7|P<<25)),I+=E>>>16,S+=(T=O&$^O&q^$&q)>>>16,F+=65535&(E=P&D^P&L^D&L),I+=E>>>16,k=65535&(F+=(S+=(K+=65535&T)>>>16)>>>16)|(I+=F>>>16)<<16,m=65535&K|S<<16,K=65535&(T=w),S=T>>>16,F=65535&(E=l),I=E>>>16,S+=(T=U)>>>16,F+=65535&(E=B),I+=E>>>16,D=i,L=c,X=f,Y=l=65535&(F+=(S+=(K+=65535&T)>>>16)>>>16)|(I+=F>>>16)<<16,j=u,x=_,C=h,P=k,$=b,q=y,z=d,G=w=65535&K|S<<16,H=g,J=A,N=p,O=m,M%16==15)for(v=0;v<16;v++)E=e[v],K=65535&(T=a[v]),S=T>>>16,F=65535&E,I=E>>>16,E=e[(v+9)%16],K+=65535&(T=a[(v+9)%16]),S+=T>>>16,F+=65535&E,I+=E>>>16,B=e[(v+1)%16],K+=65535&(T=((U=a[(v+1)%16])>>>1|B<<31)^(U>>>8|B<<24)^(U>>>7|B<<25)),S+=T>>>16,F+=65535&(E=(B>>>1|U<<31)^(B>>>8|U<<24)^B>>>7),I+=E>>>16,B=e[(v+14)%16],S+=(T=((U=a[(v+14)%16])>>>19|B<<13)^(B>>>29|U<<3)^(U>>>6|B<<26))>>>16,F+=65535&(E=(B>>>19|U<<13)^(U>>>29|B<<3)^B>>>6),I+=E>>>16,I+=(F+=(S+=(K+=65535&T)>>>16)>>>16)>>>16,e[v]=65535&F|I<<16,a[v]=65535&K|S<<16;K=65535&(T=O),S=T>>>16,F=65535&(E=P),I=E>>>16,E=t[0],S+=(T=r[0])>>>16,F+=65535&E,I+=E>>>16,I+=(F+=(S+=(K+=65535&T)>>>16)>>>16)>>>16,t[0]=P=65535&F|I<<16,r[0]=O=65535&K|S<<16,K=65535&(T=$),S=T>>>16,F=65535&(E=D),I=E>>>16,E=t[1],S+=(T=r[1])>>>16,F+=65535&E,I+=E>>>16,I+=(F+=(S+=(K+=65535&T)>>>16)>>>16)>>>16,t[1]=D=65535&F|I<<16,r[1]=$=65535&K|S<<16,K=65535&(T=q),S=T>>>16,F=65535&(E=L),I=E>>>16,E=t[2],S+=(T=r[2])>>>16,F+=65535&E,I+=E>>>16,I+=(F+=(S+=(K+=65535&T)>>>16)>>>16)>>>16,t[2]=L=65535&F|I<<16,r[2]=q=65535&K|S<<16,K=65535&(T=z),S=T>>>16,F=65535&(E=X),I=E>>>16,E=t[3],S+=(T=r[3])>>>16,F+=65535&E,I+=E>>>16,I+=(F+=(S+=(K+=65535&T)>>>16)>>>16)>>>16,t[3]=X=65535&F|I<<16,r[3]=z=65535&K|S<<16,K=65535&(T=G),S=T>>>16,F=65535&(E=Y),I=E>>>16,E=t[4],S+=(T=r[4])>>>16,F+=65535&E,I+=E>>>16,I+=(F+=(S+=(K+=65535&T)>>>16)>>>16)>>>16,t[4]=Y=65535&F|I<<16,r[4]=G=65535&K|S<<16,K=65535&(T=H),S=T>>>16,F=65535&(E=j),I=E>>>16,E=t[5],S+=(T=r[5])>>>16,F+=65535&E,I+=E>>>16,I+=(F+=(S+=(K+=65535&T)>>>16)>>>16)>>>16,t[5]=j=65535&F|I<<16,r[5]=H=65535&K|S<<16,K=65535&(T=J),S=T>>>16,F=65535&(E=x),I=E>>>16,E=t[6],S+=(T=r[6])>>>16,F+=65535&E,I+=E>>>16,I+=(F+=(S+=(K+=65535&T)>>>16)>>>16)>>>16,t[6]=x=65535&F|I<<16,r[6]=J=65535&K|S<<16,K=65535&(T=N),S=T>>>16,F=65535&(E=C),I=E>>>16,E=t[7],S+=(T=r[7])>>>16,F+=65535&E,I+=E>>>16,I+=(F+=(S+=(K+=65535&T)>>>16)>>>16)>>>16,t[7]=C=65535&F|I<<16,r[7]=N=65535&K|S<<16,Q+=128,o-=128}return o}const e=new Int32Array(8),a=new Int32Array(8),i=new Uint8Array(256);let c;const f=n;for(e[0]=1779033703,e[1]=3144134277,e[2]=1013904242,e[3]=2773480762,e[4]=1359893119,e[5]=2600822924,e[6]=528734635,e[7]=1541459225,a[0]=4089235720,a[1]=2227873595,a[2]=4271175723,a[3]=1595750129,a[4]=2917565137,a[5]=725511199,a[6]=4215389547,a[7]=327033209,s(e,a,r,n),n%=128,c=0;c<n;c++)i[c]=r[f-n+c];for(i[n]=128,i[(n=256-128*(n<112?1:0))-9]=0,o(i,n-8,f/536870912|0,f<<3),s(e,a,i,n),c=0;c<8;c++)o(t,8*c,e[c],a[c]);return 0}static add(r,n){const o=t.init_25519_constants(),s=t.init_25519_constants(),e=t.init_25519_constants(),a=t.init_25519_constants(),i=t.init_25519_constants(),c=t.init_25519_constants(),f=t.init_25519_constants(),l=t.init_25519_constants(),u=t.init_25519_constants();t.blocksub(o,r[1],r[0]),t.blocksub(u,n[1],n[0]),t.blockround(o,o,u),t.blockadd(s,r[0],r[1]),t.blockadd(u,n[0],n[1]),t.blockround(s,s,u),t.blockround(e,r[3],n[3]),t.blockround(e,e,t.D2()),t.blockround(a,r[2],n[2]),t.blockadd(a,a,a),t.blocksub(i,s,o),t.blocksub(c,a,e),t.blockadd(f,a,e),t.blockadd(l,s,o),t.blockround(r[0],i,c),t.blockround(r[1],l,f),t.blockround(r[2],f,c),t.blockround(r[3],i,l)}static pack(r,n){const o=t.init_25519_constants(),s=t.init_25519_constants(),e=t.init_25519_constants();t.inv25519(e,n[2]),t.blockround(o,n[0],e),t.blockround(s,n[1],e),t.pack25519(r,s),r[31]^=t.par25519(o)<<7}static scalarmult(r,n,o){function s(r,n,o){let s;for(s=0;s<4;s++)t.sel25519(r[s],n[s],o)}let e,a;for(t.set25519(r[0],t.gf0()),t.set25519(r[1],t.gf1()),t.set25519(r[2],t.gf1()),t.set25519(r[3],t.gf0()),a=255;a>=0;--a)s(r,n,e=o[a/8|0]>>(7&a)&1),add(n,r),add(r,r),s(r,n,e)}static scalarbase(r,n){const o=[t.init_25519_constants(),t.init_25519_constants(),t.init_25519_constants(),t.init_25519_constants()];t.set25519(o[0],t.X()),t.set25519(o[1],t.Y()),t.set25519(o[2],t.gf1()),t.blockround(o[3],t.X(),t.Y()),t.scalarmult(r,o,n)}static modL(t,r){const n=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);let o,s,e,a;for(s=63;s>=32;--s){for(o=0,e=s-32,a=s-12;e<a;++e)r[e]+=o-16*r[s]*n[e-(s-32)],o=r[e]+128>>8,r[e]-=256*o;r[e]+=o,r[s]=0}for(o=0,e=0;e<32;e++)r[e]+=o-(r[31]>>4)*n[e],o=r[e]>>8,r[e]&=255;for(e=0;e<32;e++)r[e]-=o*n[e];for(s=0;s<32;s++)r[s+1]+=r[s]>>8,t[s]=255&r[s]}static reduce(r){const n=new Float64Array(64);let o;for(o=0;o<64;o++)n[o]=r[o];for(o=0;o<64;o++)r[o]=0;t.modL(r,n)}static curve25519_sign(r,n,o,s,e){function a(r,n,o,s){const e=new Uint8Array(64),a=new Uint8Array(64);let i,c;const f=new Float64Array(64),l=[t.init_25519_constants(),t.init_25519_constants(),t.init_25519_constants(),t.init_25519_constants()];for(i=0;i<o;i++)r[64+i]=n[i];for(i=0;i<32;i++)r[32+i]=s[i];for(t.crypto_hash(a,r.subarray(32),o+32),t.reduce(a),t.scalarbase(l,a),t.pack(r,l),i=0;i<32;i++)r[i+32]=s[32+i];for(t.crypto_hash(e,r,o+64),t.reduce(e),i=0;i<64;i++)f[i]=0;for(i=0;i<32;i++)f[i]=a[i];for(i=0;i<32;i++)for(c=0;c<32;c++)f[i+c]+=e[i]*s[c];return t.modL(r.subarray(32),f),o+64}function i(r,n,o,s,e){const a=new Uint8Array(64),i=new Uint8Array(64);let c,f;const l=new Float64Array(64),u=[t.init_25519_constants(),t.init_25519_constants(),t.init_25519_constants(),t.init_25519_constants()];for(r[0]=254,c=1;c<32;c++)r[c]=255;for(c=0;c<32;c++)r[32+c]=s[c];for(c=0;c<o;c++)r[64+c]=n[c];for(c=0;c<64;c++)r[o+64+c]=e[c];for(t.crypto_hash(i,r,o+128),t.reduce(i),t.scalarbase(u,i),t.pack(r,u),c=0;c<32;c++)r[c+32]=s[32+c];for(t.crypto_hash(a,r,o+64),t.reduce(a),c=0;c<64;c++)r[o+64+c]=0;for(c=0;c<64;c++)l[c]=0;for(c=0;c<32;c++)l[c]=i[c];for(c=0;c<32;c++)for(f=0;f<32;f++)l[c+f]+=a[c]*s[f];return t.modL(r.subarray(32,o+64),l),o+64}const c=new Uint8Array(64),f=[t.init_25519_constants(),t.init_25519_constants(),t.init_25519_constants(),t.init_25519_constants()];for(let t=0;t<32;t++)c[t]=s[t];c[0]&=248,c[31]&=127,c[31]|=64,t.scalarbase(f,c),t.pack(c.subarray(32),f);const l=128&c[63];let u;return u=e?i(r,n,o,c,e):a(r,n,o,c),r[63]|=l,u}static convertPublicKey(r){const n=new Uint8Array(32),o=t.init_25519_constants(),s=t.init_25519_constants(),e=t.init_25519_constants();return t.unpack25519(o,r),t.blockadd(s,o,t.gf1()),t.blocksub(e,o,t.gf1()),t.inv25519(s,s),t.blockround(s,s,e),t.pack25519(n,s),n}static curve25519_sign_open(r,n,o,s){function e(r,n,o,s){function e(r,n){function o(r,n){const o=new Uint8Array(32),s=new Uint8Array(32);return t.pack25519(o,r),t.pack25519(s,n),t.crypto_verify_32(o,0,s,0)}function s(r,n){const o=t.init_25519_constants();let s;for(s=0;s<16;s++)o[s]=n[s];for(s=250;s>=0;s--)t.blockround_dest(o,o),1!==s&&t.blockround(o,o,n);for(s=0;s<16;s++)r[s]=o[s]}const e=t.init_25519_constants(),a=t.init_25519_constants(),i=t.init_25519_constants(),c=t.init_25519_constants(),f=t.init_25519_constants(),l=t.init_25519_constants(),u=t.init_25519_constants();return t.set25519(r[2],t.gf1()),t.unpack25519(r[1],n),t.blockround_dest(i,r[1]),t.blockround(c,i,t.D()),t.blocksub(i,i,r[2]),t.blockadd(c,r[2],c),t.blockround_dest(f,c),t.blockround_dest(l,f),t.blockround(u,l,f),t.blockround(e,u,i),t.blockround(e,e,c),s(e,e),t.blockround(e,e,i),t.blockround(e,e,c),t.blockround(e,e,c),t.blockround(r[0],e,c),t.blockround_dest(a,r[0]),t.blockround(a,a,c),o(a,i)&&t.blockround(r[0],r[0],t.I()),t.blockround_dest(a,r[0]),t.blockround(a,a,c),o(a,i)?-1:(t.par25519(r[0])===n[31]>>7&&t.blocksub(r[0],t.gf0(),r[0]),t.blockround(r[3],r[0],r[1]),0)}let a,i;const c=new Uint8Array(32),f=new Uint8Array(64),l=[t.init_25519_constants(),t.init_25519_constants(),t.init_25519_constants(),t.init_25519_constants()],u=[t.init_25519_constants(),t.init_25519_constants(),t.init_25519_constants(),t.init_25519_constants()];if(o<64)return-1;if(e(u,s))return-1;for(a=0;a<o;a++)r[a]=n[a];for(a=0;a<32;a++)r[a+32]=s[a];if(t.crypto_hash(f,r,o),t.reduce(f),t.scalarmult(l,u,f),t.scalarbase(u,n.subarray(32)),add(l,u),t.pack(c,l),o-=64,t.crypto_verify_32(n,0,c,0)){for(a=0;a<o;a++)r[a]=0;return-1}for(a=0;a<o;a++)r[a]=n[a+64];return i=o}const a=t.convertPublicKey(s);return a[31]|=128&n[63],n[63]&=127,e(r,n,o,a)}static crypto_scalarmult_base(r,n){const o=new Uint8Array(32);return o[0]=9,t.crypto_scalarmult(r,n,o)}constructor(){this.sk=new Uint8Array(32),this.pk=new Uint8Array(32)}getPublicKey(t){return t?Buffer.from(this.pk).toString(t):Buffer.from(this.pk)}getPrivateKey(t){return t?Buffer.from(this.sk).toString(t):Buffer.from(this.sk)}setPrivateKey(r,n){this.sk=new Uint8Array(r),sk[0]&=248,sk[31]&=127,sk[31]|=64;for(let t=0;t<32;t++)this.pk[t]=0;return t.crypto_scalarmult_base(this.pk,this.sk),this.sk[0]&=248,this.sk[31]&=127,this.sk[31]|=64,this.pk[31]&=127,n?Buffer.from(this.pk).toString(n):Buffer.from(this.pk)}generateKeys(r,n){if(!Buffer.isBuffer(n)&&!Array.isArray(n))throw new Error("message must be a buffer");if(32!==(n=new Uint8Array(Buffer.from(n))).length)throw new Error("private key must be 32 bytes");for(let t=0;t<32;t++)this.sk[t]=n[t],this.pk[t]=0;return t.crypto_scalarmult_base(this.pk,this.sk),this.sk[0]&=248,this.sk[31]&=127,this.sk[31]|=64,this.pk[31]&=127,r?Buffer.from(this.pk).toString(r):Buffer.from(this.pk)}computeSecret(r,n,o){if(r=Buffer.isBuffer(r)||Array.isArray(r)?new Uint8Array(r):new Uint8Array(Buffer.from(r,n)),t.checkArrayTypes(r,this.sk),32!==r.length)throw new Error("wrong public key length");if(32!==this.sk.length)throw new Error("wrong secret key length");const s=new Uint8Array(32);return t.crypto_scalarmult(s,this.sk,r),o?Buffer.from(s).toString(o):Buffer.from(s)}sign(r,n){if(t.checkArrayTypes(this.sk,r),!Buffer.isBuffer(r)&&!Array.isArray(r))throw new Error("message must be a buffer");if(r=new Uint8Array(Buffer.from(r)),32!==this.sk.length)throw new Error("wrong secret key length");if(n&&(t.checkArrayTypes(n),64!==n.length))throw new Error("wrong random data length");const o=new Uint8Array((n?128:64)+r.length);t.curve25519_sign(o,r,r.length,this.sk,n);const s=new Uint8Array(64);for(let t=0;t<s.length;t++)s[t]=o[t];return Buffer.from(s)}signMessage(r,n){if(!Buffer.isBuffer(r)&&!Array.isArray(r))throw new Error("message must be a buffer");if(r=new Uint8Array(Buffer.from(r)),t.checkArrayTypes(r,this.sk),32!==this.sk.length)throw new Error("wrong secret key length");if(n){if(t.checkArrayTypes(n),64!==n.length)throw new Error("wrong random data length");const o=new Uint8Array(128+r.length);return t.curve25519_sign(o,r,r.length,this.sk,n),Buffer.from(o.subarray(0,64+r.length))}{const n=new Uint8Array(64+r.length);return t.curve25519_sign(n,r,r.length,this.sk),Buffer.from(n)}}static openMessage(r,n){if(!Buffer.isBuffer(r)&&!Array.isArray(r))throw new Error("publicKey must be a buffer");if(r=new Uint8Array(Buffer.from(r)),!Buffer.isBuffer(n)&&!Array.isArray(n))throw new Error("message must be a buffer");if(n=new Uint8Array(Buffer.from(n)),t.checkArrayTypes(n,r),32!==r.length)throw new Error("wrong public key length");const o=new Uint8Array(n.length),s=t.curve25519_sign_open(o,n,n.length,r);return s<0?null:Buffer.from(o)}static verify(r,n,o){if(!Buffer.isBuffer(r)&&!Array.isArray(r))throw new Error("publicKey must be a buffer");if(r=new Uint8Array(Buffer.from(r)),!Buffer.isBuffer(n)&&!Array.isArray(n))throw new Error("message must be a buffer");if(n=new Uint8Array(Buffer.from(n)),!Buffer.isBuffer(o)&&!Array.isArray(o))throw new Error("message must be a buffer");if(o=new Uint8Array(Buffer.from(o)),t.checkArrayTypes(n,o,r),64!==o.length)throw new Error("wrong signature length");if(32!==r.length)throw new Error("wrong public key length");const s=new Uint8Array(64+n.length),e=new Uint8Array(64+n.length);for(let t=0;t<64;t++)s[t]=o[t];for(let t=0;t<n.length;t++)s[t+64]=n[t];return t.curve25519_sign_open(e,s,s.length,r)>=0}};'},"sha3.js":{requiresElectron:!0,requiresBrowser:!1,code:'!function(){"use strict";let t="input is invalid type",e="object"==typeof window,r=e?window:{};r.JS_SHA3_NO_WINDOW&&(e=!1);let n=!e&&"object"==typeof self,i;!r.JS_SHA3_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node?r=global:n&&(r=self);let o=!r.JS_SHA3_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,s="0123456789abcdef".split(""),u=[31,7936,2031616,520093696],f=[4,1024,262144,67108864],a=[1,256,65536,16777216],h=[6,1536,393216,100663296],c=[0,8,16,24],l=[1,0,32898,0,32906,2147483648,2147516416,2147483648,32907,0,2147483649,0,2147516545,2147483648,32777,2147483648,138,0,136,0,2147516425,0,2147483658,0,2147516555,0,139,2147483648,32905,2147483648,32771,2147483648,32770,2147483648,128,2147483648,32778,0,2147483658,2147483648,2147516545,2147483648,32896,2147483648,2147483649,0,2147516424,2147483648],p=[224,256,384,512],d=[128,256],y=["hex","buffer","arrayBuffer","array","digest"],b={128:168,256:136};!r.JS_SHA3_NO_NODE_JS&&Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),!o||!r.JS_SHA3_NO_ARRAY_BUFFER_IS_VIEW&&ArrayBuffer.isView||(ArrayBuffer.isView=function(t){return"object"==typeof t&&t.buffer&&t.buffer.constructor===ArrayBuffer});let A=function(t,e,r){return function(n){return new j(t,e,t).update(n)[r]()}},B=function(t,e,r){return function(n,i){return new j(t,e,i).update(n)[r]()}},g=function(t,e,r){return function(e,n,i,o){return z[`cshake${t}`].update(e,n,i,o)[r]()}},w=function(t,e,r){return function(e,n,i,o){return z[`kmac${t}`].update(e,n,i,o)[r]()}},k=function(t,e,r,n){for(let i=0;i<y.length;++i){let o=y[i];t[o]=e(r,n,o)}return t},_=function(t,e){let r=A(t,e,"hex");return r.create=function(){return new j(t,e,t)},r.update=function(t){return r.create().update(t)},k(r,A,t,e)},S,C,x,m=[{name:"keccak",padding:a,bits:p,createMethod:_},{name:"sha3",padding:h,bits:p,createMethod:_},{name:"shake",padding:u,bits:d,createMethod:function(t,e){let r=B(t,e,"hex");return r.create=function(r){return new j(t,e,r)},r.update=function(t,e){return r.create(e).update(t)},k(r,B,t,e)}},{name:"cshake",padding:f,bits:d,createMethod:function(t,e){let r=b[t],n=g(t,e,"hex");return n.create=function(n,i,o){return i||o?new j(t,e,n).bytepad([i,o],r):z["shake"+t].create(n)},n.update=function(t,e,r,i){return n.create(e,r,i).update(t)},k(n,g,t,e)}},{name:"kmac",padding:f,bits:d,createMethod:function(t,e){let r=b[t],n=w(t,e,"hex");return n.create=function(n,i,o){return new N(t,e,i).bytepad(["KMAC",o],r).bytepad([n],r)},n.update=function(t,e,r,i){return n.create(t,r,i).update(e)},k(n,w,t,e)}}],z={},O=[];for(let t=0;t<m.length;++t){let e=m[t],r=e.bits;for(let t=0;t<r.length;++t){let n=`${e.name}_${r[t]}`;if(O.push(n),z[n]=e.createMethod(r[t],e.padding),"sha3"!==e.name){let i=e.name+r[t];O.push(i),z[i]=z[n]}}}function j(t,e,r){this.blocks=[],this.s=[],this.padding=e,this.outputBits=r,this.reset=!0,this.finalized=!1,this.block=0,this.start=0,this.blockCount=1600-(t<<1)>>5,this.byteCount=this.blockCount<<2,this.outputBlocks=r>>5,this.extraBytes=(31&r)>>3;for(let t=0;t<50;++t)this.s[t]=0}function N(t,e,r){j.call(this,t,e,r)}j.prototype.update=function(e){if(this.finalized)return;let r,n=typeof e;if("string"!==n){if("object"!==n)throw t;if(null===e)throw t;if(o&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!(Array.isArray(e)||o&&ArrayBuffer.isView(e)))throw t;r=!0}let i=this.blocks,s=this.byteCount,u=e.length,f=this.blockCount,a=0,h=this.s,l,p;for(;a<u;){if(this.reset)for(this.reset=!1,i[0]=this.block,l=1;l<f+1;++l)i[l]=0;if(r)for(l=this.start;a<u&&l<s;++a)i[l>>2]|=e[a]<<c[3&l++];else for(l=this.start;a<u&&l<s;++a)(p=e.charCodeAt(a))<128?i[l>>2]|=p<<c[3&l++]:p<2048?(i[l>>2]|=(192|p>>6)<<c[3&l++],i[l>>2]|=(128|63&p)<<c[3&l++]):p<55296||p>=57344?(i[l>>2]|=(224|p>>12)<<c[3&l++],i[l>>2]|=(128|p>>6&63)<<c[3&l++],i[l>>2]|=(128|63&p)<<c[3&l++]):(p=65536+((1023&p)<<10|1023&e.charCodeAt(++a)),i[l>>2]|=(240|p>>18)<<c[3&l++],i[l>>2]|=(128|p>>12&63)<<c[3&l++],i[l>>2]|=(128|p>>6&63)<<c[3&l++],i[l>>2]|=(128|63&p)<<c[3&l++]);if(this.lastByteIndex=l,l>=s){for(this.start=l-s,this.block=i[f],l=0;l<f;++l)h[l]^=i[l];J(h),this.reset=!0}else this.start=l}return this},j.prototype.encode=function(t,e){let r=255&t,n=1,i=[r];for(r=255&(t>>=8);r>0;)i.unshift(r),r=255&(t>>=8),++n;return e?i.push(n):i.unshift(n),this.update(i),i.length},j.prototype.encodeString=function(e){let r,n=typeof e;if("string"!==n){if("object"!==n)throw t;if(null===e)throw t;if(o&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!(Array.isArray(e)||o&&ArrayBuffer.isView(e)))throw t;r=!0}let i=0,s=e.length;if(r)i=s;else for(let t=0;t<e.length;++t){let r=e.charCodeAt(t);r<128?i+=1:r<2048?i+=2:r<55296||r>=57344?i+=3:(r=65536+((1023&r)<<10|1023&e.charCodeAt(++t)),i+=4)}return i+=this.encode(8*i),this.update(e),i},j.prototype.bytepad=function(t,e){let r=this.encode(e);for(let e=0;e<t.length;++e)r+=this.encodeString(t[e]);let n=e-r%e,i=[];return i.length=n,this.update(i),this},j.prototype.finalize=function(){if(this.finalized)return;this.finalized=!0;let t=this.blocks,e=this.lastByteIndex,r=this.blockCount,n=this.s;if(t[e>>2]|=this.padding[3&e],this.lastByteIndex===this.byteCount)for(t[0]=t[r],e=1;e<r+1;++e)t[e]=0;for(t[r-1]|=2147483648,e=0;e<r;++e)n[e]^=t[e];J(n)},j.prototype.toString=j.prototype.hex=function(){this.finalize();let t=this.blockCount,e=this.s,r=this.outputBlocks,n=this.extraBytes,i=0,o=0,u="",f;for(;o<r;){for(i=0;i<t&&o<r;++i,++o)f=e[i],u+=s[f>>4&15]+s[15&f]+s[f>>12&15]+s[f>>8&15]+s[f>>20&15]+s[f>>16&15]+s[f>>28&15]+s[f>>24&15];o%t==0&&(J(e),i=0)}return n&&(f=e[i],u+=s[f>>4&15]+s[15&f],n>1&&(u+=s[f>>12&15]+s[f>>8&15]),n>2&&(u+=s[f>>20&15]+s[f>>16&15])),u},j.prototype.arrayBuffer=function(){this.finalize();let t=this.blockCount,e=this.s,r=this.outputBlocks,n=this.extraBytes,i=0,o=0,s=this.outputBits>>3,u;u=n?new ArrayBuffer(r+1<<2):new ArrayBuffer(s);let f=new Uint32Array(u);for(;o<r;){for(i=0;i<t&&o<r;++i,++o)f[o]=e[i];o%t==0&&J(e)}return n&&(f[i]=e[i],u=u.slice(0,s)),u},j.prototype.buffer=j.prototype.arrayBuffer,j.prototype.digest=j.prototype.array=function(){this.finalize();let t=this.blockCount,e=this.s,r=this.outputBlocks,n=this.extraBytes,i=0,o=0,s=[],u,f;for(;o<r;){for(i=0;i<t&&o<r;++i,++o)u=o<<2,f=e[i],s[u]=255&f,s[u+1]=f>>8&255,s[u+2]=f>>16&255,s[u+3]=f>>24&255;o%t==0&&J(e)}return n&&(u=o<<2,f=e[i],s[u]=255&f,n>1&&(s[u+1]=f>>8&255),n>2&&(s[u+2]=f>>16&255)),s},N.prototype=new j,N.prototype.finalize=function(){return this.encode(this.outputBits,!0),j.prototype.finalize.call(this)};let J=function(t){let e,r,n,i,o,s,u,f,a,h,c,p,d,y,b,A,B,g,w,k,_,S,C,x,m,z,O,j,N,J,M,I,R,E,H,U,V,F,$,v,D,W,Y,K,q,G,L,P,Q,T,X,Z,tt,et,rt,nt,it,ot,st,ut,ft,at,ht;for(n=0;n<48;n+=2)i=t[0]^t[10]^t[20]^t[30]^t[40],o=t[1]^t[11]^t[21]^t[31]^t[41],s=t[2]^t[12]^t[22]^t[32]^t[42],u=t[3]^t[13]^t[23]^t[33]^t[43],f=t[4]^t[14]^t[24]^t[34]^t[44],a=t[5]^t[15]^t[25]^t[35]^t[45],h=t[6]^t[16]^t[26]^t[36]^t[46],c=t[7]^t[17]^t[27]^t[37]^t[47],e=(p=t[8]^t[18]^t[28]^t[38]^t[48])^(s<<1|u>>>31),r=(d=t[9]^t[19]^t[29]^t[39]^t[49])^(u<<1|s>>>31),t[0]^=e,t[1]^=r,t[10]^=e,t[11]^=r,t[20]^=e,t[21]^=r,t[30]^=e,t[31]^=r,t[40]^=e,t[41]^=r,e=i^(f<<1|a>>>31),r=o^(a<<1|f>>>31),t[2]^=e,t[3]^=r,t[12]^=e,t[13]^=r,t[22]^=e,t[23]^=r,t[32]^=e,t[33]^=r,t[42]^=e,t[43]^=r,e=s^(h<<1|c>>>31),r=u^(c<<1|h>>>31),t[4]^=e,t[5]^=r,t[14]^=e,t[15]^=r,t[24]^=e,t[25]^=r,t[34]^=e,t[35]^=r,t[44]^=e,t[45]^=r,e=f^(p<<1|d>>>31),r=a^(d<<1|p>>>31),t[6]^=e,t[7]^=r,t[16]^=e,t[17]^=r,t[26]^=e,t[27]^=r,t[36]^=e,t[37]^=r,t[46]^=e,t[47]^=r,e=h^(i<<1|o>>>31),r=c^(o<<1|i>>>31),t[8]^=e,t[9]^=r,t[18]^=e,t[19]^=r,t[28]^=e,t[29]^=r,t[38]^=e,t[39]^=r,t[48]^=e,t[49]^=r,y=t[0],b=t[1],G=t[11]<<4|t[10]>>>28,L=t[10]<<4|t[11]>>>28,j=t[20]<<3|t[21]>>>29,N=t[21]<<3|t[20]>>>29,ut=t[31]<<9|t[30]>>>23,ft=t[30]<<9|t[31]>>>23,W=t[40]<<18|t[41]>>>14,Y=t[41]<<18|t[40]>>>14,E=t[2]<<1|t[3]>>>31,H=t[3]<<1|t[2]>>>31,A=t[13]<<12|t[12]>>>20,B=t[12]<<12|t[13]>>>20,P=t[22]<<10|t[23]>>>22,Q=t[23]<<10|t[22]>>>22,J=t[33]<<13|t[32]>>>19,M=t[32]<<13|t[33]>>>19,at=t[42]<<2|t[43]>>>30,ht=t[43]<<2|t[42]>>>30,et=t[5]<<30|t[4]>>>2,rt=t[4]<<30|t[5]>>>2,U=t[14]<<6|t[15]>>>26,V=t[15]<<6|t[14]>>>26,g=t[25]<<11|t[24]>>>21,w=t[24]<<11|t[25]>>>21,T=t[34]<<15|t[35]>>>17,X=t[35]<<15|t[34]>>>17,I=t[45]<<29|t[44]>>>3,R=t[44]<<29|t[45]>>>3,x=t[6]<<28|t[7]>>>4,m=t[7]<<28|t[6]>>>4,nt=t[17]<<23|t[16]>>>9,it=t[16]<<23|t[17]>>>9,F=t[26]<<25|t[27]>>>7,$=t[27]<<25|t[26]>>>7,k=t[36]<<21|t[37]>>>11,_=t[37]<<21|t[36]>>>11,Z=t[47]<<24|t[46]>>>8,tt=t[46]<<24|t[47]>>>8,K=t[8]<<27|t[9]>>>5,q=t[9]<<27|t[8]>>>5,z=t[18]<<20|t[19]>>>12,O=t[19]<<20|t[18]>>>12,ot=t[29]<<7|t[28]>>>25,st=t[28]<<7|t[29]>>>25,v=t[38]<<8|t[39]>>>24,D=t[39]<<8|t[38]>>>24,S=t[48]<<14|t[49]>>>18,C=t[49]<<14|t[48]>>>18,t[0]=y^~A&g,t[1]=b^~B&w,t[10]=x^~z&j,t[11]=m^~O&N,t[20]=E^~U&F,t[21]=H^~V&$,t[30]=K^~G&P,t[31]=q^~L&Q,t[40]=et^~nt&ot,t[41]=rt^~it&st,t[2]=A^~g&k,t[3]=B^~w&_,t[12]=z^~j&J,t[13]=O^~N&M,t[22]=U^~F&v,t[23]=V^~$&D,t[32]=G^~P&T,t[33]=L^~Q&X,t[42]=nt^~ot&ut,t[43]=it^~st&ft,t[4]=g^~k&S,t[5]=w^~_&C,t[14]=j^~J&I,t[15]=N^~M&R,t[24]=F^~v&W,t[25]=$^~D&Y,t[34]=P^~T&Z,t[35]=Q^~X&tt,t[44]=ot^~ut&at,t[45]=st^~ft&ht,t[6]=k^~S&y,t[7]=_^~C&b,t[16]=J^~I&x,t[17]=M^~R&m,t[26]=v^~W&E,t[27]=D^~Y&H,t[36]=T^~Z&K,t[37]=X^~tt&q,t[46]=ut^~at&et,t[47]=ft^~ht&rt,t[8]=S^~y&A,t[9]=C^~b&B,t[18]=I^~x&z,t[19]=R^~m&O,t[28]=W^~E&U,t[29]=Y^~H&V,t[38]=Z^~K&G,t[39]=tt^~q&L,t[48]=at^~et&nt,t[49]=ht^~rt&it,t[0]^=l[n],t[1]^=l[n+1]};for(let t=0;t<O.length;++t)global[O[t]]=z[O[t]]}();'},"sjcl.js":{requiresElectron:!0,requiresBrowser:!1,code:'"use strict";var sjcl={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt(t){this.toString=function(){return`CORRUPT: ${this.message}`},this.message=t},invalid(t){this.toString=function(){return`INVALID: ${this.message}`},this.message=t},bug(t){this.toString=function(){return`BUG: ${this.message}`},this.message=t},notReady(t){this.toString=function(){return`NOT READY: ${this.message}`},this.message=t}}};function t(t,e,s){if(4!==e.length)throw new sjcl.exception.invalid("invalid aes block size");let i=t.b[s],c=e[0]^i[0],r=e[s?3:1]^i[1],o=e[2]^i[2];e=e[s?1:3]^i[3];let n,a,l,h=i.length/4-2,d,p=4,u=[0,0,0,0];t=(n=t.s[s])[0];let f=n[1],m=n[2],j=n[3],y=n[4];for(d=0;d<h;d++)n=t[c>>>24]^f[r>>16&255]^m[o>>8&255]^j[255&e]^i[p],a=t[r>>>24]^f[o>>16&255]^m[e>>8&255]^j[255&c]^i[p+1],l=t[o>>>24]^f[e>>16&255]^m[c>>8&255]^j[255&r]^i[p+2],e=t[e>>>24]^f[c>>16&255]^m[r>>8&255]^j[255&o]^i[p+3],p+=4,c=n,r=a,o=l;for(d=0;4>d;d++)u[s?3&-d:d]=y[c>>>24]<<24^y[r>>16&255]<<16^y[o>>8&255]<<8^y[255&e]^i[p++],n=c,c=r,r=o,o=e,e=n;return u}function u(t,e){let s,i,c,r=t.F,o=t.b,n=r[0],a=r[1],l=r[2],h=r[3],d=r[4],p=r[5],u=r[6],f=r[7];for(s=0;64>s;s++)16>s?i=e[s]:(i=e[s+1&15],c=e[s+14&15],i=e[15&s]=(i>>>7^i>>>18^i>>>3^i<<25^i<<14)+(c>>>17^c>>>19^c>>>10^c<<15^c<<13)+e[15&s]+e[s+9&15]|0),i=i+f+(d>>>6^d>>>11^d>>>25^d<<26^d<<21^d<<7)+(u^d&(p^u))+o[s],f=u,u=p,p=d,d=h+i|0,h=l,l=a,n=i+((a=n)&l^h&(a^l))+(a>>>2^a>>>13^a>>>22^a<<30^a<<19^a<<10)|0;r[0]=r[0]+n|0,r[1]=r[1]+a|0,r[2]=r[2]+l|0,r[3]=r[3]+h|0,r[4]=r[4]+d|0,r[5]=r[5]+p|0,r[6]=r[6]+u|0,r[7]=r[7]+f|0}function A(t,e){let s,i=sjcl.random.K[t],c=[];for(s in i)i.hasOwnProperty(s)&&c.push(i[s]);for(s=0;s<c.length;s++)c[s](e)}function C(t,e){"undefined"!=typeof window&&window.performance&&"function"==typeof window.performance.now?t.addEntropy(window.performance.now(),e,"loadtime"):t.addEntropy((new Date).valueOf(),e,"loadtime")}function y(t){t.b=z(t).concat(z(t)),t.L=new sjcl.cipher.aes(t.b)}function z(t){for(let e=0;4>e&&(t.h[e]=t.h[e]+1|0,!t.h[e]);e++);return t.L.encrypt(t.h)}function B(t,e){return function(){e.apply(t,arguments)}}sjcl.cipher.aes=function(t){this.s[0][0][0]||this.O();let e,s,i,c,r=this.s[0][4],o=this.s[1],n=1;if(4!==(e=t.length)&&6!==e&&8!==e)throw new sjcl.exception.invalid("invalid aes key size");for(this.b=[i=t.slice(0),c=[]],t=e;t<4*e+28;t++)s=i[t-1],(0==t%e||8===e&&4==t%e)&&(s=r[s>>>24]<<24^r[s>>16&255]<<16^r[s>>8&255]<<8^r[255&s],0==t%e&&(s=s<<8^s>>>24^n<<24,n=n<<1^283*(n>>7))),i[t]=i[t-e]^s;for(e=0;t;e++,t--)s=i[3&e?t:t-4],c[e]=4>=t||4>e?s:o[0][r[s>>>24]]^o[1][r[s>>16&255]]^o[2][r[s>>8&255]]^o[3][r[255&s]]},sjcl.cipher.aes.prototype={encrypt(e){return t(this,e,0)},decrypt(e){return t(this,e,1)},s:[[[],[],[],[],[]],[[],[],[],[],[]]],O(){let t=this.s[0],e=this.s[1],s=t[4],i=e[4],c,r,o,n=[],a=[],l,h,d,p;for(c=0;256>c;c++)a[(n[c]=c<<1^283*(c>>7))^c]=c;for(r=o=0;!s[r];r^=l||1,o=a[o]||1)for(d=(d=o^o<<1^o<<2^o<<3^o<<4)>>8^255&d^99,s[r]=d,i[d]=r,p=16843009*(h=n[c=n[l=n[r]]])^65537*c^257*l^16843008*r,h=257*n[d]^16843008*d,c=0;4>c;c++)t[c][r]=h=h<<24^h>>>8,e[c][d]=p=p<<24^p>>>8;for(c=0;5>c;c++)t[c]=t[c].slice(0),e[c]=e[c].slice(0)}},sjcl.bitArray={bitSlice(t,e,s){return t=sjcl.bitArray.$(t.slice(e/32),32-(31&e)).slice(1),void 0===s?t:sjcl.bitArray.clamp(t,s-e)},extract(t,e,s){let i=Math.floor(-e-s&31);return(-32&(e+s-1^e)?t[e/32|0]<<32-i^t[e/32+1|0]>>>i:t[e/32|0]>>>i)&(1<<s)-1},concat(t,e){if(0===t.length||0===e.length)return t.concat(e);let s=t[t.length-1],i=sjcl.bitArray.getPartial(s);return 32===i?t.concat(e):sjcl.bitArray.$(e,i,0|s,t.slice(0,t.length-1))},bitLength(t){let e=t.length;return 0===e?0:32*(e-1)+sjcl.bitArray.getPartial(t[e-1])},clamp(t,e){if(32*t.length<e)return t;let s=(t=t.slice(0,Math.ceil(e/32))).length;return e&=31,0<s&&e&&(t[s-1]=sjcl.bitArray.partial(e,t[s-1]&2147483648>>e-1,1)),t},partial(t,e,s){return 32===t?e:(s?0|e:e<<32-t)+1099511627776*t},getPartial(t){return Math.round(t/1099511627776)||32},equal(t,e){if(sjcl.bitArray.bitLength(t)!==sjcl.bitArray.bitLength(e))return!1;let s=0,i;for(i=0;i<t.length;i++)s|=t[i]^e[i];return 0===s},$(t,e,s,i){let c;for(void 0===i&&(i=[]);32<=e;e-=32)i.push(s),s=0;if(0===e)return i.concat(t);for(c=0;c<t.length;c++)i.push(s|t[c]>>>e),s=t[c]<<32-e;return c=t.length?t[t.length-1]:0,t=sjcl.bitArray.getPartial(c),i.push(sjcl.bitArray.partial(e+t&31,32<e+t?s:i.pop(),1)),i},i(t,e){return[t[0]^e[0],t[1]^e[1],t[2]^e[2],t[3]^e[3]]},byteswapM(t){let e,s;for(e=0;e<t.length;++e)s=t[e],t[e]=s>>>24|s>>>8&65280|(65280&s)<<8|s<<24;return t}},sjcl.codec.utf8String={fromBits(t){let e="",s=sjcl.bitArray.bitLength(t),i,c;for(i=0;i<s/8;i++)0==(3&i)&&(c=t[i/4]),e+=String.fromCharCode(c>>>8>>>8>>>8),c<<=8;return decodeURIComponent(encodeURI(e))},toBits(t){t=unescape(encodeURIComponent(t));let e=[],s,i=0;for(s=0;s<t.length;s++)i=i<<8|t.charCodeAt(s),3==(3&s)&&(e.push(i),i=0);return 3&s&&e.push(sjcl.bitArray.partial(8*(3&s),i)),e}},sjcl.codec.hex={fromBits(t){let e="",s;for(s=0;s<t.length;s++)e+=(0xf00000000000+(0|t[s])).toString(16).substr(4);return e.substr(0,sjcl.bitArray.bitLength(t)/4)},toBits(t){let e,s=[],i;for(i=(t=t.replace(/\\s|0x/g,"")).length,t+="00000000",e=0;e<t.length;e+=8)s.push(0^parseInt(t.substr(e,8),16));return sjcl.bitArray.clamp(s,4*i)}},sjcl.codec.base32={B:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",X:"0123456789ABCDEFGHIJKLMNOPQRSTUV",BITS:32,BASE:5,REMAINING:27,fromBits(t,e,s){let i=sjcl.codec.base32.BASE,c=sjcl.codec.base32.REMAINING,r="",o=0,n=s?sjcl.codec.base32.X:sjcl.codec.base32.B,a=0,l=sjcl.bitArray.bitLength(t);for(s=0;r.length*i<l;)r+=n.charAt((a^t[s]>>>o)>>>c),o<i?(a=t[s]<<i-o,o+=c,s++):(a<<=i,o-=i);for(;7&r.length&&!e;)r+="=";return r},toBits(t,e){t=t.replace(/\\s|=/g,"").toUpperCase();let s=sjcl.codec.base32.BITS,i=sjcl.codec.base32.BASE,c=sjcl.codec.base32.REMAINING,r=[],o,n=0,a=e?sjcl.codec.base32.X:sjcl.codec.base32.B,l=0,h,d=e?"base32hex":"base32";for(o=0;o<t.length;o++){if(0>(h=a.indexOf(t.charAt(o)))){if(!e)try{return sjcl.codec.base32hex.toBits(t)}catch(t){}throw new sjcl.exception.invalid("this isn\'t "+d+"!")}n>c?(n-=c,r.push(l^h>>>n),l=h<<s-n):l^=h<<s-(n+=i)}return 56&n&&r.push(sjcl.bitArray.partial(56&n,l,1)),r}},sjcl.codec.base32hex={fromBits(t,e){return sjcl.codec.base32.fromBits(t,e,1)},toBits(t){return sjcl.codec.base32.toBits(t,1)}},sjcl.codec.base64={B:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits(t,e,s){let i="",c=0,r=sjcl.codec.base64.B,o=0,n=sjcl.bitArray.bitLength(t);for(s&&(r=`${r.substr(0,62)}-_`),s=0;6*i.length<n;)i+=r.charAt((o^t[s]>>>c)>>>26),6>c?(o=t[s]<<6-c,c+=26,s++):(o<<=6,c-=6);for(;3&i.length&&!e;)i+="=";return i},toBits(t,e){t=t.replace(/\\s|=/g,"");let s=[],i,c=0,r=sjcl.codec.base64.B,o=0,n;for(e&&(r=r.substr(0,62)+"-_"),i=0;i<t.length;i++){if(0>(n=r.indexOf(t.charAt(i))))throw new sjcl.exception.invalid("this isn\'t base64!");26<c?(c-=26,s.push(o^n>>>c),o=n<<32-c):o^=n<<32-(c+=6)}return 56&c&&s.push(sjcl.bitArray.partial(56&c,o,1)),s}},sjcl.codec.base64url={fromBits(t){return sjcl.codec.base64.fromBits(t,1,1)},toBits(t){return sjcl.codec.base64.toBits(t,1)}},sjcl.codec.bytes={fromBits(t){let e=[],s=sjcl.bitArray.bitLength(t),i,c;for(i=0;i<s/8;i++)0==(3&i)&&(c=t[i/4]),e.push(c>>>24),c<<=8;return e},toBits(t){let e=[],s,i=0;for(s=0;s<t.length;s++)i=i<<8|t[s],3==(3&s)&&(e.push(i),i=0);return 3&s&&e.push(sjcl.bitArray.partial(8*(3&s),i)),e}},sjcl.hash.sha256=function(t){this.b[0]||this.O(),t?(this.F=t.F.slice(0),this.A=t.A.slice(0),this.l=t.l):this.reset()},sjcl.hash.sha256.hash=function(t){return(new sjcl.hash.sha256).update(t).finalize()},sjcl.hash.sha256.prototype={blockSize:512,reset(){return this.F=this.Y.slice(0),this.A=[],this.l=0,this},update(t){"string"==typeof t&&(t=sjcl.codec.utf8String.toBits(t));let e,s=this.A=sjcl.bitArray.concat(this.A,t);if(e=this.l,9007199254740991<(t=this.l=e+sjcl.bitArray.bitLength(t)))throw new sjcl.exception.invalid("Cannot hash more than 2^53 - 1 bits");if("undefined"!=typeof Uint32Array){let i=new Uint32Array(s),c=0;for(e=512+e-(512+e&511);e<=t;e+=512)u(this,i.subarray(16*c,16*(c+1))),c+=1;s.splice(0,16*c)}else for(e=512+e-(512+e&511);e<=t;e+=512)u(this,s.splice(0,16));return this},finalize(){let t,e=sjcl.bitArray.concat(this.A,[sjcl.bitArray.partial(1,1)]),s=this.F;for(t=e.length+2;15&t;t++)e.push(0);for(e.push(Math.floor(this.l/4294967296)),e.push(0|this.l);e.length;)u(this,e.splice(0,16));return this.reset(),s},Y:[],b:[],O(){function t(t){return 4294967296*(t-Math.floor(t))|0}for(let e=0,s=2,i,c;64>e;s++){for(c=!0,i=2;i*i<=s;i++)if(0==s%i){c=!1;break}c&&(8>e&&(this.Y[e]=t(Math.pow(s,.5))),this.b[e]=t(Math.pow(s,1/3)),e++)}}},sjcl.hash.sha512=function(t){this.b[0]||this.q(),t?(this.e=t.e.slice(0),this.d=t.d.slice(0),this.c=t.c):this.reset()},sjcl.hash.sha512.hash=function(t){return(new sjcl.hash.sha512).update(t).finalize()},sjcl.hash.sha512.prototype={blockSize:1024,reset(){return this.e=this.i.slice(0),this.d=[],this.c=0,this},update(t){"string"==typeof t&&(t=sjcl.codec.utf8String.toBits(t));let e,s=this.d=sjcl.bitArray.concat(this.d,t);for(e=this.c,t=this.c=e+sjcl.bitArray.bitLength(t),e=1024+e&-1024;e<=t;e+=1024)this.n(s.splice(0,32));return this},finalize(){let t,e=sjcl.bitArray.concat(this.d,[sjcl.bitArray.partial(1,1)]),s=this.e;for(t=e.length+4;31&t;t++)e.push(0);for(e.push(0),e.push(0),e.push(Math.floor(this.c/4294967296)),e.push(0|this.c);e.length;)this.n(e.splice(0,32));return this.reset(),s},i:[],T:[12372232,13281083,9762859,1914609,15106769,4090911,4308331,8266105],b:[],V:[2666018,15689165,5061423,9034684,4764984,380953,1658779,7176472,197186,7368638,14987916,16757986,8096111,1480369,13046325,6891156,15813330,5187043,9229749,11312229,2818677,10937475,4324308,1135541,6741931,11809296,16458047,15666916,11046850,698149,229999,945776,13774844,2541862,12856045,9810911,11494366,7844520,15576806,8533307,15795044,4337665,16291729,5553712,15684120,6662416,7413802,12308920,13816008,4303699,9366425,10176680,13195875,4295371,6546291,11712675,15708924,1519456,15772530,6568428,6495784,8568297,13007125,7492395,2515356,12632583,14740254,7262584,1535930,13146278,16321966,1853211,294276,13051027,13221564,1051980,4080310,6651434,14088940,4675607],q(){function t(t){return 4294967296*(t-Math.floor(t))|0}function e(t){return 1099511627776*(t-Math.floor(t))&255}let s=0,i=2,c;t:for(;80>s;i++){for(c=2;c*c<=i;c++)if(0==i%c)continue t;8>s&&(this.i[2*s]=t(Math.pow(i,.5)),this.i[2*s+1]=e(Math.pow(i,.5))<<24|this.T[s]),this.b[2*s]=t(Math.pow(i,1/3)),this.b[2*s+1]=e(Math.pow(i,1/3))<<24|this.V[s],s++}},n(t){let e,s,i=t.slice(0),c=this.e,r=this.b,o=c[0],n=c[1],a=c[2],l=c[3],h=c[4],d=c[5],p=c[6],u=c[7],f=c[8],m=c[9],j=c[10],y=c[11],g=c[12],b=c[13],w=c[14],v=c[15],A=o,B=n,k=a,C=l,L=h,x=d,E=p,S=u,M=f,R=m,I=j,P=y,z=g,O=b,U=w,T=v;for(t=0;80>t;t++){if(16>t)e=i[2*t],s=i[2*t+1];else{var G;s=i[2*(t-15)],e=((G=i[2*(t-15)+1])<<31|s>>>1)^(G<<24|s>>>8)^s>>>7;let c=(s<<31|G>>>1)^(s<<24|G>>>8)^(s<<25|G>>>7);s=i[2*(t-2)];var D,G=((D=i[2*(t-2)+1])<<13|s>>>19)^(s<<3|D>>>29)^s>>>6,D=(s<<13|D>>>19)^(D<<3|s>>>29)^(s<<26|D>>>6),N=i[2*(t-7)],$=i[2*(t-16)],V=i[2*(t-16)+1];e=e+N+((s=c+i[2*(t-7)+1])>>>0<c>>>0?1:0),e+=G+((s+=D)>>>0<D>>>0?1:0),e+=$+((s+=V)>>>0<V>>>0?1:0)}i[2*t]=e|=0,i[2*t+1]=s|=0;var N=M&I^~M&z,q=R&P^~R&O,D=A&k^A&L^k&L,Y=B&C^B&x^C&x,$=(B<<4|A>>>28)^(A<<30|B>>>2)^(A<<25|B>>>7),V=(A<<4|B>>>28)^(B<<30|A>>>2)^(B<<25|A>>>7),K=r[2*t],X=r[2*t+1],G,F,G,F,G,F,G,F=(F=(F=(F=U+((R<<18|M>>>14)^(R<<14|M>>>18)^(M<<23|R>>>9))+((G=T+((M<<18|R>>>14)^(M<<14|R>>>18)^(R<<23|M>>>9)))>>>0<T>>>0?1:0))+(N+((G=G+q)>>>0<q>>>0?1:0)))+(K+((G=G+X)>>>0<X>>>0?1:0)))+(e+((G=G+s|0)>>>0<s>>>0?1:0));e=$+D+((s=V+Y)>>>0<V>>>0?1:0),U=z,T=O,z=I,O=P,I=M,P=R,M=E+F+((R=S+G|0)>>>0<S>>>0?1:0)|0,E=L,S=x,L=k,x=C,k=A,C=B,A=F+e+((B=G+s|0)>>>0<G>>>0?1:0)|0}n=c[1]=n+B|0,c[0]=o+A+(n>>>0<B>>>0?1:0)|0,l=c[3]=l+C|0,c[2]=a+k+(l>>>0<C>>>0?1:0)|0,d=c[5]=d+x|0,c[4]=h+L+(d>>>0<x>>>0?1:0)|0,u=c[7]=u+S|0,c[6]=p+E+(u>>>0<S>>>0?1:0)|0,m=c[9]=m+R|0,c[8]=f+M+(m>>>0<R>>>0?1:0)|0,y=c[11]=y+P|0,c[10]=j+I+(y>>>0<P>>>0?1:0)|0,b=c[13]=b+O|0,c[12]=g+z+(b>>>0<O>>>0?1:0)|0,v=c[15]=v+T|0,c[14]=w+U+(v>>>0<T>>>0?1:0)|0}},sjcl.mode.ccm={name:"ccm",G:[],listenProgress(t){sjcl.mode.ccm.G.push(t)},unListenProgress(t){-1<(t=sjcl.mode.ccm.G.indexOf(t))&&sjcl.mode.ccm.G.splice(t,1)},fa(t){let e=sjcl.mode.ccm.G.slice(),s;for(s=0;s<e.length;s+=1)e[s](t)},encrypt(t,e,s,i,c){let r,o=e.slice(0),n=sjcl.bitArray,a=n.bitLength(s)/8,l=n.bitLength(o)/8;if(c=c||64,i=i||[],7>a)throw new sjcl.exception.invalid("ccm: iv must be at least 7 bytes");for(r=2;4>r&&l>>>8*r;r++);return r<15-a&&(r=15-a),s=n.clamp(s,8*(15-r)),e=sjcl.mode.ccm.V(t,e,s,i,c,r),o=sjcl.mode.ccm.C(t,o,s,e,c,r),n.concat(o.data,o.tag)},decrypt(t,e,s,i,c){c=c||64,i=i||[];let r=sjcl.bitArray,o=r.bitLength(s)/8,n=r.bitLength(e),a=r.clamp(e,n-c),l=r.bitSlice(e,n-c);if(n=(n-c)/8,7>o)throw new sjcl.exception.invalid("ccm: iv must be at least 7 bytes");for(e=2;4>e&&n>>>8*e;e++);if(e<15-o&&(e=15-o),s=r.clamp(s,8*(15-e)),a=sjcl.mode.ccm.C(t,a,s,l,c,e),t=sjcl.mode.ccm.V(t,a.data,s,i,c,e),!r.equal(a.tag,t))throw new sjcl.exception.corrupt("ccm: tag doesn\'t match");return a.data},na(t,e,s,i,c,r){let o=[],n=sjcl.bitArray,a=n.i;if(i=[n.partial(8,(e.length?64:0)|i-2<<2|r-1)],(i=n.concat(i,s))[3]|=c,i=t.encrypt(i),e.length)for(65279>=(s=n.bitLength(e)/8)?o=[n.partial(16,s)]:4294967295>=s&&(o=n.concat([n.partial(16,65534)],[s])),o=n.concat(o,e),e=0;e<o.length;e+=4)i=t.encrypt(a(i,o.slice(e,e+4).concat([0,0,0])));return i},V(t,e,s,i,c,r){let o=sjcl.bitArray,n=o.i;if((c/=8)%2||4>c||16<c)throw new sjcl.exception.invalid("ccm: invalid tag length");if(4294967295<i.length||4294967295<e.length)throw new sjcl.exception.bug("ccm: can\'t deal with 4GiB or more data");for(s=sjcl.mode.ccm.na(t,i,s,c,o.bitLength(e)/8,r),i=0;i<e.length;i+=4)s=t.encrypt(n(s,e.slice(i,i+4).concat([0,0,0])));return o.clamp(s,8*c)},C(t,e,s,i,c,r){let o,n=sjcl.bitArray;o=n.i;let a=e.length,l=n.bitLength(e),h=a/50,d=h;if(s=n.concat([n.partial(8,r-1)],s).concat([0,0,0]).slice(0,4),i=n.bitSlice(o(i,t.encrypt(s)),0,c),!a)return{tag:i,data:[]};for(o=0;o<a;o+=4)o>h&&(sjcl.mode.ccm.fa(o/a),h+=d),s[3]++,c=t.encrypt(s),e[o]^=c[0],e[o+1]^=c[1],e[o+2]^=c[2],e[o+3]^=c[3];return{tag:i,data:n.clamp(e,l)}}},sjcl.mode.ocb2={name:"ocb2",encrypt(t,e,s,i,c,r){if(128!==sjcl.bitArray.bitLength(s))throw new sjcl.exception.invalid("ocb iv must be 128 bits");let o,n=sjcl.mode.ocb2.S,a=sjcl.bitArray,l=a.i,h=[0,0,0,0];s=n(t.encrypt(s));let d,p=[];for(i=i||[],c=c||64,o=0;o+4<e.length;o+=4)h=l(h,d=e.slice(o,o+4)),p=p.concat(l(s,t.encrypt(l(s,d)))),s=n(s);return d=e.slice(o),e=a.bitLength(d),o=t.encrypt(l(s,[0,0,0,e])),h=l(h,l((d=a.clamp(l(d.concat([0,0,0]),o),e)).concat([0,0,0]),o)),h=t.encrypt(l(h,l(s,n(s)))),i.length&&(h=l(h,r?i:sjcl.mode.ocb2.pmac(t,i))),p.concat(a.concat(d,a.clamp(h,c)))},decrypt(t,e,s,i,c,r){if(128!==sjcl.bitArray.bitLength(s))throw new sjcl.exception.invalid("ocb iv must be 128 bits");c=c||64;let o=sjcl.mode.ocb2.S,n=sjcl.bitArray,a=n.i,l=[0,0,0,0],h=o(t.encrypt(s)),d,p,u=sjcl.bitArray.bitLength(e)-c,f=[];for(i=i||[],s=0;s+4<u/32;s+=4)l=a(l,d=a(h,t.decrypt(a(h,e.slice(s,s+4))))),f=f.concat(d),h=o(h);if(p=u-32*s,l=a(l,d=a(d=t.encrypt(a(h,[0,0,0,p])),n.clamp(e.slice(s),p).concat([0,0,0]))),l=t.encrypt(a(l,a(h,o(h)))),i.length&&(l=a(l,r?i:sjcl.mode.ocb2.pmac(t,i))),!n.equal(n.clamp(l,c),n.bitSlice(e,u)))throw new sjcl.exception.corrupt("ocb: tag doesn\'t match");return f.concat(n.clamp(d,p))},pmac(t,e){let s,i=sjcl.mode.ocb2.S,c=sjcl.bitArray,r=c.i,o=[0,0,0,0],n=t.encrypt([0,0,0,0]);for(n=r(n,i(i(n))),s=0;s+4<e.length;s+=4)n=i(n),o=r(o,t.encrypt(r(n,e.slice(s,s+4))));return s=e.slice(s),128>c.bitLength(s)&&(n=r(n,i(n)),s=c.concat(s,[-2147483648,0,0,0])),o=r(o,s),t.encrypt(r(i(r(n,i(n))),o))},S(t){return[t[0]<<1^t[1]>>>31,t[1]<<1^t[2]>>>31,t[2]<<1^t[3]>>>31,t[3]<<1^135*(t[0]>>>31)]}},sjcl.mode.gcm={name:"gcm",encrypt(t,e,s,i,c){let r=e.slice(0);return e=sjcl.bitArray,i=i||[],t=sjcl.mode.gcm.C(!0,t,r,i,s,c||128),e.concat(t.data,t.tag)},decrypt(t,e,s,i,c){let r=e.slice(0),o=sjcl.bitArray,n=o.bitLength(r);if(c=c||128,i=i||[],c<=n?(e=o.bitSlice(r,n-c),r=o.bitSlice(r,0,n-c)):(e=r,r=[]),t=sjcl.mode.gcm.C(!1,t,r,i,s,c),!o.equal(t.tag,e))throw new sjcl.exception.corrupt("gcm: tag doesn\'t match");return t.data},ka(t,e){let s,i,c,r,o,n=sjcl.bitArray.i;for(c=[0,0,0,0],r=e.slice(0),s=0;128>s;s++){for((i=0!=(t[Math.floor(s/32)]&1<<31-s%32))&&(c=n(c,r)),o=0!=(1&r[3]),i=3;0<i;i--)r[i]=r[i]>>>1|(1&r[i-1])<<31;r[0]>>>=1,o&&(r[0]^=-520093696)}return c},j(t,e,s){let i,c=s.length;for(e=e.slice(0),i=0;i<c;i+=4)e[0]^=4294967295&s[i],e[1]^=4294967295&s[i+1],e[2]^=4294967295&s[i+2],e[3]^=4294967295&s[i+3],e=sjcl.mode.gcm.ka(e,t);return e},C(t,e,s,i,c,r){let o,n,a,l,h,d,p,u,f=sjcl.bitArray;for(d=s.length,p=f.bitLength(s),u=f.bitLength(i),n=f.bitLength(c),o=e.encrypt([0,0,0,0]),96===n?(c=c.slice(0),c=f.concat(c,[1])):(c=sjcl.mode.gcm.j(o,[0,0,0,0],c),c=sjcl.mode.gcm.j(o,c,[0,0,Math.floor(n/4294967296),4294967295&n])),n=sjcl.mode.gcm.j(o,[0,0,0,0],i),h=c.slice(0),i=n.slice(0),t||(i=sjcl.mode.gcm.j(o,n,s)),l=0;l<d;l+=4)h[3]++,a=e.encrypt(h),s[l]^=a[0],s[l+1]^=a[1],s[l+2]^=a[2],s[l+3]^=a[3];return s=f.clamp(s,p),t&&(i=sjcl.mode.gcm.j(o,n,s)),t=[Math.floor(u/4294967296),4294967295&u,Math.floor(p/4294967296),4294967295&p],i=sjcl.mode.gcm.j(o,i,t),a=e.encrypt(c),i[0]^=a[0],i[1]^=a[1],i[2]^=a[2],i[3]^=a[3],{tag:f.bitSlice(i,0,r),data:s}}},sjcl.misc.hmac=function(t,e){this.W=e=e||sjcl.hash.sha256;let s=[[],[]],i,c=e.prototype.blockSize/32;for(this.w=[new e,new e],t.length>c&&(t=e.hash(t)),i=0;i<c;i++)s[0][i]=909522486^t[i],s[1][i]=1549556828^t[i];this.w[0].update(s[0]),this.w[1].update(s[1]),this.R=new e(this.w[0])},sjcl.misc.hmac.prototype.encrypt=sjcl.misc.hmac.prototype.mac=function(t){if(this.aa)throw new sjcl.exception.invalid("encrypt on already updated hmac called!");return this.update(t),this.digest(t)},sjcl.misc.hmac.prototype.reset=function(){this.R=new this.W(this.w[0]),this.aa=!1},sjcl.misc.hmac.prototype.update=function(t){this.aa=!0,this.R.update(t)},sjcl.misc.hmac.prototype.digest=function(){let t=new this.W(this.w[1]).update(this.R.finalize()).finalize();return this.reset(),t},sjcl.misc.pbkdf2=function(t,e,s,i,c){if(s=s||1e4,0>i||0>s)throw new sjcl.exception.invalid("invalid params to pbkdf2");"string"==typeof t&&(t=sjcl.codec.utf8String.toBits(t)),"string"==typeof e&&(e=sjcl.codec.utf8String.toBits(e)),t=new(c=c||sjcl.misc.hmac)(t);let r,o,n,a,l=[],h=sjcl.bitArray;for(a=1;32*l.length<(i||1);a++){for(c=r=t.encrypt(h.concat(e,[a])),o=1;o<s;o++)for(r=t.encrypt(r),n=0;n<r.length;n++)c[n]^=r[n];l=l.concat(c)}return i&&(l=h.clamp(l,i)),l},sjcl.prng=function(t){this.c=[new sjcl.hash.sha256],this.m=[0],this.P=0,this.H={},this.N=0,this.U={},this.Z=this.f=this.o=this.ha=0,this.b=[0,0,0,0,0,0,0,0],this.h=[0,0,0,0],this.L=void 0,this.M=t,this.D=!1,this.K={progress:{},seeded:{}},this.u=this.ga=0,this.I=1,this.J=2,this.ca=65536,this.T=[0,48,64,96,128,192,256,384,512,768,1024],this.da=3e4,this.ba=80},sjcl.prng.prototype={randomWords(t,e){let s=[],i,c;if((i=this.isReady(e))===this.u)throw new sjcl.exception.notReady("generator isn\'t seeded");if(i&this.J){i=!(i&this.I),c=[];let t=0,e;for(this.Z=c[0]=(new Date).valueOf()+this.da,e=0;16>e;e++)c.push(4294967296*Math.random()|0);for(e=0;e<this.c.length&&(c=c.concat(this.c[e].finalize()),t+=this.m[e],this.m[e]=0,i||!(this.P&1<<e));e++);for(this.P>=1<<this.c.length&&(this.c.push(new sjcl.hash.sha256),this.m.push(0)),this.f-=t,t>this.o&&(this.o=t),this.P++,this.b=sjcl.hash.sha256.hash(this.b.concat(c)),this.L=new sjcl.cipher.aes(this.b),i=0;4>i&&(this.h[i]=this.h[i]+1|0,!this.h[i]);i++);}for(i=0;i<t;i+=4)0==(i+1)%this.ca&&y(this),c=z(this),s.push(c[0],c[1],c[2],c[3]);return y(this),s.slice(0,t)},setDefaultParanoia(t,e){if(0===t&&"Setting paranoia=0 will ruin your security; use it only for testing"!==e)throw new sjcl.exception.invalid("Setting paranoia=0 will ruin your security; use it only for testing");this.M=t},addEntropy(t,e,s){s=s||"user";let i,c,r=(new Date).valueOf(),o=this.H[s],n=this.isReady(),a=0;switch(void 0===(i=this.U[s])&&(i=this.U[s]=this.ha++),void 0===o&&(o=this.H[s]=0),this.H[s]=(this.H[s]+1)%this.c.length,typeof t){case"number":void 0===e&&(e=1),this.c[o].update([i,this.N++,1,e,r,1,0|t]);break;case"object":if("[object Uint32Array]"===(s=Object.prototype.toString.call(t))){for(c=[],s=0;s<t.length;s++)c.push(t[s]);t=c}else for("[object Array]"!==s&&(a=1),s=0;s<t.length&&!a;s++)"number"!=typeof t[s]&&(a=1);if(!a){if(void 0===e)for(s=e=0;s<t.length;s++)for(c=t[s];0<c;)e++,c>>>=1;this.c[o].update([i,this.N++,2,e,r,t.length].concat(t))}break;case"string":void 0===e&&(e=t.length),this.c[o].update([i,this.N++,3,e,r,t.length]),this.c[o].update(t);break;default:a=1}if(a)throw new sjcl.exception.bug("random: addEntropy only supports number, array of numbers or string");this.m[o]+=e,this.f+=e,n===this.u&&(this.isReady()!==this.u&&A("seeded",Math.max(this.o,this.f)),A("progress",this.getProgress()))},isReady(t){return t=this.T[void 0!==t?t:this.M],this.o&&this.o>=t?this.m[0]>this.ba&&(new Date).valueOf()>this.Z?this.J|this.I:this.I:this.f>=t?this.J|this.u:this.u},getProgress(t){return t=this.T[t||this.M],this.o>=t?1:this.f>t?1:this.f/t},startCollectors(){if(!this.D){if(this.a={loadTimeCollector:B(this,this.ma),mouseCollector:B(this,this.oa),keyboardCollector:B(this,this.la),accelerometerCollector:B(this,this.ea),touchCollector:B(this,this.qa)},window.addEventListener)window.addEventListener("load",this.a.loadTimeCollector,!1),window.addEventListener("mousemove",this.a.mouseCollector,!1),window.addEventListener("keypress",this.a.keyboardCollector,!1),window.addEventListener("devicemotion",this.a.accelerometerCollector,!1),window.addEventListener("touchmove",this.a.touchCollector,!1);else{if(!document.attachEvent)throw new sjcl.exception.bug("can\'t attach event");document.attachEvent("onload",this.a.loadTimeCollector),document.attachEvent("onmousemove",this.a.mouseCollector),document.attachEvent("keypress",this.a.keyboardCollector)}this.D=!0}},stopCollectors(){this.D&&(window.removeEventListener?(window.removeEventListener("load",this.a.loadTimeCollector,!1),window.removeEventListener("mousemove",this.a.mouseCollector,!1),window.removeEventListener("keypress",this.a.keyboardCollector,!1),window.removeEventListener("devicemotion",this.a.accelerometerCollector,!1),window.removeEventListener("touchmove",this.a.touchCollector,!1)):document.detachEvent&&(document.detachEvent("onload",this.a.loadTimeCollector),document.detachEvent("onmousemove",this.a.mouseCollector),document.detachEvent("keypress",this.a.keyboardCollector)),this.D=!1)},addEventListener(t,e){this.K[t][this.ga++]=e},removeEventListener(t,e){let s,i,c=this.K[t],r=[];for(i in c)c.hasOwnProperty(i)&&c[i]===e&&r.push(i);for(s=0;s<r.length;s++)delete c[i=r[s]]},la(){C(this,1)},oa(t){let e,s;try{e=t.x||t.clientX||t.offsetX||0,s=t.y||t.clientY||t.offsetY||0}catch(t){s=e=0}0!=e&&0!=s&&this.addEntropy([e,s],2,"mouse"),C(this,0)},qa(t){t=t.touches[0]||t.changedTouches[0],this.addEntropy([t.pageX||t.clientX,t.pageY||t.clientY],1,"touch"),C(this,0)},ma(){C(this,2)},ea(t){if(t=t.accelerationIncludingGravity.x||t.accelerationIncludingGravity.y||t.accelerationIncludingGravity.z,window.orientation){let t=window.orientation;"number"==typeof t&&this.addEntropy(t,1,"accelerometer")}t&&this.addEntropy(t,2,"accelerometer"),C(this,0)}},sjcl.random=new sjcl.prng(6);t:try{let t,e,s,i;if(i="undefined"!=typeof module&&module.exports){let t;try{t=require("crypto")}catch(e){t=null}i=e=t}if(i&&e.randomBytes)t=e.randomBytes(128),t=new Uint32Array(new Uint8Array(t).buffer),sjcl.random.addEntropy(t,1024,"crypto[\'randomBytes\']");else if("undefined"!=typeof window&&"undefined"!=typeof Uint32Array){if(s=new Uint32Array(32),window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(s);else{if(!window.msCrypto||!window.msCrypto.getRandomValues)break t;window.msCrypto.getRandomValues(s)}sjcl.random.addEntropy(s,1024,"crypto[\'getRandomValues\']")}}catch(t){"undefined"!=typeof window&&window.console&&(console.log("There was an error collecting entropy from the browser:"),console.log(t))}sjcl.json={defaults:{v:1,iter:1e4,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},ja(t,e,s,i){s=s||{},i=i||{};let c=sjcl.json,r=c.g({iv:sjcl.random.randomWords(4,0)},c.defaults),o;if(c.g(r,s),s=r.adata,"string"==typeof r.salt&&(r.salt=sjcl.codec.base64.toBits(r.salt)),"string"==typeof r.iv&&(r.iv=sjcl.codec.base64.toBits(r.iv)),!sjcl.mode[r.mode]||!sjcl.cipher[r.cipher]||"string"==typeof t&&100>=r.iter||64!==r.ts&&96!==r.ts&&128!==r.ts||128!==r.ks&&192!==r.ks&&256!==r.ks||2>r.iv.length||4<r.iv.length)throw new sjcl.exception.invalid("json encrypt: invalid parameters");return"string"==typeof t?(t=(o=sjcl.misc.cachedPbkdf2(t,r)).key.slice(0,r.ks/32),r.salt=o.salt):sjcl.ecc&&t instanceof sjcl.ecc.elGamal.publicKey&&(o=t.kem(),r.kemtag=o.tag,t=o.key.slice(0,r.ks/32)),"string"==typeof e&&(e=sjcl.codec.utf8String.toBits(e)),"string"==typeof s&&(r.adata=s=sjcl.codec.utf8String.toBits(s)),o=new sjcl.cipher[r.cipher](t),c.g(i,r),i.key=t,r.ct="ccm"===r.mode&&sjcl.arrayBuffer&&sjcl.arrayBuffer.ccm&&e instanceof ArrayBuffer?sjcl.arrayBuffer.ccm.encrypt(o,e,r.iv,s,r.ts):sjcl.mode[r.mode].encrypt(o,e,r.iv,s,r.ts),r},encrypt(t,e,s,i){let c=sjcl.json,r=c.ja.apply(c,arguments);return c.encode(r)},ia(t,e,s,i){s=s||{},i=i||{};let c=sjcl.json,r,o;if(r=(e=c.g(c.g(c.g({},c.defaults),e),s,!0)).adata,"string"==typeof e.salt&&(e.salt=sjcl.codec.base64.toBits(e.salt)),"string"==typeof e.iv&&(e.iv=sjcl.codec.base64.toBits(e.iv)),!sjcl.mode[e.mode]||!sjcl.cipher[e.cipher]||"string"==typeof t&&100>=e.iter||64!==e.ts&&96!==e.ts&&128!==e.ts||128!==e.ks&&192!==e.ks&&256!==e.ks||!e.iv||2>e.iv.length||4<e.iv.length)throw new sjcl.exception.invalid("json decrypt: invalid parameters");return"string"==typeof t?(t=(o=sjcl.misc.cachedPbkdf2(t,e)).key.slice(0,e.ks/32),e.salt=o.salt):sjcl.ecc&&t instanceof sjcl.ecc.elGamal.secretKey&&(t=t.unkem(sjcl.codec.base64.toBits(e.kemtag)).slice(0,e.ks/32)),"string"==typeof r&&(r=sjcl.codec.utf8String.toBits(r)),o=new sjcl.cipher[e.cipher](t),r="ccm"===e.mode&&sjcl.arrayBuffer&&sjcl.arrayBuffer.ccm&&e.ct instanceof ArrayBuffer?sjcl.arrayBuffer.ccm.decrypt(o,e.ct,e.iv,e.tag,r,e.ts):sjcl.mode[e.mode].decrypt(o,e.ct,e.iv,r,e.ts),c.g(i,e),i.key=t,1===s.raw?r:sjcl.codec.utf8String.fromBits(r)},decrypt(t,e,s,i){let c=sjcl.json;return c.ia(t,c.decode(e),s,i)},encode(t){let e,s="{",i="";for(e in t)if(t.hasOwnProperty(e)){if(!e.match(/^[a-z0-9]+$/i))throw new sjcl.exception.invalid("json encode: invalid property name");switch(s+=`${i}"${e}":`,i=",",typeof t[e]){case"number":case"boolean":s+=t[e];break;case"string":s+=\'"\'+encodeURI(t[e])+\'"\';break;case"object":s+=\'"\'+sjcl.codec.base64.fromBits(t[e],0)+\'"\';break;default:throw new sjcl.exception.bug("json encode: unsupported type")}}return s+"}"},decode(t){if(!(t=t.replace(/\\s/g,"")).match(/^\\{.*\\}$/))throw new sjcl.exception.invalid("json decode: this isn\'t json!");t=t.replace(/^\\{|\\}$/g,"").split(/,/);let e={},s,i;for(s=0;s<t.length;s++){if(!(i=t[s].match(/^\\s*(?:(["\']?)([a-z][a-z0-9]*)\\1)\\s*:\\s*(?:(-?\\d+)|"([a-z0-9+\\/%*_.@=\\-]*)"|(true|false))$/i)))throw new sjcl.exception.invalid("json decode: this isn\'t json!");null!=i[3]?e[i[2]]=parseInt(i[3],10):null!=i[4]?e[i[2]]=i[2].match(/^(ct|adata|salt|iv)$/)?sjcl.codec.base64.toBits(i[4]):unescape(i[4]):null!=i[5]&&(e[i[2]]="true"===i[5])}return e},g(t,e,s){if(void 0===t&&(t={}),void 0===e)return t;for(let i in e)if(e.hasOwnProperty(i)){if(s&&void 0!==t[i]&&t[i]!==e[i])throw new sjcl.exception.invalid("required parameter overridden");t[i]=e[i]}return t},sa(t,e){let s={},i;for(i in t)t.hasOwnProperty(i)&&t[i]!==e[i]&&(s[i]=t[i]);return s},ra(t,e){let s={},i;for(i=0;i<e.length;i++)void 0!==t[e[i]]&&(s[e[i]]=t[e[i]]);return s}},sjcl.encrypt=sjcl.json.encrypt,sjcl.decrypt=sjcl.json.decrypt,sjcl.misc.pa={},sjcl.misc.cachedPbkdf2=function(t,e){let s=sjcl.misc.pa,i;return i=(e=e||{}).iter||1e3,(i=(s=s[t]=s[t]||{})[i]=s[i]||{firstSalt:e.salt&&e.salt.length?e.salt.slice(0):sjcl.random.randomWords(2,0)})[s=void 0===e.salt?i.firstSalt:e.salt]=i[s]||sjcl.misc.pbkdf2(t,s,e.iter),{key:i[s].slice(0),salt:s.slice(0)}};'},"smalltalk.js":{requiresElectron:!1,requiresBrowser:!0,code:'"use strict";$("head").append("<style>.smalltalk{display:flex;align-items:center;flex-direction:column;justify-content:center;transition:200ms opacity;bottom:0;left:0;overflow:auto;padding:20px;position:fixed;right:0;top:0;z-index:100}.smalltalk + .smalltalk{transition:ease 1s;display:none}.smalltalk .page{border-radius:3px;background:white;box-shadow:0 4px 23px 5px rgba(0, 0, 0, .2), 0 2px 6px rgba(0, 0, 0, .15);color:#333;min-width:400px;padding:0;position:relative;z-index:0}@media only screen and (max-width: 500px){.smalltalk .page{min-width:0}}.smalltalk .page > .close-button{background: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAQAAAC1QeVaAAAAUklEQVR4XqXPYQrAIAhAYW/gXd8NJxTopVqsGEhtf+L9/ERU2k/HSMFQpKcYJeNFI9Be0LCMij8cYyjj5EHIivGBkwLfrbX3IF8PqumVmnDpEG+eDsKibPG2JwAAAABJRU5ErkJggg==\') no-repeat center;height:14px;position:absolute;right:7px;top:7px;width:14px;z-index:1}.smalltalk .page > .close-button:hover{background-image:url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAQAAAC1QeVaAAAAnUlEQVR4XoWQQQ6CQAxFewjkJkMCyXgJPMk7AiYczyBeZEAX6AKctGIaN+bt+trk9wtGQc/IkhnoKGxqqiWxOSZalapWFZ6VrIUDExsN0a5JRBq9LoVOR0eEQMoEhKizXhhsn0p1sCWVo7CwOf1RytPL8CPvwuBUoHL6ugeK30CVD1TqK7V/hdpe+VNChhOzV8xWny/+xosHF8578W/Hmc1OOC3wmwAAAABJRU5ErkJggg==\')}.smalltalk .page header{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:500px;user-select:none;color:#333;font-size:120%;font-weight:bold;margin:0;padding:14px 17px;text-shadow:white 0 1px 2px}.smalltalk .page .content-area{overflow:hidden;text-overflow:ellipsis;padding:6px 17px;position:relative}.smalltalk .page .action-area{padding:14px 17px}button{font-family:Ubuntu, Arial, sans-serif}.smalltalk .smalltalk,.smalltalk button{min-height:2em;min-width:4em}.smalltalk button{appearance:none;user-select:none;background-image:linear-gradient(#ededed, #ededed 38%, #dedede);border:1px solid rgba(0, 0, 0, 0.25);border-radius:2px;box-shadow:0 1px 0 rgba(0, 0, 0, 0.08), inset 0 1px 2px rgba(255, 255, 255, 0.75);color:#444;font:inherit;margin:0 1px 0 0;text-shadow:0 1px 0 rgb(240, 240, 240)}.smalltalk button::-moz-focus-inner{border:0}.smalltalk button:enabled:active{background-image:linear-gradient(#e7e7e7, #e7e7e7 38%, #d7d7d7);box-shadow:none;text-shadow:none}.smalltalk .page .button-strip{display:flex;flex-direction:row;justify-content:flex-end}.smalltalk .page .button-strip > button{margin-left:10px}.smalltalk input{width:100%;border:1px solid #bfbfbf;border-radius:2px;box-sizing:border-box;color:#444;font:inherit;margin:0;min-height:2em;padding:3px;outline:none}.smalltalk button:enabled:focus,.smalltalk input:enabled:focus{transition:border-color 200ms;border-color:rgb(77, 144, 254);outline:none}");const BUTTON_OK=["OK"],BUTTON_OK_CANCEL=["OK","Cancel"],__smalltalk_remove=__smalltalk_bind(__smalltalk_removeEl,".smalltalk"),__smalltalk_store=t=>{const a={value:t};return function(t){return arguments.length?(a.value=t,t):a.value}};function _alert(t,a){return __smalltalk_showDialog(t,a,"",BUTTON_OK,{cancel:!1})}function _prompt(t,a,e="",l){const n=__smalltalk_getType(l),o=String(e).replace(/"/g,"&quot;"),s=`<input type="${n}" value="${o}" data-name="js-input">`;return __smalltalk_showDialog(t,a,s,BUTTON_OK_CANCEL,l)}function _confirm(t,a,e){return __smalltalk_showDialog(t,a,"",BUTTON_OK_CANCEL,e)}function __smalltalk_getType(t={}){const{type:a}=t;return"password"===a?"password":"text"}function __smalltalk_getTemplate(t,a,e,l){const n=a.replace(/\\n/g,"<br>");return`<div class="page"><div data-name="js-close" class="close-button"></div><header>${t}</header><div class="content-area">${n}${e}</div><div class="action-area"><div class="button-strip"> ${l.map((t,a)=>`<button tabindex=${a} data-name="js-${t.toLowerCase()}">${t}</button>`).join("")}</div></div></div>`}function __smalltalk_showDialog(t,a,e,l,n){const o=__smalltalk_store(),s=__smalltalk_store(),i=document.createElement("div"),r=["cancel","close","ok"],_=new Promise((t,a)=>{const e=n&&!n.cancel,l=()=>{};o(t),s(e?l:a)});return i.innerHTML=__smalltalk_getTemplate(t,a,e,l),i.className="smalltalk",document.body.appendChild(i),__smalltalk_find(i,["ok","input"]).forEach(t=>t.focus()),__smalltalk_find(i,["input"]).forEach(t=>{t.setSelectionRange(0,e.length)}),__smalltalk_addListenerAll("click",i,r,t=>__smalltalk_closeDialog(t.target,i,o(),s())),["click","contextmenu"].forEach(t=>i.addEventListener(t,()=>__smalltalk_find(i,["ok","input"]).forEach(t=>t.focus()))),i.addEventListener("keydown",currify(__smalltalk_keyDownEvent)(i,o(),s())),_}function __smalltalk_keyDownEvent(t,a,e,l){const n={ENTER:13,ESC:27,TAB:9,LEFT:37,UP:38,RIGHT:39,DOWN:40},o=l.keyCode,s=l.target,i=["ok","cancel","input"],r=__smalltalk_find(t,i).map(__smalltalk_getDataName);switch(o){case n.ENTER:__smalltalk_closeDialog(s,t,a,e),l.preventDefault();break;case n.ESC:__smalltalk_remove(),e();break;case n.TAB:l.shiftKey&&__smalltalk_tab(t,r),__smalltalk_tab(t,r),l.preventDefault();break;default:["left","right","up","down"].filter(t=>o===n[t.toUpperCase()]).forEach(()=>{__smalltalk_changeButtonFocus(t,r)})}l.stopPropagation()}function __smalltalk_getDataName(t){return t.getAttribute("data-name").replace("js-","")}function __smalltalk_changeButtonFocus(t,a){const e=document.activeElement,l=__smalltalk_getDataName(e),n=/ok|cancel/.test(l),o=a.length-1,s=t=>"cancel"===t?"ok":"cancel";if("input"===l||!o||!n)return;const i=s(l);__smalltalk_find(t,[i]).forEach(t=>{t.focus()})}const __smalltalk_getIndex=(t,a)=>a===t?0:a+1;function __smalltalk_tab(t,a){const e=document.activeElement,l=__smalltalk_getDataName(e),n=a.length-1,o=a.indexOf(l),s=__smalltalk_getIndex(n,o),i=a[s];__smalltalk_find(t,[i]).forEach(t=>t.focus())}function __smalltalk_closeDialog(t,a,e,l){const n=t.getAttribute("data-name").replace("js-","");if(/close|cancel/.test(n))return l(),void __smalltalk_remove();const o=__smalltalk_find(a,["input"]).reduce((t,a)=>a.value,null);e(o),__smalltalk_remove()}function __smalltalk_find(t,a){return a.map(a=>t.querySelector(`[data-name="js-${a}"]`)).filter(t=>t)}function __smalltalk_addListenerAll(t,a,e,l){__smalltalk_find(a,e).forEach(a=>a.addEventListener(t,l))}function __smalltalk_removeEl(t){const a=document.querySelector(t);a.parentElement.removeChild(a)}function __smalltalk_bind(t,...a){return()=>t(...a)}'}}}start(){const t=this;if(!discordCrypt.validPluginName())return void _alert("Hi There! - DiscordCrypt","Oops!\r\n\r\nIt seems you didn't read discordCrypt's usage guide. :(\r\nYou need to name this plugin exactly as follows to allow it to function correctly.\r\n\r\n"+`\t${discordCrypt.getPluginName()}\r\n\r\n\r\n`+"You should probably check the usage guide again just in case you missed anything else. :)");if(!this.configFile)return void this.loadMasterPassword();discordCrypt.__shouldIgnoreUpdates(this.getVersion())||(this.checkForUpdates(),this.updateHandlerInterval=setInterval(()=>{t.checkForUpdates()},36e5));const e=discordCrypt.getWebpackModuleSearcher();this.cachedModules={MessageParser:e.findByUniqueProperties(["createMessage","parse","unparse"]),MessageController:e.findByUniqueProperties(["sendClydeError","sendBotMessage"]),MessageActionTypes:e.findByUniqueProperties(["ActionTypes","ActivityTypes"]),MessageDispatcher:e.findByUniqueProperties(["dispatch","maybeDispatch","dirtyDispatch"]),MessageQueue:e.findByUniqueProperties(["enqueue","handleSend","handleResponse"]),UserResolver:e.findByUniqueProperties(["getUser","getUsers","findByTag"]),GuildResolver:e.findByUniqueProperties(["getGuild","getGuilds"]),ChannelResolver:e.findByUniqueProperties(["getChannel","getChannels","getDMFromUserId","getDMUserIds"]),HighlightJS:e.findByUniqueProperties(["initHighlighting","highlightBlock","highlightAuto"])};for(let t in this.cachedModules)if("object"!=typeof this.cachedModules[t])return void _alert("Error Loading DiscordCrypt",`Could not find requisite module: ${t}`);this.hookMessageCallbacks()?setImmediate(()=>{this.loadToolbar(),this.attachHandler()}):this.toolbarReloadInterval=setInterval(()=>{t.loadToolbar(),t.attachHandler()},5e3),this.scanInterval=setInterval(()=>{t.decodeMessages()},t.configFile.encryptScanDelay),this.timedMessageInterval=setInterval(()=>{let e=Date.now();t.configFile.timedMessages.forEach((r,s)=>{if(r&&r.expireTime||(t.configFile.timedMessages.splice(s,1),t.saveConfig()),r.expireTime<e){discordCrypt.log(`Deleting timed message "${t.configFile.timedMessages[s].messageId}"`);try{discordCrypt.deleteMessage(r.channelId,r.messageId,t.cachedModules)}catch(r){discordCrypt.log(`${r.messageId}: ${r.toString()}`,"error")}t.configFile.timedMessages.splice(s,1),t.saveConfig()}})},5e3),setImmediate(()=>{t.decodeMessages()})}stop(){discordCrypt.validPluginName()&&($(this.channelTextAreaClass).off("keydown.dcrypt"),this.unhookMessageCallbacks()||clearInterval(this.toolbarReloadInterval),clearInterval(this.scanInterval),clearInterval(this.timedMessageInterval),clearInterval(this.updateHandlerInterval),$("#dc-overlay").remove(),$("#dc-file-btn").remove(),$("#dc-lock-btn").remove(),$("#dc-passwd-btn").remove(),$("#dc-exchange-btn").remove(),$("#dc-settings-btn").remove(),$("#dc-quick-exchange-btn").remove(),$("#dc-clipboard-upload-btn").remove(),this.configFile=null)}load(){discordCrypt.injectCSS("dc-css",this.appCss),discordCrypt.loadLibraries(this.libraries)}unload(){discordCrypt.clearCSS("dc-css")}getDefaultConfig(){return{version:this.getVersion(),useEmbeds:!1,defaultPassword:"\u2813\u28ed\u286b\u28ee\u28b9\u28ae\u2816\u28e6\u282c\u28ac\u28f8\u2833\u281c\u28cd\u28ab\u2833\u28c2\u2819\u28f5\u2858\u2855\u2810\u28ab\u2897\u2819\u2871\u2801\u2877\u283a\u2857\u281f\u2821\u28b4\u2896\u2883\u2859\u28ba\u28c4\u28d1\u28d7\u28ac\u2871\u28f4\u282e\u2843\u288f\u289a\u28a3\u28fe\u288e\u28a9\u28d9\u2801\u28f6\u2881\u2837\u28ce\u2807\u2826\u2883\u2826\u2807\u28e9\u2845",encodeMessageTrigger:"ENC",encryptScanDelay:1e3,encryptMode:7,encryptBlockMode:"CBC",encodeAll:!0,paddingMode:"PKC7",passList:{},up1Host:"https://share.riseup.net",up1ApiKey:"59Mnk5nY6eCn4bi9GvfOXhMH54E7Bh6EMJXtyJfs",timedMessages:[],timedMessageExpires:0}}configExists(){let t=bdPluginStorage.get(this.getName(),"config");return t&&null!==t&&""!==t}loadConfig(){discordCrypt.log("Loading configuration file ...");let t=bdPluginStorage.get(this.getName(),"config");if(!t||null===t||""===t)return this.configFile=this.getDefaultConfig(),this.saveConfig(),!0;try{this.configFile=JSON.parse(discordCrypt.aes256_decrypt_gcm(t.data,this.masterPassword,"PKC7","utf8",!1))}catch(t){return discordCrypt.log(`Decryption of configuration file failed - ${t}`,"error"),!1}if(!this.configFile||!this.configFile.version)return discordCrypt.log("Decryption of configuration file failed.","error"),!1;let e=this.getDefaultConfig(),r=!1;for(let t in e)this.configFile.hasOwnProperty(t)||(this.configFile[t]=e[t],discordCrypt.log(`Default value added for missing property '${t}' in the configuration file.`),r=!0);for(let t in this.configFile)e.hasOwnProperty(t)||(delete this.configFile[t],discordCrypt.log(`Removing unknown property '${t}' from the configuration file.`),r=!0);if(this.configFile.version!==this.getVersion()){let t=this.configFile.version,e=this.configFile.passList;this.configFile=this.getDefaultConfig(),this.configFile.passList=e,r=!0,discordCrypt.log(`Updated plugin version from v${t} to v${this.getVersion()}.`)}return r&&this.saveConfig(),discordCrypt.log(`Loaded configuration file! - v${this.configFile.version}`),!0}saveConfig(){bdPluginStorage.set(this.getName(),"config",{data:discordCrypt.aes256_encrypt_gcm(JSON.stringify(this.configFile),this.masterPassword,"PKC7",!1)})}saveSettings(t){this.saveConfig(),t.text("Saved & Applied!"),setTimeout(function(){t.text("Save & Apply")},1e3),this.decodeMessages(!0)}resetSettings(t){let e=this.configFile.passList;this.configFile=this.getDefaultConfig(),this.configFile.passList=e,this.saveConfig(),t.text("Restored Default Settings!"),setTimeout(function(){t.text("Reset Settings")},1e3),this.decodeMessages(!0)}updatePasswords(){if("block"!==$("#dc-overlay-password").css("display"))return;let t=$("#dc-password-primary"),e=$("#dc-password-secondary");""!==t.val()&&t.val().length>1?(this.configFile.passList[discordCrypt.getChannelId()]=discordCrypt.createPassword(t.val(),""),""!==e.val()&&e.val().length>1&&(this.configFile.passList[discordCrypt.getChannelId()].secondary=e.val()),t.val(""),e.val("")):delete this.configFile.passList[discordCrypt.getChannelId()],this.saveConfig(),this.decodeMessages(!0)}static sanitizeScriptNameToVariable(t){return t.replace(".js","")}static loadLibraries(t){const e=require("vm");for(let r in t){let s=t[r];if(s.requiresBrowser&&"undefined"==typeof window)discordCrypt.log(`Skipping loading of browser-required plugin: ${r} ...`,"warn");else{if(s.requiresElectron)try{require("electron")}catch(t){discordCrypt.log(`Skipping loading of electron-required plugin: ${r} ...`,"warn");continue}s.requiresBrowser||s.requiresElectron?e.runInThisContext(s.code,{filename:r,displayErrors:!1}):global[discordCrypt.sanitizeScriptNameToVariable(r)]=e.runInNewContext(s.code,{filename:r,displayErrors:!1})}}}static getPluginName(){return"discordCrypt.plugin.js"}static validPluginName(){return require("fs").existsSync(require("path").join(discordCrypt.getPluginsPath(),discordCrypt.getPluginName()))}static getPluginsPath(){const t=require("process");return`${"win32"===t.platform?t.env.APPDATA:"darwin"===t.platform?t.env.HOME+"/Library/Preferences":t.env.HOME+"/.config"}/BetterDiscord/plugins/`}static checkForUpdate(t){const e=`https://gitlab.com/leogx9r/DiscordCrypt/raw/master/build/${discordCrypt.getPluginName()}`,r="https://gitlab.com/leogx9r/DiscordCrypt/raw/master/src/CHANGELOG";if("function"!=typeof t)return!1;try{discordCrypt.__getRequest(e,(e,s,i)=>{if(200!==e){switch(e){case 404:discordCrypt.log("Update URL is broken.","error");break;case 403:discordCrypt.log("Forbidden request when checking for updates.","error");break;default:discordCrypt.log(`Error while fetching update: ${s}`,"error")}return}i=i.replace("\r","");let o='//META{"name":"discordCrypt"}*//\n';try{o=require("fs").readFileSync(require("path").join(discordCrypt.getPluginsPath(),discordCrypt.getPluginName())).toString().replace("\r","")}catch(t){discordCrypt.log("Plugin file could not be locally read. Assuming testing version ...","warn")}if(i.split("\n")[0]!==o.split("\n")[0])return void discordCrypt.log("Plugin metadata is missing from either the local or update file.","error");let n=discordCrypt.sha256(o),a=discordCrypt.sha256(i),c=Buffer.from(a,"base64").toString("hex").slice(0,8);if(a===n)return discordCrypt.log(`No Update Needed - #${c}`),!0;let l="";try{l=i.match(/((["'])(\d+\.)(\d+\.)(\*|\d+)(["']))/gi).toString().replace(/(['|"]*['|"])/g,"")}catch(t){discordCrypt.log("Failed to locate the version number in the update ...","warn")}try{discordCrypt.__getRequest(r,(e,r,s)=>{t(i,c,l,200==e?s:"")})}catch(e){discordCrypt.log("Error fetching the changelog.","warn"),t(i,c,l,"")}})}catch(t){return discordCrypt.log(`Error while retrieving update: ${t.toString()}`,"warn"),!1}return!0}static getChannelId(){return window.location.pathname.split("/").pop()}static createPassword(t,e){return{primary:t,secondary:e}}static getWebpackModuleSearcher(){const t="function"==typeof webpackJsonp?webpackJsonp([],{__extra_id__:(t,e,r)=>e.default=r},["__extra_id__"]).default:webpackJsonp.push([[],{__extra_id__:(t,e,r)=>t.exports=r},[["__extra_id__"]]]);delete t.m.__extra_id__,delete t.c.__extra_id__;const e=(e,r)=>{for(let r in t.c)if(t.c.hasOwnProperty(r)){let s=t.c[r].exports;if(s&&s.__esModule&&s.default&&(s=s.default),s&&e(s))return s}if(r){discordCrypt.log("Couldn't find module in existing cache. Loading all modules.","warn");for(let r=0;r<t.m.length;++r)try{let s=t(r);if(s&&s.__esModule&&s.default&&e(s.default))return s.default;if(s&&e(s))return s}catch(t){discordCrypt.log(`Could not load module index ${r} ...`,"warn")}discordCrypt.log("Cannot find React module.","warn")}return null},r=(t,r=!1)=>e(e=>t.every(t=>void 0!==e[t]),r),s=(t,r=!1)=>e(e=>e.displayName===t,r),i=(t,r=!1)=>e(e=>void 0!==e._dispatchToken&&e._dispatchToken===`ID_${t}`&&void 0!==e._actionHandlers,r),o=t=>{for(let e=0;e<500;e++){let r=i(e);if(r&&t.every(t=>r._actionHandlers.hasOwnProperty(t)))return r}return null};return{find:e,findByUniqueProperties:r,findByDisplayName:s,findByDispatchToken:i,findByDispatchNames:o}}static dumpWebpackModuleCallbacks(t=!0){let e=discordCrypt.getWebpackModuleSearcher().findByDispatchToken,r=[];for(let s=0;s<1e3;s++){let i=e(s);if(i){r[s]={};for(let e in i)if("_dependencies"!=e)if("_actionHandlers"==e||"_changeCallbacks"==e){if(!t)continue;r[s][e]={};for(let t in i[e])i._actionHandlers.hasOwnProperty(t)&&(r[s][e][t]=i[e][t].prototype.constructor.toString().split("{")[0])}else r[s][e]=i[e].toString().split("{")[0]}}return r}static getReactModules(t){const e=["@me","activity"];return t?{ChannelProps:-1!==e.indexOf(discordCrypt.getChannelId())?null:discordCrypt.__getElementReactOwner($("form")[0]).props.channel,MessageParser:t.MessageParser,MessageController:t.MessageController,MessageActionTypes:t.MessageActionTypes,MessageDispatcher:t.MessageDispatcher,MessageQueue:t.MessageQueue,UserResolver:t.UserResolver,GuildResolver:t.GuildResolver,ChannelResolver:t.ChannelResolver,HighlightJS:t.HighlightJS}:null}static editMessage(t,e,r,s){s.MessageController.editMessage(t,e,{content:r})}static deleteMessage(t,e,r){r.MessageController.deleteMessage(t,e)}static dispatchMessage(t,e,r,s,i=5577355,o="",n,a,c,l=0){let d=!1;const p=discordCrypt.getReactModules(a);if("string"==typeof o&&o.length){if(null===p.MessageParser)return void discordCrypt.log("Could not locate the MessageParser module!","error");try{((o=p.MessageParser.parse(p.ChannelProps,o).content).includes("@everyone")||o.includes("@here"))&&(d=!0)}catch(t){o=""}}else o="";let u=void 0!==n?n:discordCrypt.getChannelId();if(null===p.MessageQueue)return void discordCrypt.log("Could not locate the MessageQueue module!","error");if(null===p.MessageController)return void discordCrypt.log("Could not locate the MessageController module!","error");const h=t=>{if(t.ok)p.MessageController.receiveMessage(u,t.body),c&&l>0&&c.push({messageId:t.body.id,channelId:u,expireTime:Date.now()+6e4*l});else if(t.status>=400&&t.status<500&&t.body&&!p.MessageController.sendClydeError(u,t.body.code)){if(discordCrypt.log(`Error sending message: ${t.status}`,"error"),null===p.MessageDispatcher||null===p.MessageActionTypes)return void discordCrypt.log("Could not locate the MessageDispatcher module!","error");p.MessageDispatcher.dispatch({type:p.MessageActionTypes.ActionTypes.MESSAGE_SEND_FAILED,messageId:_nonce,channelId:u})}};if(t){let t=parseInt(require("crypto").pseudoRandomBytes(6).toString("hex"),16);p.MessageQueue.enqueue({type:"send",message:{channelId:u,nonce:t,content:o,mention_everyone:d,tts:!1,embed:{type:"rich",url:"https://gitlab.com/leogx9r/DiscordCrypt",color:i||5577355,output_mime_type:"text/x-html",timestamp:(new Date).toISOString(),encoding:"utf-16",author:{name:r||"-----MESSAGE-----",icon_url:"https://gitlab.com/leogx9r/DiscordCrypt/raw/master/images/encode-logo.png",url:"https://discord.me/discordCrypt"},footer:{text:s||"DiscordCrypt",icon_url:"https://gitlab.com/leogx9r/DiscordCrypt/raw/master/images/app-logo.png"},description:e}}},h)}else[e,o].forEach(t=>{if(!t.length)return;let e=parseInt(require("crypto").pseudoRandomBytes(6).toString("hex"),16);p.MessageQueue.enqueue({type:"send",message:{channelId:u,nonce:e,content:t===o?t:`\`${t}\``,mention_everyone:t===o&&d,tts:!1}},h)})}static log(t,e="info"){try{console[e](`%c[DiscordCrypt]%c - ${t}`,"color: #7f007f; font-weight: bold;","")}catch(t){console.error("[DiscordCrypt] - Error logging message ...")}}static injectCSS(t,e){$("head").append($("<style>",{id:t.replace(/^[^a-z]+|[^\w-]+/gi,""),html:e}))}static clearCSS(t){t&&"string"==typeof t&&t.length&&$(`#${t.replace(/^[^a-z]+|[^\w-]+/gi,"")}`).remove()}static hookDispatcher(t,e,r){const{before:s,after:i,instead:o,once:n=!1,silent:a=!1}=r,c=t._actionHandlers[e],l=()=>{a||discordCrypt.log(`Unhooking "${e}" ...`),t[e]=c},d=(t,e)=>(...r)=>{try{return t(...r)}catch(t){discordCrypt.log(`Error occurred in ${e}`,"error")}};return t._actionHandlers[e].__hooked||(a||discordCrypt.log(`Hooking "${e}" ...`),t._actionHandlers[e]=function(){const t={thisObject:this,methodArguments:arguments,cancelPatch:l,originalMethod:c,callOriginalMethod:()=>t.returnValue=t.originalMethod.apply(t.thisObject,t.methodArguments)};if(o){const r=d(o,`${e} called hook via 'instead'.`)(t);void 0!==r&&(t.returnValue=r)}else s&&d(s,`${e} called hook via 'before'.`)(t),t.callOriginalMethod(),i&&d(i,`${e} called hook via 'after'.`)(t);return n&&l(),t.returnValue},t._actionHandlers[e].__hooked=!0,t._actionHandlers[e].__cancel=l),t._actionHandlers[e].__cancel}hookMessageCallbacks(){if(this.messageUpdateDispatcher||(this.messageUpdateDispatcher=discordCrypt.getWebpackModuleSearcher().findByDispatchNames(["LOAD_MESSAGES","LOAD_MESSAGES_SUCCESS","LOAD_MESSAGES_FAILURE","TRUNCATE_MESSAGES","MESSAGE_CREATE","MESSAGE_UPDATE","MESSAGE_DELETE","MESSAGE_DELETE_BULK","MESSAGE_REVEAL","CHANNEL_SELECT","CHANNEL_CREATE","CHANNEL_PRELOAD","GUILD_CREATE","GUILD_SELECT","GUILD_DELETE"])),!this.messageUpdateDispatcher)return discordCrypt.log("Failed to locate the switch event dispatcher!","error"),!1;discordCrypt.hookDispatcher(this.messageUpdateDispatcher,"CHANNEL_SELECT",{after:t=>{discordCrypt.getChannelId()===t.methodArguments[0].channelId&&setTimeout(()=>{discordCrypt.log("Detected chat switch.","debug"),this.loadToolbar(),this.attachHandler(),this.decodeMessages()},1)}});let t={after:t=>{discordCrypt.getChannelId()===t.methodArguments[0].channelId&&setTimeout(()=>{this.decodeMessages()},1)}};return discordCrypt.hookDispatcher(this.messageUpdateDispatcher,"MESSAGE_CREATE",t),discordCrypt.hookDispatcher(this.messageUpdateDispatcher,"MESSAGE_UPDATE",t),discordCrypt.hookDispatcher(this.messageUpdateDispatcher,"MESSAGE_DELETE",t),!0}unhookMessageCallbacks(){if(!this.messageUpdateDispatcher)return!1;for(let t in this.messageUpdateDispatcher._actionHandlers)t.hasOwnProperty("__cancel")&&t.__cancel();return!0}loadMasterPassword(){const t=this;if(0!==$("#dc-master-overlay").length)return;const e=this.configExists(),r=e?"Unlock Database":"Create Database";$(document.body).prepend(this.masterPasswordHtml);const s=$("#dc-db-password"),i=$("#dc-cancel-btn"),o=$("#dc-unlock-database-btn"),n=$("#dc-master-status"),a=$("#dc-header-master-msg"),c=$("#dc-prompt-master-msg");a.text(e?"---------- Database Is Locked ----------":"---------- Database Not Found ----------"),c.text(e?"Enter Password:":"Enter New Password:"),o.text(r),document.getElementById("dc-master-overlay").style.display="block",s.on("keydown",function(t){let e;13===(t.keyCode||t.which)&&o.click()}),o.click(discordCrypt.on_master_unlock_button_clicked(this,o,e,s,r,n)),i.click(discordCrypt.on_master_cancel_button_clicked(this))}checkForUpdates(){const t=this;setTimeout(()=>{try{discordCrypt.checkForUpdate((e,r,s,i)=>{const o=require("path").join(discordCrypt.getPluginsPath(),discordCrypt.getPluginName()),n=require("fs");$("#dc-overlay").css("display","block"),$("#dc-update-overlay").css("display","block"),$("#dc-new-version").text(`New Version: ${""===s?"N/A":s} ( #${r} )`),$("#dc-old-version").text(`Old Version: ${t.getVersion()}`);let a=$("#dc-changelog");a.val("string"==typeof i&&i.length>0?i:"N/A"),a.scrollTop(0),n.writeFile(o,e,t=>{t&&(discordCrypt.log(`Unable to replace the target plugin. ( ${t} )\nDestination: ${o}`,"error"),_alert("Error During Update","Failed to apply the update!"))})})}catch(t){discordCrypt.log(t,"warn")}},1e3)}static setActiveSettingsTab(t){let e=["dc-plugin-settings-tab","dc-database-settings-tab"],r=$("#dc-settings-tab .dc-tab-link");for(let t=0;t<e.length;t++)$(`#${e[t]}`).css("display","none");switch(r.removeClass("active"),t){case 0:$("#dc-plugin-settings-btn").addClass("active"),$("#dc-plugin-settings-tab").css("display","block");break;case 1:$("#dc-database-settings-btn").addClass("active"),$("#dc-database-settings-tab").css("display","block")}}static setActiveExchangeTab(t){let e=["dc-about-tab","dc-keygen-tab","dc-handshake-tab"],r=$("#dc-exchange-tab .dc-tab-link");for(let t=0;t<e.length;t++)$(`#${e[t]}`).css("display","none");switch(r.removeClass("active"),t){case 0:$("#dc-tab-info-btn").addClass("active"),$("#dc-about-tab").css("display","block");break;case 1:$("#dc-tab-keygen-btn").addClass("active"),$("#dc-keygen-tab").css("display","block");break;case 2:$("#dc-tab-handshake-btn").addClass("active"),$("#dc-handshake-tab").css("display","block")}}loadToolbar(){if(!this.configFile)return;if("@me"===discordCrypt.getChannelId())return;if(0!==$("#dc-passwd-btn").length)return;$(this.searchUiClass).parent().parent().parent().prepend(this.toolbarHtml);let t=$("#dc-passwd-btn"),e=$("#dc-lock-btn"),r=$(".dc-svg");r.attr("class","dc-svg"),e.length>0&&(this.configFile.encodeAll?(e.attr("title","Disable Message Encryption"),e.html(Buffer.from(this.lockIcon,"base64").toString("utf8"))):(e.attr("title","Enable Message Encryption"),e.html(Buffer.from(this.unlockIcon,"base64").toString("utf8"))),r.attr("class","dc-svg")),$(document.body).prepend(this.settingsMenuHtml),discordCrypt.setActiveSettingsTab(0),discordCrypt.setActiveExchangeTab(0),$("#dc-secondary-cipher").val(discordCrypt.cipherIndexToString(this.configFile.encryptMode,!0)),$("#dc-primary-cipher").val(discordCrypt.cipherIndexToString(this.configFile.encryptMode,!1)),$("#dc-settings-cipher-mode").val(this.configFile.encryptBlockMode.toLowerCase()),$("#dc-settings-padding-mode").val(this.configFile.paddingMode.toLowerCase()),$("#dc-settings-encrypt-trigger").val(this.configFile.encodeMessageTrigger),$("#dc-settings-timed-expire").val(this.configFile.timedMessageExpires),$("#dc-settings-default-pwd").val(this.configFile.defaultPassword),$("#dc-settings-scan-delay").val(this.configFile.encryptScanDelay),$("#dc-embed-enabled").prop("checked",this.configFile.useEmbeds),$("#dc-clipboard-upload-btn").click(discordCrypt.on_upload_encrypted_clipboard_button_clicked(this)),$("#dc-file-btn").click(discordCrypt.on_file_button_clicked),$("#dc-select-file-path-btn").click(discordCrypt.on_alter_file_button_clicked),$("#dc-file-upload-btn").click(discordCrypt.on_upload_file_button_clicked(this)),$("#dc-file-cancel-btn").click(discordCrypt.on_cancel_file_upload_button_clicked),$("#dc-settings-btn").click(discordCrypt.on_settings_button_clicked),$("#dc-plugin-settings-btn").click(discordCrypt.on_plugin_settings_tab_button_clicked),$("#dc-database-settings-btn").click(discordCrypt.on_database_settings_tab_button_clicked(this)),$("#dc-import-database-btn").click(discordCrypt.on_import_database_button_clicked(this)),$("#dc-export-database-btn").click(discordCrypt.on_export_database_button_clicked(this)),$("#dc-erase-entries-btn").click(discordCrypt.on_clear_entries_button_clicked(this)),$("#dc-exit-settings-btn").click(discordCrypt.on_settings_close_button_clicked),$("#dc-settings-save-btn").click(discordCrypt.on_save_settings_button_clicked(this)),$("#dc-settings-reset-btn").click(discordCrypt.on_reset_settings_button_clicked(this)),$("#dc-restart-now-btn").click(discordCrypt.on_restart_now_button_clicked),$("#dc-restart-later-btn").click(discordCrypt.on_restart_later_button_clicked),$("#dc-tab-info-btn").click(discordCrypt.on_info_tab_button_clicked),$("#dc-tab-keygen-btn").click(discordCrypt.on_exchange_tab_button_clicked),$("#dc-tab-handshake-btn").click(discordCrypt.on_handshake_tab_button_clicked),$("#dc-exit-exchange-btn").click(discordCrypt.on_close_exchange_button_clicked),$("#dc-exchange-btn").click(discordCrypt.on_open_exchange_button_clicked),$("#dc-quick-exchange-btn").click(discordCrypt.on_quick_send_public_key_button_clicked),$("#dc-keygen-method").change(discordCrypt.on_exchange_algorithm_changed),$("#dc-keygen-gen-btn").click(discordCrypt.on_generate_new_key_pair_button_clicked),$("#dc-keygen-clear-btn").click(discordCrypt.on_keygen_clear_button_clicked),$("#dc-keygen-send-pub-btn").click(discordCrypt.on_keygen_send_public_key_button_clicked(this)),$("#dc-handshake-paste-btn").click(discordCrypt.on_handshake_paste_public_key_button_clicked),$("#dc-handshake-compute-btn").click(discordCrypt.on_handshake_compute_button_clicked(this)),$("#dc-handshake-cpy-keys-btn").click(discordCrypt.on_handshake_copy_keys_button_clicked),$("#dc-handshake-apply-keys-btn").click(discordCrypt.on_handshake_apply_keys_button_clicked(this)),t.click(discordCrypt.on_passwd_button_clicked),$("#dc-save-pwd").click(discordCrypt.on_save_passwords_button_clicked(this)),$("#dc-reset-pwd").click(discordCrypt.on_reset_passwords_button_clicked(this)),$("#dc-cancel-btn").click(discordCrypt.on_cancel_password_button_clicked),$("#dc-cpy-pwds-btn").click(discordCrypt.on_copy_current_passwords_button_clicked(this)),e.click(discordCrypt.on_lock_button_clicked(this))}attachHandler(){const t=this;let e=$(this.channelTextAreaClass);1===e.length&&e.off("keydown.dcrypt").on("keydown.dcrypt",function(e){let r=e.keyCode||e.which;t.configFile&&13===r&&(e.shiftKey||$(t.autoCompleteClass)[0]||0==t.sendEncryptedMessage($(this).val())&&(discordCrypt.__getElementReactOwner($("form")[0]).setState({textValue:""}),e.preventDefault(),e.stopPropagation()))})}parseKeyMessage(t){let e=discordCrypt.__extractKeyInfo(t.text().replace(/\r?\n|\r/g,""),!0);if(null===e)return!0;let r=discordCrypt.sha256(Buffer.from($("#dc-pub-key-ta").val(),"hex"),"hex");if(e.fingerprint===r)return t.css("display","none"),!0;let s=$("<button>Perform Key Exchange</button>").addClass("dc-button").addClass("dc-button-inverse");return s.css("margin-left","0"),s.css("margin-right","0"),s.css("margin-top","2%"),s.css("width","100%"),s.click(function(){let r=$("#dc-keygen-method"),s=$("#dc-keygen-algorithm");$("#dc-exchange-btn").click(),r.val()!==e.algorithm||parseInt(s.val())!==e.bit_length?(r.val(e.algorithm),r.change(),s.val(e.bit_length),$("#dc-keygen-gen-btn").click(),$("#dc-keygen-send-pub-btn").click()):""===$("#dc-pub-key-ta").val()&&($("#dc-keygen-gen-btn").click(),$("#dc-keygen-send-pub-btn").click()),$("#dc-tab-handshake-btn").click(),$("#dc-handshake-ppk").val(t.text()),$("#dc-handshake-compute-btn").click()}),t.parent().append(s),t.css("color","blue"),!0}parseSymmetric(t,e,r,s,i){let o=$(t),n;if(o.text().length<=12)return!1;let a=o.text().slice(0,4);if(a===this.encodedKeyHeader)return this.parseKeyMessage(o);if(a!==this.encodedMessageHeader)return!1;let c=discordCrypt.metaDataDecode(o.text().slice(4,8));if(c[0]>=this.encryptModes.length)return!1;if(c[1]>=this.encryptBlockModes.length)return!1;if(c[2]>=this.paddingModes.length)return!1;if(("string"==typeof(n=discordCrypt.symmetricDecrypt(o.text().replace(/\r?\n|\r/g,"").substr(8),e,r,c[0],c[1],c[2],!0))||n instanceof String)&&""!==n){if(s&&o.parent().parent().parent().parent().css("max-width","100%"),n=discordCrypt.postProcessMessage(n,this.configFile.up1Host),s)o.html(n.html);else{let t=o.parent();o.parent().html(n.html),o=$(t)}if(n.code)if(null!==i.HighlightJS){let t=$(o.children()[0]).children();for(let e=0;e<t.length;e++)i.HighlightJS.highlightBlock($(t[e]).children()[0]),$(t[e]).children().addClass("hljs")}else discordCrypt.log("Could not locate HighlightJS module!","error");o.css("color","green")}else 1===n?o.text("[ ERROR ] AUTHENTICATION OF CIPHER TEXT FAILED !!!"):2===n?o.text("[ ERROR ] FAILED TO DECRYPT CIPHER TEXT !!!"):o.text("[ ERROR ] DECRYPTION FAILURE. INVALID KEY OR MALFORMED MESSAGE !!!"),o.css("color","red");return!0}static postProcessMessage(t,e){const r={"&":"&amp;","<":"&lt",">":"&gt;"};t=t.replace(/[&<>]/g,t=>r[t]);let s=discordCrypt.__buildCodeBlockMessage(t),i=s.code,o;return{url:(s=discordCrypt.__buildUrlMessage(s.html,e)).url,code:i,html:s.html}}decodeMessages(){if(!this.configFile||!this.configFile.version)return;const t=this;let e=discordCrypt.getChannelId(),r=Buffer.from(this.configFile.passList[e]&&this.configFile.passList[e].primary?this.configFile.passList[e].primary:this.configFile.defaultPassword),s=Buffer.from(this.configFile.passList[e]&&this.configFile.passList[e].secondary?this.configFile.passList[e].secondary:this.configFile.defaultPassword),i=discordCrypt.getReactModules(this.cachedModules);$(this.messageMarkupClass).each(function(){this.className.includes("embedDescription")&&void 0===$(this).data("dc-parsed")&&(t.parseSymmetric(this,r,s,!0,i),$(this).data("dc-parsed",!0))}),$(`${this.messageMarkupClass} .inline`).each(function(){void 0===$(this).data("dc-parsed")&&(t.parseSymmetric(this,r,s,!1,i),$(this).data("dc-parsed",!0))})}sendEncryptedMessage(t,e=!1,r){const s=1820,i=["#","/",":"],o=require("crypto");let n;if(-1!==i.indexOf(t[0]))return 1;if(!1!==e||this.configFile.passList[discordCrypt.getChannelId()]&&this.configFile.passList[discordCrypt.getChannelId()].primary&&this.configFile.encodeAll)n=t;else{if((t=t.split("|")).length<=0)return 1;if(t[t.length-1]!==this.configFile.encodeMessageTrigger)return 1;n=t[0]}if(0===n.length)return 1;let a=discordCrypt.__extractTags(n);0!==a[0].length&&(n=a[0]);let c=a[1].length>0?a[1]:"",l=Buffer.from(this.configFile.passList[discordCrypt.getChannelId()]?this.configFile.passList[discordCrypt.getChannelId()].primary:this.configFile.defaultPassword),d=Buffer.from(this.configFile.passList[discordCrypt.getChannelId()]?this.configFile.passList[discordCrypt.getChannelId()].secondary:this.configFile.defaultPassword);if(n.length+16<1820){let t=discordCrypt.symmetricEncrypt(n,l,d,this.configFile.encryptMode,this.configFile.encryptBlockMode,this.configFile.paddingMode,!0);t=(t=this.encodedMessageHeader+discordCrypt.metaDataEncode(this.configFile.encryptMode,this.configFile.encryptBlockMode,this.configFile.paddingMode,parseInt(o.pseudoRandomBytes(1)[0]))+t).replace(/(.{32})/g,t=>`${t}\n`),discordCrypt.dispatchMessage(this.configFile.useEmbeds,t,this.messageHeader,`v${this.getVersion().replace("-debug","")}`,5577355,c,r,this.cachedModules,this.configFile.timedMessages,this.configFile.timedMessageExpires)}else{let t=discordCrypt.__splitStringChunks(n,1820);for(let e=0;e<t.length;e++){let s=discordCrypt.symmetricEncrypt(t[e],l,d,this.configFile.encryptMode,this.configFile.encryptBlockMode,this.configFile.paddingMode,!0);s=(s=this.encodedMessageHeader+discordCrypt.metaDataEncode(this.configFile.encryptMode,this.configFile.encryptBlockMode,this.configFile.paddingMode,parseInt(o.pseudoRandomBytes(1)[0]))+s).replace(/(.{32})/g,t=>`${t}\n`),discordCrypt.dispatchMessage(this.configFile.useEmbeds,s,this.messageHeader,`v${this.getVersion().replace("-debug","")}`,5577355,0===e?c:"",r,this.cachedModules,this.configFile.timedMessages,this.configFile.timedMessageExpires)}}return this.saveConfig(),0}static on_master_unlock_button_clicked(t,e,r,s,i,o){return()=>{e.attr("disabled",!0),r?e.text("Unlocking Database ..."):e.text("Creating Database ...");let n=s.val();if(null===n||""===n)return e.text(i),void e.attr("disabled",!1);discordCrypt.scrypt(Buffer.from(n),Buffer.from(discordCrypt.whirlpool(n,!0),"hex"),32,4096,8,1,(n,a,c)=>{if(n)return r?e.text("Invalid Password!"):e.text(`Error: ${n}`),s.val(""),o.css("width","0%"),setTimeout(function(){e.text(i)},1e3),discordCrypt.log(n.toString(),"error"),!0;if(a&&o.css("width",`${parseInt(100*a)}%`),c){if(t.masterPassword=Buffer.from(c,"hex"),!t.loadConfig())return t.configFile=null,r?e.text("Invalid Password!"):e.text("Failed to create the database!"),s.val(""),o.css("width","0%"),setTimeout(function(){e.text(i)},1e3),e.attr("disabled",!1),!1;t.start(),r?e.text("Unlocked Successfully!"):e.text("Created Successfully!"),setTimeout(function(){$("#dc-master-overlay").remove()},1e3)}return!1})}}static on_master_cancel_button_clicked(t){return()=>{setTimeout(function(){$("#dc-master-overlay").remove(),t.masterPassword=null,t.configFile=null},300)}}static on_file_button_clicked(){$("#dc-overlay").css("display","block"),$("#dc-overlay-upload").css("display","block")}static on_alter_file_button_clicked(){let t=require("electron").remote.dialog.showOpenDialog({title:"Select a file to encrypt and upload",buttonLabel:"Select",message:"Maximum file size is 50 MB",properties:["openFile","showHiddenFiles","treatPackageAsDirectory"]});t.length&&t[0].length&&$("#dc-file-path").val(t[0])}static on_upload_encrypted_clipboard_button_clicked(t){return()=>{let e=discordCrypt.getChannelId();discordCrypt.__up1UploadClipboard(t.configFile.up1Host,t.configFile.up1ApiKey,global.sjcl,(r,s,i)=>{null===r&&"string"==typeof s&&"string"==typeof i?(t.sendEncryptedMessage(`${s}`,!0,e),require("electron").clipboard.writeText(`Delete URL: ${i}`)):_alert("Failed to upload the clipboard!",r)})}}static on_upload_file_button_clicked(t){return()=>{const e=require("original-fs");let r=$("#dc-file-path"),s=$("#dc-file-upload-btn"),i=$("#dc-file-message-textarea"),o=$("#dc-file-deletion-checkbox").is(":checked"),n=$("#dc-file-name-random-checkbox").is(":checked");i.val().length>0&&t.sendEncryptedMessage(i.val(),!0);let a=discordCrypt.getChannelId();i.val(""),e.existsSync(r.val())?(s.text("Uploading ..."),s.addClass("dc-button-inverse"),discordCrypt.__up1UploadFile(r.val(),t.configFile.up1Host,t.configFile.up1ApiKey,global.sjcl,(e,i,n)=>{if(null!==e||"string"!=typeof i||"string"!=typeof n)return s.text("Failed to upload the file!"),discordCrypt.log(e,"error"),r.val(""),void setTimeout(()=>{s.text("Upload"),s.removeClass("dc-button-inverse")},1e3);t.sendEncryptedMessage(`${i}${o?"\n\nDelete URL: "+n:""}`,!0,a),r.val(""),s.text("Upload Successful!"),setTimeout(()=>{s.text("Upload"),s.removeClass("dc-button-inverse"),$("#dc-file-cancel-btn").click()},1e3)},n)):r.val("")}}static on_cancel_file_upload_button_clicked(){$("#dc-file-path").val(""),$("#dc-overlay").css("display","none"),$("#dc-overlay-upload").css("display","none")}static on_settings_button_clicked(){$("#dc-overlay").css("display","block"),$("#dc-overlay-settings").css("display","block")}static on_plugin_settings_tab_button_clicked(){discordCrypt.setActiveSettingsTab(0)}static on_database_settings_tab_button_clicked(t){return()=>{let e,r,s,i;(i=$("#dc-database-entries")).html(""),e=t.cachedModules.UserResolver.getUsers(),r=t.cachedModules.GuildResolver.getGuilds(),s=t.cachedModules.ChannelResolver.getChannels();for(let o in t.configFile.passList){let n,a=o;if(!s[a])continue;if(0===s[a].type){let t;n=`${r[s[a].guild_id].name} @ #${s[a].name}`}else{if(1!==s[a].type)continue;{let t=e[s[a].recipients[0]];n=`DM @${t.username}#${t.discriminator}`}}let c=$(`<tr><td>${a}</td><td>${n}</td><td></td></tr>`),l=$("<button>").addClass("dc-button dc-button-small dc-button-inverse").text("Delete");l.click(function(){delete t.configFile.passList[a],t.saveConfig(),l.parent().parent().remove()}),$(c.children()[2]).append(l),i.append(c)}discordCrypt.setActiveSettingsTab(1)}}static on_import_database_button_clicked(t){return()=>{const e=require("fs");let r=require("electron").remote.dialog.showOpenDialog({title:"Import Database",message:"Select the configuration file(s) to import",buttonLabel:"Import",filters:[{name:"Database Entries ( *.json )",extensions:["json"]}],properties:["openFile","multiSelections","showHiddenFiles","treatPackageAsDirectory"]});if(!r.length)return;let s=$("#dc-import-database-btn"),i=0;s.text(`Importing ( ${r.length} ) File(s)`);for(let s=0;s<r.length;s++){let o=r[s],n;if(e.statSync(o).isFile()){try{n=JSON.parse(e.readFileSync(o).toString())}catch(t){discordCrypt.log(`Error reading JSON file '${o} ...`,"warn");continue}if(n.discordCrypt_entries&&n.discordCrypt_entries.length)for(let e=0;e<n.discordCrypt_entries.length;e++){let r=n.discordCrypt_entries[e];r.id&&r.primary&&r.secondary&&(t.configFile.passList.hasOwnProperty(r.id)||i++,t.configFile.passList[r.id]=discordCrypt.createPassword(r.primary,r.secondary))}}}setTimeout(()=>{s.text(`Imported (${i}) ${1===i?"Entry":"Entries"}`),setTimeout(()=>{s.text("Import Database(s)")},1e3)},500),0!==i&&(discordCrypt.on_database_settings_tab_button_clicked(t)(),t.saveConfig())}}static on_export_database_button_clicked(t){return()=>{let e=require("electron").remote.dialog.showSaveDialog({title:"Export Database",message:"Select the destination file",buttonLabel:"Export",filters:[{name:"Database Entries ( *.json )",extensions:["json"]}]});if(!e.length)return;const r=require("fs");let s=$("#dc-export-database-btn"),i={discordCrypt_entries:[]},o;for(let e in t.configFile.passList){let r=t.configFile.passList[e];i.discordCrypt_entries.push({id:e,primary:r.primary,secondary:r.secondary})}o=i.discordCrypt_entries.length;try{r.writeFileSync(e,JSON.stringify(i,null,"    ")),s.text(`Exported (${o}) ${1===o?"Entry":"Entries"}`)}catch(t){discordCrypt.log(`Error exporting entries: ${t.toString()}`,"error"),s.text("Error: See Console")}setTimeout(()=>{s.text("Export Database")},1e3)}}static on_clear_entries_button_clicked(t){return()=>{let e=$("#dc-erase-entries-btn");t.configFile.passList={},$("#dc-database-entries").html(""),t.saveConfig(),e.text("Cleared Entries"),setTimeout(()=>{e.text("Erase Entries")},1e3)}}static on_settings_close_button_clicked(){discordCrypt.setActiveSettingsTab(0),$("#dc-overlay").css("display","none"),$("#dc-overlay-settings").css("display","none")}static on_save_settings_button_clicked(t){return()=>{let e=$("#dc-primary-cipher"),r=$("#dc-secondary-cipher"),s=$("#dc-master-password");if(t.configFile.encodeMessageTrigger=$("#dc-settings-encrypt-trigger").val(),t.configFile.timedMessageExpires=$("#dc-settings-timed-expire").val(),t.configFile.encryptBlockMode=$("#dc-settings-cipher-mode").val(),t.configFile.defaultPassword=$("#dc-settings-default-pwd").val(),t.configFile.encryptScanDelay=$("#dc-settings-scan-delay").val(),t.configFile.paddingMode=$("#dc-settings-padding-mode").val(),t.configFile.useEmbeds=$("#dc-embed-enabled").is(":checked"),t.configFile.encryptMode=discordCrypt.cipherStringToIndex(e.val(),r.val()),e.val(discordCrypt.cipherIndexToString(t.configFile.encryptMode,!1)),r.val(discordCrypt.cipherIndexToString(t.configFile.encryptMode,!0)),""!==s.val()){let e=s.val();s.val(""),discordCrypt.scrypt(Buffer.from(e),Buffer.from(discordCrypt.whirlpool(e,!0),"hex"),32,4096,8,1,(e,r,s)=>e?(_alert("DiscordCrypt Error","Error setting the new database password. Check the console for more info."),discordCrypt.log(e.toString(),"error"),!0):(s&&(t.masterPassword=Buffer.from(s,"hex"),t.saveSettings($("#dc-settings-save-btn"))),!1))}else t.saveSettings($("#dc-settings-save-btn"))}}static on_reset_settings_button_clicked(t){return()=>{t.resetSettings($("#dc-settings-reset-btn")),$("#dc-secondary-cipher").val(discordCrypt.cipherIndexToString(t.configFile.encryptMode,!0)),$("#dc-primary-cipher").val(discordCrypt.cipherIndexToString(t.configFile.encryptMode,!1)),$("#dc-settings-cipher-mode").val(t.configFile.encryptBlockMode.toLowerCase()),$("#dc-settings-padding-mode").val(t.configFile.paddingMode.toLowerCase()),$("#dc-settings-encrypt-trigger").val(t.configFile.encodeMessageTrigger),$("#dc-settings-timed-expire").val(t.configFile.timedMessageExpires),$("#dc-settings-default-pwd").val(t.configFile.defaultPassword),$("#dc-settings-scan-delay").val(t.configFile.encryptScanDelay),$("#dc-embed-enabled").prop("checked",t.configFile.useEmbeds),$("#dc-master-password").val("")}}static on_restart_now_button_clicked(){location.reload()}static on_restart_later_button_clicked(){$("#dc-overlay").css("display","none"),$("#dc-update-overlay").css("display","none")}static on_info_tab_button_clicked(){discordCrypt.setActiveExchangeTab(0)}static on_exchange_tab_button_clicked(){discordCrypt.setActiveExchangeTab(1)}static on_handshake_tab_button_clicked(){discordCrypt.setActiveExchangeTab(2)}static on_close_exchange_button_clicked(){$("#dc-overlay").css("display","none"),$("#dc-overlay-exchange").css("display","none")}static on_open_exchange_button_clicked(){$("#dc-overlay").css("display","block"),$("#dc-overlay-exchange").css("display","block")}static on_quick_send_public_key_button_clicked(){$("#dc-keygen-gen-btn").click(),$("#dc-keygen-send-pub-btn").click()}static on_exchange_algorithm_changed(){let t=discordCrypt.getDHBitSizes(),e=discordCrypt.getECDHBitSizes(),r=$("#dc-keygen-method"),s=$("#dc-keygen-algorithm");switch($("#dc-keygen-algorithm option").each(function(){$(this).remove()}),r.val()){case"dh":for(let e=0;e<t.length;e++){let r=t[e];s.append(new Option(r,r,e===t.length-1))}break;case"ecdh":for(let t=0;t<e.length;t++){let r=e[t];$("#dc-keygen-algorithm").append(new Option(r,r,t===e.length-1))}break;default:return}}static on_generate_new_key_pair_button_clicked(){let t=discordCrypt.getDHBitSizes(),e=discordCrypt.getECDHBitSizes(),r=32,s=16,i,o,n,a,c,l=require("crypto"),d=$("#dc-keygen-method"),p=$("#dc-keygen-algorithm");switch(d.val()){case"dh":c=discordCrypt.generateDH(parseInt(p.val())),o=t.indexOf(parseInt(p.val()));break;case"ecdh":c=discordCrypt.generateECDH(parseInt(p.val())),o=e.indexOf(parseInt(p.val()))+t.length;break;default:return}c&&void 0!==c&&void 0!==c.getPrivateKey&&void 0!==c.getPublicKey&&(discordCrypt.privateExchangeKey=c,i=parseInt(l.randomBytes(1).toString("hex"),16)%16+16,a=Buffer.from(c.getPublicKey("hex","ecdh"===d.val()?"compressed":void 0),"hex"),(n=Buffer.alloc(2+i+a.length)).writeInt8(o,0),n.writeInt8(i,1),l.randomBytes(i).copy(n,2),a.copy(n,2+i),$("#dc-pub-key-ta").val(n.toString("hex")),$("#dc-priv-key-ta").val(c.getPrivateKey("hex")))}static on_keygen_clear_button_clicked(){$("#dc-pub-key-ta").val(""),$("#dc-priv-key-ta").val("")}static on_keygen_send_public_key_button_clicked(t){return()=>{let e=$("#dc-pub-key-ta");if(""===e.val())return;let r=Buffer.from(e.val(),"hex"),s=(r=t.encodedKeyHeader+discordCrypt.substituteMessage(r,!0)).replace(/(.{32})/g,t=>`${t}\n`),i=`${"ecdh"!==$("#dc-keygen-method").val()?"DH-":"ECDH-"}`+`${$("#dc-keygen-algorithm").val()}`,o=`-----BEGIN ${i} PUBLIC KEY-----`,n=`-----END ${i} PUBLIC KEY----- | v${t.getVersion().replace("-debug","")}`;discordCrypt.dispatchMessage(t.configFile.useEmbeds,s,o,n,7471104,"",void 0,t.cachedModules,t.configFile.timedMessages,t.configFile.timedMessageExpires),t.saveConfig(),$("#dc-keygen-send-pub-btn").text("Sent The Public Key!"),setTimeout(function(){$("#dc-keygen-send-pub-btn").text("Send Public Key")},1e3)}}static on_handshake_paste_public_key_button_clicked(){$("#dc-handshake-ppk").val(require("electron").clipboard.readText())}static on_handshake_compute_button_clicked(t){return()=>{let e,r,s,i,o,n,a,c,l=$("#dc-pub-key-ta"),d=$("#dc-priv-key-ta"),p=$("#dc-handshake-ppk"),u=$("#dc-handshake-compute-btn");function h(t){const e=discordCrypt.getBraille().splice(16,64);let r="";for(let s=0;s<parseInt(t.length/2);s++)r+=e[parseInt(t.substr(2*s,2))&e.length-1];return r}if(!p.val()||!p.val().length)return;if(!l.val()||!l.val().length)return u.text("You Didn't Generate A Key!"),void setTimeout(function(){u.text("Compute Secret Keys")},1e3);if(p.val().replace(/\r?\n|\r/g,"").slice(0,4)!==t.encodedKeyHeader)return;let f=p.val().replace(/\r?\n|\r/g,"").slice(4);if(!discordCrypt.isValidBraille(f))return;try{e=Buffer.from(discordCrypt.substituteMessage(f),"hex")}catch(t){return u.text("Invalid Public Key!"),void setTimeout(function(){u.text("Compute Secret Keys")},1e3)}if(r=e.readInt8(0),!discordCrypt.isValidExchangeAlgorithm(r))return u.text("Invalid Algorithm!"),void setTimeout(function(){u.text("Compute Secret Keys")},1e3);let g=Buffer.from(l.val(),"hex");if(g.readInt8(0)!==r)return u.text("Mismatched Algorithm!"),void setTimeout(function(){u.text("Compute Secret Keys")},1e3);if($("#dc-handshake-algorithm").text(`Exchange Algorithm: ${discordCrypt.indexToExchangeAlgorithmString(r)}`),(i=e.readInt8(1))<16||i>32)return u.text("Invalid Salt Length!"),void setTimeout(function(){u.text("Compute Secret Keys")},1e3);if(o=Buffer.from(e.subarray(2,2+i)),n=g.readInt8(1),a=Buffer.from(g.subarray(2,2+n)),$("#dc-handshake-salts").text(`Salts: [ ${h(o.toString("hex"))}, `+`${h(a.toString("hex"))} ]`),s=Buffer.from(e.subarray(2+i)).toString("hex"),!discordCrypt.privateExchangeKey||void 0===discordCrypt.privateExchangeKey||void 0===discordCrypt.privateExchangeKey.computeSecret)return u.text("Failed To Calculate Private Key!"),void setTimeout(function(){u.text("Compute Secret Keys")},1e3);let y=discordCrypt.computeExchangeSharedSecret(discordCrypt.privateExchangeKey,s,!1,!1);if(!y||!y.length)return u.text("Failed To Derive Key!"),void setTimeout(function(){u.text("Compute Secret Keys")},1e3);if($("#dc-handshake-secret").text(`Derived Secret: [ ${h(y.length>64?y.substring(0,64):y)} ]`),n===i){for(let t=2;t<parseInt(n/4);t+=4){let e=a.readUInt32BE(t),r=o.readUInt32BE(t);if(e!==r){c=e>r;break}}if(void 0===c)return u.text("Both Salts Are Equal ?!"),void setTimeout(function(){u.text("Compute Secret Keys")},1e3)}else c=n>i;let b=Buffer.from(discordCrypt.sha512(c?a:o,!0),"hex"),m=Buffer.from(discordCrypt.whirlpool(c?o:a,!0),"hex"),_=0,v=0;discordCrypt.scrypt(Buffer.from(y+m.toString("hex"),"hex"),b,256,3072,16,2,(t,e,r)=>t?(u.text("Failed Generating Primary Key!"),setTimeout(function(){u.text("Compute Secret Keys")},1e3),!0):(e&&(_=50*e,$("#dc-exchange-status").css("width",`${parseInt(_+v)}%`)),r&&($("#dc-handshake-prim-lbl").text(`Primary Key: ( Quality - ${discordCrypt.entropicBitLength(r.toString("base64"))} Bits )`),$("#dc-handshake-primary-key").val(r.toString("base64")),u.text("Compute Secret Keys"),$("#dc-handshake-algorithm").text("..."),$("#dc-handshake-secret").text("..."),$("#dc-handshake-salts").text("..."),$("#dc-exchange-status").css("width","0%")),!1));let k=c?a:o,C=c?o:a,w=Buffer.from(k.toString("hex")+y+C.toString("hex"),"hex");discordCrypt.scrypt(w,m,256,3072,8,1,(t,e,r)=>t?(u.text("Failed Generating Secondary Key!"),setTimeout(function(){u.text("Compute Secret Keys")},1e3),!0):(e&&(v=50*e,$("#dc-exchange-status").css("width",`${parseInt(_+v)}%`)),r&&($("#dc-handshake-sec-lbl").text(`Secondary Key: ( Quality - ${discordCrypt.entropicBitLength(r.toString("base64"))} Bits )`),$("#dc-handshake-secondary-key").val(r.toString("base64"))),!1)),u.text("Generating Keys ..."),discordCrypt.privateExchangeKey=void 0,p.val(""),d.val(""),l.val("")}}static on_handshake_copy_keys_button_clicked(){let t=$("#dc-handshake-primary-key"),e=$("#dc-handshake-secondary-key");""!==t.val()&&""!==e.val()&&(require("electron").clipboard.writeText(`Primary Key: ${t.val()}\r\n\r\n`+`Secondary Key: ${e.val()}`),t.val(""),e.val(""),$("#dc-handshake-cpy-keys-btn").text("Coped Keys To Clipboard!"),setTimeout(function(){$("#dc-handshake-cpy-keys-btn").text("Copy Keys & Nuke"),$("#dc-handshake-prim-lbl").text("Primary Key: "),$("#dc-handshake-sec-lbl").text("Secondary Key: ")},1e3))}static on_handshake_apply_keys_button_clicked(t){return()=>{let e=$("#dc-handshake-primary-key"),r=$("#dc-handshake-secondary-key");if(!e.val()||!e.val().length)return;if(!r.val()||!r.val().length)return;let s=discordCrypt.createPassword(e.val(),r.val());e.val(""),r.val(""),t.configFile.passList[discordCrypt.getChannelId()]=s,t.saveConfig(),$("#dc-handshake-apply-keys-btn").text("Applied & Saved!"),setTimeout(function(){$("#dc-handshake-apply-keys-btn").text("Apply Generated Passwords"),$("#dc-handshake-prim-lbl").text("Primary Key: "),$("#dc-handshake-sec-lbl").text("Secondary Key: "),$("#dc-overlay").css("display","none"),$("#dc-overlay-exchange").css("display","none"),discordCrypt.setActiveExchangeTab(0)},1e3)}}static on_passwd_button_clicked(){$("#dc-overlay").css("display","block"),$("#dc-overlay-password").css("display","block")}static on_save_passwords_button_clicked(t){return()=>{let e=$("#dc-save-pwd");t.updatePasswords(),e.text("Saved!"),setTimeout(function(){e.text("Save Password"),$("#dc-password-primary").val(""),$("#dc-password-secondary").val(""),$("#dc-overlay").css("display","none"),$("#dc-overlay-password").css("display","none")},1e3)}}static on_reset_passwords_button_clicked(t){return()=>{let e=$("#dc-reset-pwd");delete t.configFile.passList[discordCrypt.getChannelId()],t.saveConfig(),e.text("Password Reset!"),setTimeout(function(){e.text("Reset Password"),$("#dc-password-primary").val(""),$("#dc-password-secondary").val(""),$("#dc-overlay").css("display","none"),$("#dc-overlay-password").css("display","none")},1e3)}}static on_cancel_password_button_clicked(){$("#dc-password-primary").val(""),$("#dc-password-secondary").val(""),setTimeout(function(){$("#dc-overlay").css("display","none"),$("#dc-overlay-password").css("display","none")},250)}static on_copy_current_passwords_button_clicked(t){return()=>{let e=t.configFile.passList[discordCrypt.getChannelId()];e?(require("electron").clipboard.writeText(`Primary Key: ${e.primary}\r\n\r\nSecondary Key: ${e.secondary}`),$("#dc-cpy-pwds-btn").text("Copied Keys To Clipboard!"),setTimeout(function(){$("#dc-cpy-pwds-btn").text("Copy Current Passwords!"),$("#dc-cancel-btn").click()},1e3)):require("electron").clipboard.writeText(`Default Password: ${t.configFile.defaultPassword}`)}}static on_lock_button_clicked(t){return()=>{let e=$("#dc-lock-btn");t.configFile.encodeAll?(e.attr("title","Enable Message Encryption"),e.html(Buffer.from(t.unlockIcon,"base64").toString("utf8")),t.configFile.encodeAll=!1):(e.attr("title","Disable Message Encryption"),e.html(Buffer.from(t.lockIcon,"base64").toString("utf8")),t.configFile.encodeAll=!0),$(".dc-svg").attr("class","dc-svg"),t.saveConfig()}}static __shouldIgnoreUpdates(t){const e=require("fs"),r=require("path"),s=r.join(discordCrypt.getPluginsPath(),discordCrypt.getPluginName());return e.existsSync(s)&&(e.lstatSync(s).isSymbolicLink()||-1!==t.indexOf("-debug"))}static __getRequest(t,e){try{require("request")(t,(t,r,s)=>{e(r.statusCode,r.statusMessage,s)})}catch(t){e(-1,t.toString())}}static __getElementReactOwner(t,{include:e,exclude:r=["Popout","Tooltip","Scroller","BackgroundFlash"]}={}){if(void 0===t)return;const s=t=>t[Object.keys(t).find(t=>t.startsWith("__reactInternalInstance"))],i=void 0===e,o=i?r:e;function n(t){const e=t.type.displayName||t.type.name||null;return null!==e&&!!(o.includes(e)^i)}for(let e=s(t).return;!_.isNil(e);e=e.return)if(!_.isNil(e)&&!_.isNil(e.stateNode)&&!(e.stateNode instanceof HTMLElement)&&n(e))return e.stateNode}static __extractKeyInfo(t,e=!1){try{let r=[],s=t;return e&&(s=s.slice(4)),s=discordCrypt.substituteMessage(s),s=Buffer.from(s,"hex"),discordCrypt.isValidExchangeAlgorithm(s[0])?(r.fingerprint=discordCrypt.sha256(s,!0),r.bit_length=discordCrypt.indexToAlgorithmBitLength(s[0]),r.algorithm=discordCrypt.indexToExchangeAlgorithmString(s[0]).split("-")[0].toLowerCase(),r):null}catch(t){return null}}static __splitStringChunks(t,e){if(!e||e<0)return t;const r=Math.ceil(t.length/e),s=new Array(r);for(let i=0,o=0;i<r;++i,o+=e)s[i]=t.substr(o,e);return s}static __isValidUserName(t){if("string"!=typeof t)return!1;if("@"!==t[0])return!1;for(let e=1;e<t.length;e++){if(" "===t[e]||"@"===t[e])return!1;if(1!==e&&"#"===t[e]&&t.length-e-1==4)try{let r=t.slice(e+1,e+5);return!isNaN(r)&&parseInt(r,10)==r}catch(t){return!1}}return!1}static __extractTags(t){let e=t.split(" "),r="",s="",i=[];for(let t=0,r=0;t<e.length;t++)this.__isValidUserName(e[t])?(i[r++]=e[t],s+=`${e[t].split("#")[0]} `):"@everyone"===e[t]||"@here"===e[t]?(i[r++]=e[t],s+=`${e[t]} `):s+=`${e[t]} `;for(let t=0;t<i.length;t++)r+=`${i[t]} `;return[s.trim(),r.trim()]}static __extractCodeBlocks(t){let e=new RegExp(/^(([ \t]*`{3,4})([^\n]*)([\s\S]+?)(^[ \t]*\2))/gm),r=new RegExp(/(`([^`].*?)`)/g),s,i=[];for(;s=e.exec(t);)i.push({start_pos:s.index,end_pos:s.index+s[1].length,language:0===s[3].trim().length?"text":s[3].trim(),raw_code:s[4],captured_block:s[1]});for(;s=r.exec(t);)i.push({start_pos:s.index,end_pos:s.index+s[0].length,language:"inline",raw_code:t.substr(s.index,s.index+s[0].length).split("`")[1],captured_block:s[0]});return i}static __extractUrls(t){let e=new RegExp(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi),r,s=[];for(;r=e.exec(t);)s.push(r[0]);return s}static __buildCodeBlockMessage(t){try{let e=discordCrypt.__extractCodeBlocks(t);if(!e.length)return{code:!1,html:t};for(let r=0;r<e.length;r++)if("inline"!==e[r].language){let s="",i=e[r].raw_code.replace("\r","").split("\n");for(let t=1;t<i.length-1;t++)s+=`<li>${i[t]}</li>`;t=(t=t.split(e[r].captured_block)).join('<div class="markup line-scanned" data-colour="true" style="color: rgb(111, 0, 0);">'+`<pre class="hljs"><code class="dc-code-block hljs \n                        ${"text"===e[r].language?"":e[r].language}"\n                         style="position: relative;">`+`<ol>${s}</ol></code></pre></div>`)}else t=(t=t.split(e[r].captured_block)).join(`<code class="inline">${e[r].raw_code}</code>`);return{code:!0,html:t}}catch(e){return{code:!1,html:t}}}static __buildUrlMessage(t,e){try{let r=discordCrypt.__extractUrls(t);if(!r.length)return{url:!1,html:t};for(let s=0;s<r.length;s++){let i="";t=t.split(r[s]),void 0!==e&&r[s].startsWith(`${e}/#`)&&-1===r[s].indexOf("del?ident=")&&(i=`<iframe src=${r[s]} width="100%" height="400px"></iframe><br/><br/>`),t=t.join(`${i}<a target="_blank" href="${r[s]}">${r[s]}</a>`)}return{url:!0,html:`<span>${t}</span>`}}catch(e){return{url:!1,html:t}}}static __toBuffer(t,e){if(Buffer.isBuffer(t))return t;if("string"==typeof t)return Buffer.from(t,void 0===e?"utf8":e?"hex":"base64");if(Array.isArray(t))return Buffer.from(t);throw"Input is neither an Array(), Buffer() or a string."}static __createHash(t,e,r,s,i){try{const o=require("crypto"),n=s?o.createHmac(e,i):o.createHash(e);return n.update(t),n.digest(r?"hex":"base64")}catch(t){return""}}static __pbkdf2(t,e,r,s,i,o,n,a,c){const l=require("crypto");let d,p;if("object"==typeof t?d=Buffer.isBuffer(t)?t:Array.isArray?Buffer.from(t):Buffer.from(t,void 0===s?"utf8":s?"hex":"base64"):"string"==typeof t&&(d=Buffer.from(t,"utf8")),"object"==typeof e?p=Buffer.isBuffer(e)?e:Array.isArray?Buffer.from(e):Buffer.from(e,void 0===i?"utf8":i?"hex":"base64"):"string"==typeof e&&(p=Buffer.from(e,"utf8")),"function"==typeof o)l.pbkdf2(d,p,c,a,n,(t,e)=>{o(t,t?"":e.toString(r?"hex":"base64"))});else try{return l.pbkdf2Sync(d,p,c,a,n).toString(r?"hex":"base64")}catch(t){throw t}}static __padMessage(t,e,r,s,i){let o,n;function a(t,e){return t%e===e?e:e-t%e}function c(t,e,r){if(void 0===r){let r=Buffer.alloc(t.length+e);return t.copy(r),Buffer.alloc(e).fill(e).copy(r,t.length),r}return t.slice(0,t.length-t.readInt8(t.length-1))}function l(t,e,r){if(void 0===r){let r=Buffer.alloc(t.length+e);return t.copy(r),Buffer.alloc(e-1).fill(0).copy(r,t.length),Buffer.alloc(1).fill(e).copy(r,t.length+e-1),r}return t.slice(0,t.length-t.readInt8(t.length-1))}function d(t,e,r){const s=require("crypto");if(void 0===r){let r=Buffer.alloc(t.length+e);return t.copy(r),s.randomBytes(e-1).copy(r,t.length),r.writeUInt8(e,t.length+e-1),r}return t.slice(0,t.length-t.readUInt8(t.length-1))}function p(t,e,r){if(void 0===r){let r=Buffer.alloc(t.length+e);return t.copy(r),Buffer.alloc(1).fill(128).copy(r,t.length),Buffer.alloc(e-1).fill(0).copy(t,t.length+1),r}{let e=t.length-1;for(;e>0&&0===t[e];e--);let r=t.slice(0,e+1);return r.slice(0,r.length-1)}}switch(o=discordCrypt.__toBuffer(t,s),n=i?0:a(o.length,r/8),e.toUpperCase()){case"PKC7":return c(o,n,i);case"ANS2":return l(o,n,i);case"ISO1":return d(o,n,i);case"ISO9":return p(o,n,i);default:return""}}static __isValidCipher(t){const e=require("crypto");let r=!1,s=t.toLowerCase();return e.getCiphers().every(t=>t!==s||(r=!0,!1)),r}static __validateKeyIV(t,e=256,r){let s=e/8;if(t.length!==s){let e;switch(s){case 8:e=discordCrypt.whirlpool64;break;case 16:e=discordCrypt.sha512_128;break;case 20:e=discordCrypt.sha160;break;case 24:e=discordCrypt.whirlpool192;break;case 32:e=discordCrypt.sha256;break;case 64:e=void 0!==r?discordCrypt.sha512:discordCrypt.whirlpool;break;default:throw"Invalid block size specified for key or iv. Only 64, 128, 160, 192, 256 and 512 bit keys are supported."}return Buffer.from(e(t,!0),"hex")}return Buffer.from(t)}static __validateMessage(t,e){try{return discordCrypt.__toBuffer(t,e)}catch(t){throw"exception - Invalid message type."}}static __getFileMimeType(t){let e=require("mime-types").lookup(require("path").extname(t));return!1===e?"application/octet-stream":e}static __clipboardToBuffer(){let t=require("electron").clipboard;if(!t)return{mime_type:"",name:"",data:null};let e=require("original-fs"),r=require("path");if(0===t.availableFormats().length)return{mime_type:"",name:"",data:null};let s=t.availableFormats(),i,o="",n="",a=!1;for(let c=0;c<s.length;c++){let l=s[c].split("/");switch(l[0]){case"image":switch(l[1].toLowerCase()){case"png":i=t.readImage().toPNG();break;case"bmp":case"bitmap":i=t.readImage().toBitmap();break;case"jpg":case"jpeg":i=t.readImage().toJPEG(100)}break;case"text":o=t.readText();try{let t;e.statSync(o).isFile()?(i=e.readFileSync(o),n=r.basename(o),a=!0):i=Buffer.from(o,"utf8")}catch(t){i=Buffer.from(o,"utf8")}}if(i&&i.length>0)return a&&(s[c]=discordCrypt.__getFileMimeType(o)),{mime_type:s[c],name:n,data:i}}return{mime_type:"",name:"",data:null}}static __up1EncryptBuffer(t,e,r,s,i){const o=require("crypto");function n(t){t="string"==typeof t?s.codec.base64url.toBits(t):s.codec.bytes.toBits(t);let e=s.hash.sha512.hash(t);return{seed:t,key:s.bitArray.bitSlice(e,0,256),iv:s.bitArray.bitSlice(e,256,384),ident:s.bitArray.bitSlice(e,384,512)}}function a(t){let e=Buffer.alloc(2*t.length);for(let r=0,s=t.length;r<s;r++)e.writeUInt16BE(t.charCodeAt(r),2*r);return e}try{if(t.length>5e7)return void i("Input size must be < 50 MB.");t=Buffer.concat([a(JSON.stringify({mime:e,name:r})),Buffer.from([0,0]),t]),t=s.codec.bytes.toBits(new Uint8Array(t));let c=n(o.randomBytes(64));t=s.mode.ccm.encrypt(new s.cipher.aes(c.key),t,c.iv),i(null,Buffer.from(s.codec.bytes.fromBits(t)),s.codec.base64url.fromBits(c.ident),s.codec.base64url.fromBits(c.seed))}catch(t){i(t.toString())}}static __up1EncryptFile(t,e,r,s=!1){const i=require("crypto"),o=require("path"),n=require("original-fs");try{if(n.statSync(t).size>5e7)return void r("File size must be < 50 MB.");n.readFile(t,(n,a)=>{null===n?discordCrypt.__up1EncryptBuffer(a,discordCrypt.__getFileMimeType(t),s?i.pseudoRandomBytes(8).toString("hex")+o.extname(t):o.basename(t),e,r):r(n.toString())})}catch(t){r(t.toString())}}static __constructRandomArtImage(t,e,r,s){const i=Buffer.from(discordCrypt.pbkdf2_sha160(t,Buffer.alloc(e+r).fill(0),!0,void 0,void 0,e*r*3,1e3),"hex");let o=Buffer.concat([Buffer.from("BM"),Buffer.from([0,0,0,0]),Buffer.from([0,0]),Buffer.from([0,0]),Buffer.from([26,0,0,0]),Buffer.from([12,0,0,0]),Buffer([e,0]),Buffer([r,0]),Buffer.from([1,0]),Buffer.from([24,0])]);for(let t=0;t<r;t++)o=Buffer.concat([o,i.slice(t*r,t*r+3*e),Buffer.alloc(e%4).fill(0)]);return o=Buffer.concat([o,Buffer.from([0])]),s?`data:image/bmp;base64,${o.toString("base64")}`:o}static __up1UploadClipboard(t,e,r,s,i){let o=void 0===i?discordCrypt.__clipboardToBuffer():i;if(!o.mime_type.length||null===o.data)return void s("Invalid clipboard data.");let n=0===o.name.length?require("crypto").pseudoRandomBytes(16).toString("hex"):o.name;this.__up1EncryptBuffer(o.data,o.mime_type,n,r,(r,i,o,n)=>{if(null!==r)return void s(r);let a=new(require("form-data"));a.append("ident",o),a.append("file",i,{filename:"file",contentType:"text/plain"}),void 0!==e&&"string"==typeof e&&a.append("api_key",e),require("request").post({headers:a.getHeaders(),uri:`${t}/up`,body:a},(e,r,i)=>{try{null!==e?s(e):s(null,`${t}/#${n}`,`${t}/del?ident=${o}&delkey=${JSON.parse(i).delkey}`,n)}catch(t){s(t.toString())}})})}static __up1UploadFile(t,e,r,s,i,o=!1){this.__up1EncryptFile(t,s,(t,s,o,n)=>{if(null!==t)return void i(t);let a=new(require("form-data"));a.append("ident",o),a.append("file",s,{filename:"file",contentType:"text/plain"}),void 0!==r&&"string"==typeof r&&a.append("api_key",r),require("request").post({headers:a.getHeaders(),uri:`${e}/up`,body:a},(t,r,s)=>{try{null!==t?i(t):i(null,`${e}/#${n}`,`${e}/del?ident=${o}&delkey=${JSON.parse(s).delkey}`,n)}catch(t){i(t.toString())}})},o)}static scrypt(t,e,r,s=16384,i=8,o=1,n=null){let a,c;function l(t,e,r,s){try{return Buffer.from(discordCrypt.pbkdf2_sha256(t,e,!0,void 0,void 0,r,s),"hex")}catch(t){return discordCrypt.log(t.toString(),"error"),Buffer.alloc(1)}}function d(t,e,r,s,i){let o,n,a,c;for(o=0,n=16*(2*r-1);o<16;o++)i[o]=t[n+o];for(o=0;o<2*r;o++){for(n=0,a=16*o;n<16;n++)i[n]^=t[a+n];for(n=0;n<16;n++)s[n]=i[n];let r=(t,e)=>t<<e|t>>>32-e;for(n=8;n>0;n-=2)s[4]^=r(s[0]+s[12],7),s[8]^=r(s[4]+s[0],9),s[12]^=r(s[8]+s[4],13),s[0]^=r(s[12]+s[8],18),s[9]^=r(s[5]+s[1],7),s[13]^=r(s[9]+s[5],9),s[1]^=r(s[13]+s[9],13),s[5]^=r(s[1]+s[13],18),s[14]^=r(s[10]+s[6],7),s[2]^=r(s[14]+s[10],9),s[6]^=r(s[2]+s[14],13),s[10]^=r(s[6]+s[2],18),s[3]^=r(s[15]+s[11],7),s[7]^=r(s[3]+s[15],9),s[11]^=r(s[7]+s[3],13),s[15]^=r(s[11]+s[7],18),s[1]^=r(s[0]+s[3],7),s[2]^=r(s[1]+s[0],9),s[3]^=r(s[2]+s[1],13),s[0]^=r(s[3]+s[2],18),s[6]^=r(s[5]+s[4],7),s[7]^=r(s[6]+s[5],9),s[4]^=r(s[7]+s[6],13),s[5]^=r(s[4]+s[7],18),s[11]^=r(s[10]+s[9],7),s[8]^=r(s[11]+s[10],9),s[9]^=r(s[8]+s[11],13),s[10]^=r(s[9]+s[8],18),s[12]^=r(s[15]+s[14],7),s[13]^=r(s[12]+s[15],9),s[14]^=r(s[13]+s[12],13),s[15]^=r(s[14]+s[13],18);for(n=0;n<16;++n)i[n]+=s[n];for(n=0,a=e+16*o;n<16;n++)t[n+a]=i[n]}for(o=0;o<r;o++)for(n=0,a=e+2*o*16,c=16*o;n<16;n++)t[c+n]=t[a+n];for(o=0;o<r;o++)for(n=0,a=e+16*(2*o+1),c=16*(o+r);n<16;n++)t[c+n]=t[a+n]}function p(t,e,s,i,o,n){let a,c,p,u=l(t,e,128*o*i,1),h=new Uint32Array(32*o*i),f=new Uint32Array(64*i),g=new Uint32Array(32*i*s),y=new Uint32Array(16),b=new Uint32Array(16);for(let t=0;t<h.length;t++){let e=4*t;h[t]=(255&u[e+3])<<24|(255&u[e+2])<<16|(255&u[e+1])<<8|(255&u[e])<<0}let m=32*i;a=o*s*2,c=0,p=null;let _=!1,v=0,k=0,C,w,x=parseInt(1e3/i),A="undefined"!=typeof setImmediate?setImmediate:setTimeout;const E=function(){if(_)return n(new Error("cancelled"),c/a);let e,S,M,B,$;switch(v){case 0:w=32*k*i;for(let t=0;t<m;t++)f[t]=h[w+t];v=1,C=0;case 1:for((e=s-C)>x&&(e=x),S=0;S<e;S++){for(M=(C+S)*m,B=m;B--;)g[B+M]=f[B];d(f,m,i,y,b)}if(C+=e,c+=e,($=parseInt(1e3*c/a))!==p){if(_=n(null,c/a))break;p=$}if(C<s)break;C=0,v=2;case 2:for((e=s-C)>x&&(e=x),S=0;S<e;S++){for(B=0,M=(f[16*(2*i-1)]&s-1)*m;B<m;B++)f[B]^=g[M+B];d(f,m,i,y,b)}if(C+=e,c+=e,($=parseInt(1e3*c/a))!==p){if(_=n(null,c/a))break;p=$}if(C<s)break;for(B=0;B<m;B++)h[w+B]=f[B];if(++k<o){v=0;break}for(u=[],S=0;S<h.length;S++)u.push(h[S]>>0&255),u.push(h[S]>>8&255),u.push(h[S]>>16&255),u.push(h[S]>>24&255);return n(null,1,Buffer.from(l(t,Buffer.from(u),r,1)));default:return n(new Error("invalid state"),0)}A(E)};E()}if("object"==typeof t||"string"==typeof t)if(Array.isArray(t))a=Buffer.from(t);else if(Buffer.isBuffer(t))a=t;else{if("string"!=typeof t)return discordCrypt.log("Invalid input parameter type specified!","error"),!1;a=Buffer.from(t,"utf8")}if("object"==typeof e||"string"==typeof e)if(Array.isArray(e))c=Buffer.from(e);else if(Buffer.isBuffer(e))c=e;else{if("string"!=typeof e)return discordCrypt.log("Invalid salt parameter type specified!","error"),!1;c=Buffer.from(e,"utf8")}return"number"!=typeof r?(discordCrypt.log("Invalid output_length parameter specified. Must be a numeric value.","error"),!1):r<=0||r>=65536?(discordCrypt.log("Invalid output_length parameter specified. Must be a numeric value.","error"),!1):!s||s&s-1!=0?(discordCrypt.log("Parameter N must be a power of 2.","error"),!1):void 0!==n&&null!==n?(setTimeout(()=>{p(a,c,s,i,o,n)},1),!0):(discordCrypt.log("No callback specified.","error"),!1)}static whirlpool64(t,e){return Buffer.from(discordCrypt.whirlpool(t,!0),"hex").slice(0,8).toString(e?"hex":"base64")}static sha512_128(t,e){return Buffer.from(discordCrypt.sha512(t,!0),"hex").slice(0,16).toString(e?"hex":"base64")}static whirlpool192(t,e){return Buffer.from(discordCrypt.sha512(t,!0),"hex").slice(0,24).toString(e?"hex":"base64")}static sha160(t,e){return discordCrypt.__createHash(t,"sha1",e)}static sha256(t,e){return discordCrypt.__createHash(t,"sha256",e)}static sha512(t,e){return discordCrypt.__createHash(t,"sha512",e)}static whirlpool(t,e){return discordCrypt.__createHash(t,"whirlpool",e)}static hmac_sha256(t,e,r){return discordCrypt.__createHash(t,"sha256",r,!0,e)}static hmac_sha512(t,e,r){return discordCrypt.__createHash(t,"sha512",r,!0,e)}static hmac_whirlpool(t,e,r){return discordCrypt.__createHash(t,"whirlpool",r,!0,e)}static pbkdf2_sha160(t,e,r,s,i,o=32,n=5e3,a){return discordCrypt.__pbkdf2(t,e,r,s,i,a,"sha1",o,n)}static pbkdf2_sha256(t,e,r,s,i,o=32,n=5e3,a){return discordCrypt.__pbkdf2(t,e,r,s,i,a,"sha256",o,n)}static pbkdf2_sha512(t,e,r,s,i,o=32,n=5e3,a){return discordCrypt.__pbkdf2(t,e,r,s,i,a,"sha512",o,n)}static pbkdf2_whirlpool(t,e,r,s,i,o=32,n=5e3,a){return discordCrypt.__pbkdf2(t,e,r,s,i,a,"whirlpool",o,n)}static __encrypt(t,e,r,s,i,o,n,a=256,c=128,l,d=1e3){const p=`${t}${void 0===e?"":"-"+e}`,u=require("crypto");let h,f,g,y,b,m;if(!discordCrypt.__isValidCipher(p)||-1===["cbc","cfb","ofb"].indexOf(e.toLowerCase()))return null;if(h=discordCrypt.__padMessage(s,r,a,n),f=discordCrypt.__validateKeyIV(i,a),void 0!==l){if(!(y=discordCrypt.__toBuffer(l))||0===y.length)return null;8!==y.length&&(y=Buffer.from(discordCrypt.whirlpool64(y,!0),"hex"))}else y=u.randomBytes(8);g=(b=discordCrypt.pbkdf2_sha256(f.toString("hex"),y.toString("hex"),!0,!0,!0,c/8+a/8,d)).slice(0,c/8),f=b.slice(c/8,c/8+a/8),(m=u.createCipheriv(p,f,g)).setAutoPadding(!1);let _=m.update(h,void 0,"hex");return _+=m.final("hex"),Buffer.from(y.toString("hex")+_,"hex").toString(o?"hex":"base64")}static __decrypt(t,e,r,s,i,o,n,a=256,c=128,l=1e3){const d=`${t}${void 0===e?"":"-"+e}`,p=require("crypto");let u,h,f,g,y,b;if(!discordCrypt.__isValidCipher(d)||-1===["cbc","ofb","cfb"].indexOf(e.toLowerCase()))return null;u=discordCrypt.__validateMessage(s,n),h=discordCrypt.__validateKeyIV(i,a),g=u.slice(0,8),f=(y=discordCrypt.pbkdf2_sha256(h.toString("hex"),g.toString("hex"),!0,!0,!0,c/8+a/8,l)).slice(0,c/8),h=y.slice(c/8,c/8+a/8),u=u.slice(8),(b=p.createDecipheriv(d,h,f)).setAutoPadding(!1);let m=b.update(u,void 0,"hex");return m+=b.final("hex"),(m=discordCrypt.__padMessage(m,r,a,!0,!0)).toString(o)}static blowfish512_encrypt(t,e,r,s,i=!1,o,n,a=1e3){const c=512,l=64;return discordCrypt.__encrypt("bf",r,s,t,e,i,o,512,64,n,a)}static blowfish512_decrypt(t,e,r,s,i="utf8",o,n=1e3){const a=512,c=64;return discordCrypt.__decrypt("bf",r,s,t,e,i,o,512,64,n)}static aes256_encrypt(t,e,r,s,i=!1,o,n,a=1e3){const c=256,l=128;return discordCrypt.__encrypt("aes-256",r,s,t,e,i,o,256,128,n,a)}static aes256_decrypt(t,e,r,s,i="utf8",o,n=1e3){const a=256,c=128;return discordCrypt.__decrypt("aes-256",r,s,t,e,i,o,256,128,n)}static aes256_encrypt_gcm(t,e,r,s=!1,i,o,n,a=1e3){const c=128,l=256,d="aes-256-gcm",p=require("crypto");let u,h,f,g,y,b;if(u=discordCrypt.__padMessage(t,r,256,i),h=discordCrypt.__validateKeyIV(e,256),void 0!==n){if(!(g=discordCrypt.__toBuffer(n))||0===g.length)return null;8!==g.length&&(g=Buffer.from(discordCrypt.whirlpool64(g,!0),"hex"))}else g=p.randomBytes(8);f=(y=discordCrypt.pbkdf2_sha256(h.toString("hex"),g.toString("hex"),!0,!0,!0,48,a)).slice(0,16),h=y.slice(16,48),b=p.createCipheriv(d,h,f),void 0!==o&&b.setAAD(discordCrypt.__toBuffer(o)),b.setAutoPadding(!1);let m=b.update(u,void 0,"hex");return m+=b.final("hex"),Buffer.from(b.getAuthTag().toString("hex")+g.toString("hex")+m,"hex").toString(s?"hex":"base64")}static aes256_decrypt_gcm(t,e,r,s="utf8",i,o,n=1e3){const a=128,c=256,l="aes-256-gcm",d=require("crypto");let p,u,h,f,g,y,b;p=discordCrypt.__validateMessage(t,i),u=discordCrypt.__validateKeyIV(e,256),g=p.slice(0,16),f=(p=p.slice(16)).slice(0,8),p=p.slice(8),h=(y=discordCrypt.pbkdf2_sha256(u.toString("hex"),f.toString("hex"),!0,!0,!0,48,n)).slice(0,16),u=y.slice(16,48),(b=d.createDecipheriv(l,u,h)).setAuthTag(g),void 0!==o&&b.setAAD(discordCrypt.__toBuffer(o)),b.setAutoPadding(!1);let m=b.update(p,void 0,"hex");return m+=b.final("hex"),(m=discordCrypt.__padMessage(m,r,256,!0,!0)).toString(s)}static camellia256_encrypt(t,e,r,s,i=!1,o,n,a=1e3){const c=256,l=128;return discordCrypt.__encrypt("camellia-256",r,s,t,e,i,o,256,128,n,a)}static camellia256_decrypt(t,e,r,s,i="utf8",o,n=1e3){const a=256,c=128;return discordCrypt.__decrypt("camellia-256",r,s,t,e,i,o,256,128,n)}static tripledes192_encrypt(t,e,r,s,i=!1,o,n,a=1e3){const c=192,l=64;return discordCrypt.__encrypt("des-ede3",r,s,t,e,i,o,192,64,n,a)}static tripledes192_decrypt(t,e,r,s,i="utf8",o,n=1e3){const a=192,c=64;return discordCrypt.__decrypt("des-ede3",r,s,t,e,i,o,192,64,n)}static idea128_encrypt(t,e,r,s,i=!1,o,n,a=1e3){const c=128,l=64;return discordCrypt.__encrypt("idea",r,s,t,e,i,o,128,64,n,a)}static idea128_decrypt(t,e,r,s,i="utf8",o,n=1e3){const a=128,c=64;return discordCrypt.__decrypt("idea",r,s,t,e,i,o,128,64,n)}static cipherStringToIndex(t,e){let r=0;if("number"==typeof t)return t;switch("string"==typeof t&&-1!==t.search("-")&&void 0===e&&(e=(t=t.split("-")[0]).split("-")[1]),t){case"bf":break;case"aes":r=1;break;case"camel":r=2;break;case"idea":r=3;break;case"tdes":r=4;break;default:return 0}if(void 0!==e)switch(e){case"bf":break;case"aes":r+=5;break;case"camel":r+=10;break;case"idea":r+=15;break;case"tdes":r+=20}return r}static cipherIndexToString(t,e){return void 0!==e&&e?t>=20?"tdes":t>=15?"idea":t>=10?"camel":t>=5?"aes":"bf":(t>=20?t-=20:t>=15&&t<=19?t-=15:t>=10&&t<=14?t-=10:t>=5&&t<=9&&(t-=5),1===t?"aes":2===t?"camel":3===t?"idea":4===t?"tdes":"bf")}static entropicBitLength(t){let e=Object.create(null),r,s=0,i=t.length;for(r in t.split("").forEach(t=>{e[t]?e[t]++:e[t]=1}),e){let t=e[r]/i;s-=t*Math.log(t)/Math.log(2)}return parseInt(s*i)}static getBraille(){return Array.from("\u2800\u2801\u2802\u2803\u2804\u2805\u2806\u2807\u2808\u2809\u280a\u280b\u280c\u280d\u280e\u280f\u2810\u2811\u2812\u2813\u2814\u2815\u2816\u2817\u2818\u2819\u281a\u281b\u281c\u281d\u281e\u281f\u2820\u2821\u2822\u2823\u2824\u2825\u2826\u2827\u2828\u2829\u282a\u282b\u282c\u282d\u282e\u282f\u2830\u2831\u2832\u2833\u2834\u2835\u2836\u2837\u2838\u2839\u283a\u283b\u283c\u283d\u283e\u283f\u2840\u2841\u2842\u2843\u2844\u2845\u2846\u2847\u2848\u2849\u284a\u284b\u284c\u284d\u284e\u284f\u2850\u2851\u2852\u2853\u2854\u2855\u2856\u2857\u2858\u2859\u285a\u285b\u285c\u285d\u285e\u285f\u2860\u2861\u2862\u2863\u2864\u2865\u2866\u2867\u2868\u2869\u286a\u286b\u286c\u286d\u286e\u286f\u2870\u2871\u2872\u2873\u2874\u2875\u2876\u2877\u2878\u2879\u287a\u287b\u287c\u287d\u287e\u287f\u2880\u2881\u2882\u2883\u2884\u2885\u2886\u2887\u2888\u2889\u288a\u288b\u288c\u288d\u288e\u288f\u2890\u2891\u2892\u2893\u2894\u2895\u2896\u2897\u2898\u2899\u289a\u289b\u289c\u289d\u289e\u289f\u28a0\u28a1\u28a2\u28a3\u28a4\u28a5\u28a6\u28a7\u28a8\u28a9\u28aa\u28ab\u28ac\u28ad\u28ae\u28af\u28b0\u28b1\u28b2\u28b3\u28b4\u28b5\u28b6\u28b7\u28b8\u28b9\u28ba\u28bb\u28bc\u28bd\u28be\u28bf\u28c0\u28c1\u28c2\u28c3\u28c4\u28c5\u28c6\u28c7\u28c8\u28c9\u28ca\u28cb\u28cc\u28cd\u28ce\u28cf\u28d0\u28d1\u28d2\u28d3\u28d4\u28d5\u28d6\u28d7\u28d8\u28d9\u28da\u28db\u28dc\u28dd\u28de\u28df\u28e0\u28e1\u28e2\u28e3\u28e4\u28e5\u28e6\u28e7\u28e8\u28e9\u28ea\u28eb\u28ec\u28ed\u28ee\u28ef\u28f0\u28f1\u28f2\u28f3\u28f4\u28f5\u28f6\u28f7\u28f8\u28f9\u28fa\u28fb\u28fc\u28fd\u28fe\u28ff")}static isValidBraille(t){let e=discordCrypt.getBraille();for(let r=0;r<t.length;r++)if(-1===e.indexOf(t[r]))return!1;return!0}static getBase64(){return Array.from("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=")}static getDHBitSizes(){return[768,1024,1536,2048,3072,4096,6144,8192]}static getECDHBitSizes(){return[224,256,384,409,521,571]}static isValidExchangeAlgorithm(t){return t>=0&&t<=discordCrypt.getDHBitSizes().length+discordCrypt.getECDHBitSizes().length-1}static indexToExchangeAlgorithmString(t){let e=discordCrypt.getDHBitSizes(),r=discordCrypt.getECDHBitSizes(),s=["DH-","ECDH-"];return discordCrypt.isValidExchangeAlgorithm(t)?t<=e.length-1?s[0]+e[t]:s[1]+r[t-e.length]:"Invalid Algorithm"}static indexToAlgorithmBitLength(t){let e=discordCrypt.getDHBitSizes(),r=discordCrypt.getECDHBitSizes();return discordCrypt.isValidExchangeAlgorithm(t)?t<=e.length-1?e[t]:r[t-e.length]:0}static computeExchangeSharedSecret(t,e,r,s){let i,o;i=r?"base64":"hex",o=s?"base64":"hex";try{return t.computeSecret(e,i,o)}catch(t){return null}}static generateDH(t,e){let r,s;switch(t){case 768:r="modp1";break;case 1024:r="modp2";break;case 1536:r="modp5";break;case 2048:r="modp14";break;case 3072:r="modp15";break;case 4096:r="modp16";break;case 6144:r="modp17";break;case 8192:r="modp18";break;default:return null}try{s=require("crypto").getDiffieHellman(r)}catch(t){return null}return void 0!==s&&null!==s&&void 0!==s.generateKeys&&(void 0===e?s.generateKeys():void 0!==s.setPrivateKey&&s.setPrivateKey(e)),s}static generateECDH(t,e){let r,s;switch(t){case 224:r="secp224k1";break;case 384:r="secp384r1";break;case 409:r="sect409k1";break;case 521:r="secp521r1";break;case 571:r="sect571k1";break;case 256:break;default:return null}try{256!==t?s=require("crypto").createECDH(r):(s=new global.Curve25519).generateKeys(void 0,require("crypto").randomBytes(32))}catch(t){return null}return void 0!==s&&null!==s&&void 0!==s.generateKeys&&256!==t&&(void 0===e?s.generateKeys("hex","compressed"):void 0!==s.setPrivateKey&&s.setPrivateKey(e)),s}static substituteMessage(t,e){let r=discordCrypt.getBraille(),s="",i=0;if(void 0!==e){if(!Buffer.isBuffer(t))throw"Message input is not a buffer.";for(let e=0;e<t.length;e++)s+=r[t[e]]}else for(let e=0;e<t.length;e++){if(-1===(i=r.indexOf(t[e])))throw"Message contains invalid characters.";s+=`0${i.toString(16)}`.slice(-2)}return s}static metaDataEncode(t,e,r,s){"string"==typeof t&&(t=discordCrypt.cipherStringToIndex(t)),"string"==typeof e&&(e=["cbc","cfb","ofb"].indexOf(e.toLowerCase())),"string"==typeof r&&(r=["pkc7","ans2","iso1","iso9"].indexOf(r.toLowerCase()));let i=Buffer.from([t,e,r,parseInt(s)]);return discordCrypt.substituteMessage(i,!0)}static metaDataDecode(t){return Buffer.from(discordCrypt.substituteMessage(t),"hex")}static symmetricEncrypt(t,e,r,s,i,o){const n=new Uint8Array(Buffer.from("DiscordCrypt MAC"));function a(t,e,r,s,i){switch(r){case 0:return discordCrypt.blowfish512_encrypt(t,e,s,i);case 1:return discordCrypt.aes256_encrypt(t,e,s,i);case 2:return discordCrypt.camellia256_encrypt(t,e,s,i);case 3:return discordCrypt.idea128_encrypt(t,e,s,i);case 4:return discordCrypt.tripledes192_encrypt(t,e,s,i);default:return null}}let c=i.toLowerCase(),l=o,d="";if(s>=0&&s<=4)d=discordCrypt.blowfish512_encrypt(a(t,e,s,c,l),r,c,l,!0,!1);else if(s>=5&&s<=9)d=discordCrypt.aes256_encrypt(a(t,e,s-5,c,l),r,c,l,!0,!1);else if(s>=10&&s<=14)d=discordCrypt.camellia256_encrypt(a(t,e,s-10,c,l),r,c,l,!0,!1);else if(s>=15&&s<=19)d=discordCrypt.idea128_encrypt(a(t,e,s-15,c,l),r,c,l,!0,!1);else{if(!(s>=20&&s<=24))throw`Unknown cipher selected: ${s}`;d=discordCrypt.tripledes192_encrypt(a(t,e,s-20,c,l),r,c,l,!0,!1)}let p=kmac256(new Uint8Array(Buffer.concat([e,r])),new Uint8Array(Buffer.from(d,"hex")),256,n);return d=Buffer.from(p+d,"hex"),discordCrypt.substituteMessage(d,!0)}static symmetricDecrypt(t,e,r,s,i,o){const n=new Uint8Array(Buffer.from("DiscordCrypt MAC")),a=require("crypto");function c(t,e,r,s,i,o="utf8",n){switch(r){case 0:return discordCrypt.blowfish512_decrypt(t,e,s,i,o,n);case 1:return discordCrypt.aes256_decrypt(t,e,s,i,o,n);case 2:return discordCrypt.camellia256_decrypt(t,e,s,i,o,n);case 3:return discordCrypt.idea128_decrypt(t,e,s,i,o,n);case 4:return discordCrypt.tripledes192_decrypt(t,e,s,i,o,n);default:return null}}let l,d;if("string"!=typeof i)if(0===i)l="cbc";else if(1===i)l="cfb";else{if(2!==i)return"";l="ofb"}if("string"!=typeof o)if(0===o)d="pkc7";else if(1===o)d="ans2";else if(2===o)d="iso1";else{if(3!==o)return"";d="iso9"}try{t=Buffer.from(discordCrypt.substituteMessage(t),"hex");let i=Buffer.from(t.subarray(0,32));t=Buffer.from(t.subarray(32));let o=Buffer.from(kmac256(new Uint8Array(Buffer.concat([e,r])),new Uint8Array(t),256,n),"hex");return a.timingSafeEqual(o,i)?s>=0&&s<=4?c(discordCrypt.blowfish512_decrypt(t,r,l,d,"base64"),e,s,l,d,"utf8",!1):s>=5&&s<=9?c(discordCrypt.aes256_decrypt(t,r,l,d,"base64"),e,s-5,l,d,"utf8",!1):s>=10&&s<=14?c(discordCrypt.camellia256_decrypt(t,r,l,d,"base64"),e,s-10,l,d,"utf8",!1):s>=15&&s<=19?c(discordCrypt.idea128_decrypt(t,r,l,d,"base64"),e,s-15,l,d,"utf8",!1):s>=20&&s<=24?c(discordCrypt.tripledes192_decrypt(t,r,l,d,"base64"),e,s-20,l,d,"utf8",!1):-3:1}catch(t){return 2}}}module.exports={discordCrypt:discordCrypt};